<!DOCTYPE html>
<html style="filter:grayscale(0%);">

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    

    <title>关于变分法的一些整理</title>
    <meta name="description" content="">

    <link rel="shortcut icon" href="/favicon.jpg?" type="image/x-icon">
    <link rel="icon" href="/favicon.jpg?" type="image/x-icon">
    <!---2020-01-17 change font-awesome-->
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/4.7.0/css/font-awesome.css">
    <!--- 
    <link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"> 
    -->
    <link rel="stylesheet" href="/css/cndaqiang.css"> 
	<!---图标cdn icon，每次在iconfont中添加一个图标，这个链接就要更新--->
   <link rel="stylesheet" href="https://at.alicdn.com/t/font_461356_ofctiykkk5.css">
	 <link rel="stylesheet" href="/css/main.css ">
   <link rel="canonical" href="http://localhost:4000/2020/04/26/delta/">
   <link rel="alternate" type="application/rss+xml" title="cndaqiang" href="http://localhost:4000/feed.xml ">

	
	<!---
	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
		<script>
		// 谷歌广告测试
	//	(adsbygoogle = window.adsbygoogle || []).push({
	//		google_ad_client: "ca-pub-8365330523291002",
	//		enable_page_level_ads: true
	//	});
		</script>
	--->

    <script>
    // 百度统计代码
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?8ba332e6517ae0ba8a13339285d97bb3";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
    </script>


    <script>
    // google analytics
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-109057291-1', 'auto');
      ga('send', 'pageview');

    </script>



<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
    tex2jax: { inlineMath: [["$","$"],["\\(","\\)"]] },
    "HTML-CSS": {
      linebreaks: { automatic: true, width: "container" }
    }
});
</script>
<script type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<!---   谷歌cse站内搜索-->
<!--- <script async src="https://cse.google.com/cse.js?cx=011772597085732398296:uzswyrqhpft"></script>
--->
	

</head>


  <body>

    <div class="wrapper">
    <center>
        <a href= http://www.gov.cn/zhengce/content/2020-04/03/content_5498472.htm>
            <h1> </h1><b> </b>
        </a>
        本站镜像站点        
        <a href="http://blog.cndaqiang.workers.dev//2020/04/26/delta/">cloudflare</a>,
        <a href="http://cndaqiang.gitee.io//2020/04/26/delta/">gitee</a>,
        <a href="https://cndaqiang.github.io//2020/04/26/delta/">Github</a>.
        <a href="https://github.com/cndaqiang/cndaqiang.github.io/">博客源码</a>
    </center>
</div>
<header id="top">
    <div class="wrapper">
      
        <a href="/" class="brand">cndaqiang</a>
        <small>Web Linux DFT</small> 
        
        <button id="headerMenu" class="menu"><i class="fa fa-bars"></i></button>
        <nav id="headerNav">
            <ul>
                <li>
                    
                    <a href="/">
                    
                        <i class="fa fa-home"></i>Home
                    </a>
                </li>

                
                    
                    <li>
                        
                        <a href="/archive/">
                        
                            <i class="fa fa-archive"></i>文章
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/category/">
                        
                            <i class="fa fa-th-list"></i>分类
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/tag/">
                        
                            <i class="fa fa-tags"></i>标签
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/collection/">
                        
                            <i class="fa fa-bookmark"></i>收藏
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/about/">
                        
                            <i class="fa fa-heart"></i>关于
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/Search/">
                        
                            <i class="fa fa-icon-sousuo"></i>Search
                        </a>
                    </li>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>
        </nav>
    </div>
</header>


        <!---文章页面--->

<div class="page clearfix" post>
    <div class="left">
        <h1>关于变分法的一些整理</h1>
        <div class="label">

            <div class="label-card">
                <i class="fa fa-calendar"></i>2020-04-26
            </div>

            <div class="label-card">
                <i class="fa fa-user"></i>cndaqiang
                
            </div>

            <div class="label-card">
                
            </div>

            <div class="label-card">
            


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#PHY" title="Category: PHY" rel="category">PHY</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


            </div>

            <div class="label-card">
            
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <!--a href="/tag/#QE" title="Tag: QE" rel="tag">QE</a-->
        <a href="/tag/#QE" title="Tag: QE" rel="tag">QE</a>&nbsp;
    
        <!--a href="/tag/#DFT" title="Tag: DFT" rel="tag">DFT</a-->
        <a href="/tag/#DFT" title="Tag: DFT" rel="tag">DFT</a>&nbsp;
    
        <!--a href="/tag/#Fortran" title="Tag: Fortran" rel="tag">Fortran</a-->
        <a href="/tag/#Fortran" title="Tag: Fortran" rel="tag">Fortran</a>
    
  

</span>


            </div>
            <!--- 2020-01-17 RSS-->
            <div class="label-card">
                <a href="/feed.xml" title="RSS"><i class="fa fa-rss-square" aria-hidden="true"></i>RSS</a>
            </div>

            <div class="label-card">
                <a href="https://github.com/cndaqiang/cndaqiang.github.io" title="RSS"><i class="fa fa-thumbs-o-up" aria-hidden="true"></i>Star</a>
            </div>
            
            <!--- github start , copy from https://github.com/mdo/github-buttons--->
            <!---
            <div>
                <iframe src="/html_script/github-btn.html?user=cndaqiang&repo=cndaqiang.github.io&type=star&count=true&size=large" frameborder="0" scrolling="0" width="160px" height="30px"></iframe>
            </div>
            --->

        </div>
        
        <hr>
        <article itemscope itemtype="http://schema.org/BlogPosting">
        <ul id="markdown-toc">
  <li><a href="#参考" id="markdown-toc-参考">参考</a></li>
  <li><a href="#数学" id="markdown-toc-数学">数学</a>    <ul>
      <li><a href="#泛函" id="markdown-toc-泛函">泛函</a>        <ul>
          <li><a href="#泛函变分的定义" id="markdown-toc-泛函变分的定义"><strong>泛函变分的定义</strong></a></li>
        </ul>
      </li>
      <li><a href="#函数的变分的运算法则" id="markdown-toc-函数的变分的运算法则">函数的变分的运算法则</a></li>
      <li><a href="#泛函导数" id="markdown-toc-泛函导数">泛函导数</a>        <ul>
          <li><a href="#泛函导数的运算规则" id="markdown-toc-泛函导数的运算规则"><strong>泛函导数的运算规则</strong></a></li>
          <li><a href="#泛函导数的求法" id="markdown-toc-泛函导数的求法"><strong>泛函导数的求法</strong></a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#类薛定谔方程的变分解法" id="markdown-toc-类薛定谔方程的变分解法">(类)薛定谔方程的变分解法</a>    <ul>
      <li><a href="#薛定谔变分原理" id="markdown-toc-薛定谔变分原理">薛定谔变分原理</a></li>
      <li><a href="#rayleigh-ritz瑞利-里兹变分法" id="markdown-toc-rayleigh-ritz瑞利-里兹变分法">Rayleigh-Ritz(瑞利-里兹)变分法</a></li>
    </ul>
  </li>
  <li><a href="#泛函的解法" id="markdown-toc-泛函的解法">泛函的解法</a>    <ul>
      <li><a href="#rayleigh-ritz-变分法" id="markdown-toc-rayleigh-ritz-变分法">Rayleigh-Ritz 变分法</a>        <ul>
          <li><a href="#广义本征值算子方程的变分解法" id="markdown-toc-广义本征值算子方程的变分解法">广义本征值算子方程的变分解法</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#密度泛函中的变分" id="markdown-toc-密度泛函中的变分">密度泛函中的变分</a>    <ul>
      <li><a href="#hk-inhomogeneous-electron-gas" id="markdown-toc-hk-inhomogeneous-electron-gas">HK: Inhomogeneous electron gas</a></li>
      <li><a href="#h-k能量变分" id="markdown-toc-h-k能量变分">H-K能量变分</a></li>
      <li><a href="#levy-constrained-search" id="markdown-toc-levy-constrained-search">Levy constrained-search</a></li>
      <li><a href="#kohn-sham-scheme" id="markdown-toc-kohn-sham-scheme">Kohn-Sham Scheme</a></li>
      <li><a href="#kohn-sham-schemen-representability" id="markdown-toc-kohn-sham-schemen-representability">Kohn-Sham Scheme:N-representability</a></li>
      <li><a href="#关于hk-ks的备注" id="markdown-toc-关于hk-ks的备注">关于HK, KS的备注</a></li>
    </ul>
  </li>
  <li><a href="#赝势时的ks方程" id="markdown-toc-赝势时的ks方程">赝势时的KS方程</a>    <ul>
      <li><a href="#nc赝势" id="markdown-toc-nc赝势">NC赝势</a></li>
      <li><a href="#uspp" id="markdown-toc-uspp">USPP</a></li>
    </ul>
  </li>
</ul>

<h2 id="参考">参考</h2>
<ul>
  <li>@Chen Xiang Jun. variational method</li>
  <li>@犊犊的小棚棚.<a href="https://www.jlao.net/emnotes/">计算电磁学笔记</a></li>
  <li>Hohenberg P, Kohn W. Inhomogeneous electron gas[J]. Physical review, 1964, 136(3B): B864.</li>
  <li>Quantum Theory of Many Particle Systems@Xin-Zheng Li</li>
  <li><a href="https://books.google.com/books?id=v1YhAwAAQBAJ">Martin, R. M., &amp; Martin, R. M. (2004). Electronic structure: basic theory and practical methods. Cambridge university press.</a></li>
  <li>密度泛函理论与应用@张余洋, 郑庆荣</li>
  <li><a href="https://astrojacobli.github.io/blog/2017/12/%E6%95%B0%E5%AD%A6%E7%89%A9%E7%90%86%E6%96%B9%E6%B3%95">变分法初步</a>@astrojacobli</li>
  <li>Walker B, Gebauer R. Ultrasoft pseudopotentials in time-dependent density-functional theory[J]. The Journal of chemical physics, 2007, 127(16): 164106.</li>
  <li>电子结构理论与计算@李震宇</li>
  <li>Kohn W, Sham L J. Self-consistent equations including exchange and correlation effects[J]. Physical review, 1965, 140(4A): A1133.</li>
</ul>

<h2 id="数学">数学</h2>
<h3 id="泛函">泛函</h3>
<p>泛函<script type="math/tex">F[f]</script>是整个函数<script type="math/tex">f</script>的映射,不仅在密度泛函领域，在很多公式中也常用到波函数变分.</p>

<h4 id="泛函变分的定义"><strong>泛函变分的定义</strong></h4>
<p>一般中用中括号<script type="math/tex">[ \; ]</script>表示泛函,如
\begin{array}{l}
\label{A1}
F[f]=\int_{x_{min}}^{x_{max}} (f(x))^\alpha dx \tag{A.1}
\end{array}
<strong>泛函的变分定义为</strong>
\begin{array}{l}
\label{A2}
\delta F[f] = F[f+\delta f] - F[f] =  \displaystyle{   \int_{x_{min}}^{x_{max}}   \frac{\delta F}{\delta f(x)} \delta f(x) dx  } \,  \tag{A.2}
\end{array}
where, <script type="math/tex">\cfrac{\delta F}{\delta f(x)}</script>是<script type="math/tex">F[f]</script>的关于<script type="math/tex">f(x)</script>泛函导数, 对应<script type="math/tex">f(x)</script>仅在<script type="math/tex">x</script>点处变化<script type="math/tex">\delta f(x)</script>,引起的<script type="math/tex">\delta F</script>的变化.<br />
积分代表,在各个点<script type="math/tex">f(x)</script>的变化<script type="math/tex">\delta f(x)</script>,对应引起<script type="math/tex">F</script>的变化<script type="math/tex">\displaystyle{  \frac{\delta F}{\delta f(x)} \delta f(x) }</script>的累计.<br />
<em>公式<script type="math/tex">\ref{A2}</script>是个定义,定义,定义</em>.</p>
<blockquote>
  <p>@<a href="https://books.google.com/books?id=v1YhAwAAQBAJ">Martin, R. M., &amp; Martin, R. M. (2004). Electronic structure: basic theory and practical methods. Cambridge university press.</a>中给出的<script type="math/tex">E_{xc}</script>的泛函变分
<img src="/uploads/2020/04/mara2.png" alt="" /></p>
</blockquote>

<h3 id="函数的变分的运算法则">函数的变分的运算法则</h3>
<p>对于一元函数,</p>
<ol>
  <li>只考虑函数的一级变分</li>
  <li>
    <p>变分运算是线性运算,其中<script type="math/tex">\lambda</script> 和 <script type="math/tex">\mu</script> 是常数.
\begin{array}{l}
\label{delta1}
\delta (\lambda F+\mu G) = \lambda \delta F +  \mu  \delta G  \ \tag{0.1}
\end{array}</p>
  </li>
  <li>
    <p>函数乘积的变分法则
\begin{array}{l}
\label{delta2}
\delta (FG) = \delta F G + F \delta G \ \tag{0.2}
\end{array}</p>
  </li>
  <li>
    <p>变分运算和微分或微商运算可交换次序
\begin{array}{l}
\label{delta3}
\delta \cfrac{dy}{dr} = \cfrac{\delta y}{dr} \, , \, i.e. \, \delta y’ = (\delta y)’ \ \tag{0.3}
\end{array}</p>
  </li>
  <li>
    <p>变分运算和积分(微分的逆运算)也可以交换次序,
\begin{array}{l}
\label{delta4}
\delta \int F dr = \int \delta F dr \ \tag{0.4}
\end{array}</p>
  </li>
  <li>复合函数的变分运算, 其法则和微分运算完全相同, 只要简单地将微分运算中的 “d” 换成 “δ” 即可. 例如,
\begin{array}{l}
\label{delta5}
\delta F(r,n,n’) = \cfrac{\partial F}{\partial n} \delta n + \cfrac{\partial F}{\partial n’} \delta n’  \tag{0.5}
\end{array}
这里注意, 引起 F 变化的原因, 是函数 y 的变分, 而非自变量 x.</li>
</ol>

<h3 id="泛函导数">泛函导数</h3>
<h4 id="泛函导数的运算规则"><strong>泛函导数的运算规则</strong></h4>
<p>From <a href="https://zh.wikipedia.org/wiki/%E6%B3%9B%E5%87%BD%E5%AF%BC%E6%95%B0">wiki</a>
与函数的导数类似，泛函导数满足下列的性质：（其中 <script type="math/tex">F[\rho]</script> 和 <script type="math/tex">G[\rho]</script> 为两个泛函）<br />
线性：<br />
\begin{array}{l}
\label{delta6}
\cfrac {\delta (\lambda F+\mu G)[\rho ]}{\delta \rho (x)}=\lambda {\cfrac {\delta F[\rho ]}{\delta \rho (x)}} + \mu \cfrac {\delta G[\rho ]}{\delta \rho (x)} \tag{0.6}  <br />
\end{array}</p>

<p>积法则：
\begin{array}{l}
\label{delta7}
\cfrac {\delta (FG)[\rho ]}{\delta \rho (x)}={\cfrac {\delta F[\rho ]}{\delta \rho (x)}}G[\rho ]+F[\rho ]{\cfrac {\delta G[\rho ]}{\delta \rho (x)}} \tag{0.7}  <br />
\end{array}</p>

<p>链式法则：<br />
我对wiki中的<script type="math/tex">\eqref{delta8}</script>与<script type="math/tex">\eqref{delta9}</script>做了一些更改<br />
若 F 和 G 为两个泛函，G是泛函函数<script type="math/tex">G[\rho](x)</script>, 则</p>

<script type="math/tex; mode=display">\begin{array}{l}
\label{delta8}
\cfrac {\delta F[G[\rho ]]}{\delta \rho (y)} 
= \displaystyle{ 
\int dx
\cfrac{\delta F[G(\rho )]}{\delta G[\rho] (x)} \cfrac {\delta G[\rho ](x)}{\delta \rho (y)} 
\tag{0.8}  
}
\end{array}</script>

<p>若当中的 G 为一个普通的可导函数 g，即<script type="math/tex">G[\rho(y)](x)=g(\rho(x))</script>, 则
<script type="math/tex">\cfrac{\delta G[\rho ](x)}{\delta \rho (y)} = \cfrac{dg(\rho)}{d \rho (y)} \delta(x-y)</script>, 所以上式化为</p>

<script type="math/tex; mode=display">\begin{array}{l}
\label{delta9}
\cfrac {\delta F[g(\rho )]}{\delta \rho (y)}=\cfrac {\delta F[g(\rho )]}{\delta g[\rho ](y) } \cfrac {dg(\rho )}{d \rho (y)}  \tag{0.9}
\end{array}</script>

<h4 id="泛函导数的求法"><strong>泛函导数的求法</strong></h4>
<p>直接使用这里的结果,<br />
对于给定的泛函
\begin{array}{l}
\label{delta10}
{ F[\rho ]=\int f({\boldsymbol {r}},\rho ({\boldsymbol {r}}),\nabla \rho ({\boldsymbol {r}}))\,d{\boldsymbol {r}},} \tag{0.10}
\end{array}
其泛函导数为
\begin{array}{l}
\label{delta11}
{ {\cfrac {\delta F}{\delta \rho ({\boldsymbol {r}})}}={\cfrac {\partial f}{\partial \rho }}-\nabla \cdot {\cfrac {\partial f}{\partial \nabla \rho }}}  \tag{0.11}
\end{array}</p>

<p>对于Hartree势能<script type="math/tex">E_{Hartree} = \cfrac{1}{2} \int \cfrac{\rho(r)\rho(r')}{|r-r'|} drdr'</script>,则变分倒数为
\begin{array}{l}
\label{delta12}
\cfrac {\delta E_{Hartree}}{\delta \rho} &amp;=\cfrac{1}{2} \left [ \int \cfrac{\rho(r’)}{|r-r’|} dr’ + \int \cfrac{\rho(r)}{|r-r’|} dr \right ] <br />
&amp;= \int \cfrac{\rho(r’)}{|r-r’|} dr’  <br />
\tag{0.12}
\end{array}</p>

<blockquote>
  <p>推倒见
<img src="/uploads/2020/04/deltawiki.png" alt="" /></p>
</blockquote>

<h2 id="类薛定谔方程的变分解法">(类)薛定谔方程的变分解法</h2>
<ul>
  <li>@Chen Xiang Jun. variational method</li>
</ul>

<p><strong>薛定谔变分原理证明了变分法和解(类)薛定谔定态方程是等价的，</strong><br />
<strong>瑞利-里兹(Rayleigh-Ritz)变分法提供了变分法求本征态的途径.</strong><br />
类薛定谔方程如单粒子的KS方程.</p>

<h3 id="薛定谔变分原理">薛定谔变分原理</h3>

<p>系统的状态求解,可以通过量子力学基本假设解薛定谔方程，也可以通过过薛定谔变分求极值得到体系的定态波函数.</p>
<blockquote>
  <p><strong>量子力学基本假设</strong>:设体系的哈密顿量为 <script type="math/tex">H</script>(不显含时间<script type="math/tex">t</script>)，则体系束缚定态的能谱和波函数可以通过求解定态 Schrödinger 方程
\begin{equation}
\label{eq1}
H\Psi_n = E_n \Psi_n, \; n=0,1,2,3,…\tag{1.1}
\end{equation}</p>
</blockquote>

<blockquote>
  <p><strong>薛定谔变分原理</strong>与量子力学基本假设等价，其描述为:<br />
设<script type="math/tex">\phi</script>是任一可归一化的函数，作泛函
\begin{equation}
\label{eq2}
E[\phi]
=\cfrac{\langle \phi |H| \phi \rangle}{\langle \phi | \phi \rangle} 
= \cfrac{ \int  \phi ^{\ast} H \phi d\tau }{ \int  \phi ^{\ast}  \phi d\tau  } 
\tag{1.2}
\end{equation}
是实数，则使<script type="math/tex">E[\phi]</script>取极值的<script type="math/tex">\phi</script>都是体系哈密顿算符<script type="math/tex">H</script>的束缚定态本征函数,而<script type="math/tex">E[\phi]</script>是相应的能量本征值.</p>
</blockquote>

<p><strong>薛定谔变分原理证明</strong><br />
将<script type="math/tex">\eqref{eq2}</script>写作
\begin{equation}
\label{eq3}
E \langle \phi | \phi \rangle = \langle \phi |H| \phi \rangle\tag{1.3}
\end{equation}
左右两边对<script type="math/tex">\phi</script>变分，有
\begin{equation}
\label{eq4}
 \delta E \langle \phi | \phi \rangle + E \left [ \langle \delta \phi | \phi \rangle   + \langle  \phi | \delta \phi \rangle  \right  ]  = \langle \delta \phi | H | \phi \rangle  + \langle  \phi | H |\delta \phi \rangle<br />
\tag{1.4}
\end{equation}
如果<script type="math/tex">\delta E=0</script>,则
\begin{equation}
\label{eq5}
\langle \delta \phi | H - E | \phi \rangle  + \langle  \phi | H -E |\delta \phi \rangle  = 0
\tag{1.5}
\end{equation}
将上式<script type="math/tex">\eqref{eq5}</script>中的<script type="math/tex">\delta \phi</script>替换为<script type="math/tex">i\delta \phi</script>,则
\begin{equation}
\label{6}
-i \langle \delta \phi | H - E | \phi \rangle  + i \langle  \phi | H -E |\delta \phi \rangle  = 0
\tag{1.6}
\end{equation}
即<script type="math/tex">a+b=0,\; \text{and} \; i(-a+b)=0</script>,所以</p>

<script type="math/tex; mode=display">\begin{equation}
\label{eq7}
\langle  \delta \phi | H -E | \phi \rangle = \int  \delta \phi ^{\ast} (H-E) \phi d\tau = 0 \\
\langle \delta \phi | H - E | \phi \rangle  =  \langle  \phi | H -E |\delta \phi \rangle 
\tag{1.7}
\end{equation}</script>

<p>由于<script type="math/tex">\delta \phi</script>的任意性,所以</p>

<script type="math/tex; mode=display">\begin{equation}
\label{eq8}
(H -E       ) | \phi \rangle = 0, \; i.e. H | \phi \rangle= E | \phi \rangle \\
(H^{\ast} -E)  | \phi^{\ast} \rangle = 0, \; i.e. H^{\ast} | \phi \rangle= E | \phi^{\ast} \rangle
\tag{1.8}
\end{equation}</script>

<p>等价于薛定谔方程<script type="math/tex">\eqref{eq1}</script>.<br />
薛定谔变分法还可用于计算基态能量的上限,即若<script type="math/tex">\phi=\sum_i c_i | \psi_i \rangle</script>, where <script type="math/tex">|\psi_i \rangle</script>是<script type="math/tex">H</script>的本征态,则
\begin{equation}
\label{eq9}
E[\phi]
=\cfrac{\langle \phi |H| \phi \rangle}{\langle \phi | \phi \rangle} 
= \cfrac{ \int  \phi ^{\ast} H \phi d\tau }{ \int  \phi ^{\ast}  \phi d\tau  } 
\geq E[\psi_0]\tag{1.9}
\end{equation}</p>

<p>这个就是常见问题，太简单不展开证明了.</p>

<h3 id="rayleigh-ritz瑞利-里兹变分法">Rayleigh-Ritz(瑞利-里兹)变分法</h3>

<p>对于试探波函数<script type="math/tex">\phi</script>可用若干参数表示,如
\begin{equation}
\label{eq10}
\phi  = \psi(q,c_1,c_2,c_3,…) \tag{1.10}
\end{equation}
<script type="math/tex">q</script>代表体系的全部坐标, <script type="math/tex">c_1,c_2,c_3,...</script>是待定参数. 则<script type="math/tex">\eqref{eq2}</script>,变为
\begin{equation}
\label{eq11}
E[\psi]= \cfrac{\langle \phi |H| \phi \rangle}{\langle \phi | \phi \rangle} = E(c_1,c_2,c_3,…)
\tag{1.11}
\end{equation}
根据极值变分原理，<script type="math/tex">\delta E =0</script>,按照<script type="math/tex">\eqref{delta5}</script>, <script type="math/tex">\delta E</script>为<br />
(下式是求和,对所有参量进行变分)
\begin{equation}
\label{eq12}
\delta E  = \sum_i \cfrac{\partial E }{\partial c_i} \delta c_i =0 \tag{1.12}
\end{equation}
因为对任意<script type="math/tex">\delta c_i</script>都成立,则
\begin{equation}
\label{eq13}
\cfrac{\partial E }{\partial c_i} = 0, \; (i=1,2,3…) \tag{1.13}
\end{equation}
<br /><br /><br /><br />
在实际情况,我们常采用<script type="math/tex">N</script>个现行无关的函数<script type="math/tex">\chi_i</script>来构建试探波函数<script type="math/tex">\phi</script>,
\begin{equation}
\label{eq14}
\phi  = \sum_i c_i \chi_i  \tag{1.14}
\end{equation}
其中<script type="math/tex">c_i</script>是组合系数,也是待定的变分参数，此时<script type="math/tex">E[\psi]</script>为,
\begin{equation}
\label{eq15}
E[\phi]  = \cfrac{ \sum_{i=1}^N \sum_{j=1}^N c_i^{\ast} c_j H_{i,j}}{ \sum_{i=1}^N \sum_{j=1}^N c_i^{\ast} c_j S_{i,j} }
\tag{1.15}
\end{equation}
where, <script type="math/tex">H_{i,j} = \langle \chi_i | H | \chi_j \rangle</script>, and <script type="math/tex">S_{i,j} = \langle \chi_i | \chi_j \rangle</script>,如果<script type="math/tex">\chi_i</script>正交, 则<script type="math/tex">S</script>为单位矩阵.<br />
将<script type="math/tex">\eqref{eq15}</script>改写为</p>

<script type="math/tex; mode=display">\begin{equation}
\label{eq16}
\sum_{i=1}^N \sum_{j=1}^N c_i^{\ast} c_j H_{i,j}  - E[\phi] \sum_{i=1}^N \sum_{j=1}^N c_i^{\ast} c_j S_{i,j} == 0  
\tag{1.16}
\end{equation}</script>

<p>与之前相同<script type="math/tex">\eqref{eq12}</script>对两边进行变分,利用<script type="math/tex">\cfrac {\partial E}{\partial c_i^{\ast}} = 0</script>,以及<script type="math/tex">\delta c_i^{\ast}</script>的任意性,<strong>得到<script type="math/tex">N</script>个关于<script type="math/tex">c_j</script>的线性方程组</strong><br />
(注:在变分的时候,<script type="math/tex">c_i</script>与<script type="math/tex">c_i^{\ast}</script>已经是两个参数了,这样理解, 任何一个的变分 <script type="math/tex">\delta c_i, \; \text{or} \; \delta c_i^{\ast}</script>, 系统的变化,如<script type="math/tex">\delta E</script>都为0, 因此可以是为两个参数. 另对任意一个变分的结果其实是一样的，就如同<script type="math/tex">\eqref{eq5}</script>中的<script type="math/tex">\psi</script>或<script type="math/tex">\psi^{\ast}</script>的变分,最后都一样,把结果的方程做一个共厄就得到另一个方程了)
\begin{equation}
\label{eq17}
\sum_{j=1}^N c_j ( H_{i,j} - E S_{i,j} ) = 0, \; i=i,1,2,…,N
\tag{1.17}
\end{equation}
该<strong>线性方程组</strong><script type="math/tex">\eqref{eq17}</script>对应本征值问题<script type="math/tex">Az=\epsilon Bz</script>,把所有的本征态，本征值写成矩阵的形式，就是
\begin{equation}
\label{eq18}
\mathbf{HC=SCE}
\tag{1.18}
\end{equation}
当<script type="math/tex">\chi_i</script>正交时,<script type="math/tex">S</script>为单位矩阵, <script type="math/tex">\eqref{eq18}</script>变为
\begin{equation}
\label{eq19}
\mathbf{HC=CE}
\tag{1.19}
\end{equation}
通过计算机求解<script type="math/tex">\eqref{eq18}</script>或<script type="math/tex">\eqref{eq19}</script>就可以得到一系列的本征值<script type="math/tex">\epsilon_n</script>,本征态<script type="math/tex">C_n</script>.<br />
求解示例<a href="/2019/08/04/HC_SCE/">Fortran使用Scalapack求解HC=SCE</a>,<script type="math/tex">\eqref{eq18}</script>与<script type="math/tex">\eqref{eq17}</script>等价性证明
<img src="/uploads/2020/04/hcsce.jpg" alt="" /></p>

<h2 id="泛函的解法">泛函的解法</h2>
<ul>
  <li>@犊犊的小棚棚.<a href="https://www.jlao.net/emnotes/">计算电磁学笔记</a></li>
</ul>

<p>如@犊犊的小棚棚 在他的电磁学笔记中提到的</p>
<blockquote>
  <p>同一电磁场问题可以从微分方程、积分方程、变分方程三类不同的方程形式着手求解, 结果
是等价的. 但微分方程和积分方程较难求解, 只能依靠泛函方法求得近似解或函数的完备序列:
(若泛函的每个可取函数都可以用某个函数序列的线性组合任意地逼近, 则该序列为完备序列.
通常, 本征函数系都是正交函数的完备序列. )</p>
</blockquote>

<p>我们在解薛定谔方程时，也是可以从微分方程(<em>薛定谔方程</em>)，变分方程(<em>薛定谔变分原理</em>)的方法去解决，但是微分方程较难求解，使用变分法更容易实现。</p>

<blockquote>
  <p>泛函解法的基本思想，
\begin{equation}
\label{fun1}
U(r)=\sum_i c_i \chi_i(r)
\tag{2.1}
\end{equation}
where,<script type="math/tex">\lbrace \chi_i(r) \rbrace</script>是线性无关函数的完备序列. 该函数序列的函数当作函数空间的基
或坐标, 称为<strong>基函数</strong>或坐标函数, 则展开项<script type="math/tex">c_i</script>为<script type="math/tex">U</script>在函数空间的坐标分量. 
若选取正交函数基序列时, <script type="math/tex">c_i</script> 是函数空间中的点<script type="math/tex">U</script>对基<script type="math/tex">\chi_i</script>投影的意义.
一般情况下只能求<script type="math/tex">N</script>级近似解
\begin{equation}
\label{fun2}
U(r)=\sum_i^N c_i \chi_i(r)
\tag{2.2}
\end{equation}
且<script type="math/tex">lim_{n \to \infty} \sum_i^N c_i \chi_i(r)=U(r)</script>, 所以基函数选取是关键, 影响收敛速度及求解繁简程度.
<strong>泛函解法分为变分法和加权余量法两大类. 总是将未知函数的变分方程或线性算子方程转化为展开系数序列的线性代数方程组.</strong></p>
</blockquote>

<h3 id="rayleigh-ritz-变分法">Rayleigh-Ritz 变分法</h3>
<p>对于泛函<script type="math/tex">J[U(r)]</script>的变分问题</p>

<script type="math/tex; mode=display">\begin{equation}
\label{fun3}
\left \lbrace
\begin{array}{l}
\delta J[U(r)] = 0 \\
U(r_b)|_{r_b \in S[V]} =0 (\text{或无边界条件})
\end{array}
\right.
\tag{2.3}
\end{equation}</script>

<p><strong>选取满足所给边界条件的线性无关完备函数序列<script type="math/tex">\chi_i</script>为基</strong>,构造<script type="math/tex">N</script>级近似解<script type="math/tex">U^N</script>,则变分方程<script type="math/tex">\eqref{fun3}</script>变为近似变分方程
\begin{equation}
\label{fun4}
\delta J [U^N(r)]=\delta J \left [ \sum_i c_i \chi_i(r) \right ] = 0
\tag{2.4}
\end{equation}
因为<script type="math/tex">\chi_i</script>已知,所以泛函<script type="math/tex">J[U^N(r)]</script>仅是<script type="math/tex">c_i</script>与<script type="math/tex">c_i^{\ast}\; (i=1,2,...N)</script>的函数，<script type="math/tex">\eqref{fun4}</script>等价于多元函数的极值条件<script type="math/tex">\eqref{fun5}</script>:
\begin{equation}
\label{fun5}
\cfrac{\partial J [U^N(r)]}{\partial c_i} = 0, \; \text{and}, \; \cfrac{\partial J [U^N(r)]}{\partial c_i^{\ast}} = 0, \; i = 1,2,…,N
\tag{2.5}
\end{equation}</p>

<p><strong>针对不同形式的泛函，有不同的变分方法</strong>,@犊犊的小棚棚.<a href="https://www.jlao.net/emnotes/">计算电磁学笔记</a>给出了三种情况，这里我们只考虑第三种情况:<strong>广义本征值算子方程的变分解</strong></p>

<h4 id="广义本征值算子方程的变分解法">广义本征值算子方程的变分解法</h4>
<p>就像薛定谔方程可以转化为薛定谔变分方程,广义本征值算子方程<script type="math/tex">AU=\lambda BU</script>也可以转化为的等价变分方程:
\begin{equation}
\label{fun6}
J[U]=\cfrac{\langle AU|U \rangle }{\langle BU|U \rangle } = \lambda = min
\tag{2.6}
\end{equation}
@犊犊的小棚棚给出的是<script type="math/tex">\eqref{fun6}</script>,我认为等价于<script type="math/tex">\eqref{fun6Q}</script>,之后的使用<script type="math/tex">\eqref{fun6Q}</script>继续推导
\begin{equation}
\label{fun6Q}
J[U]=\cfrac{\langle U| A | U \rangle }{\langle U| B | U \rangle } = \lambda = min
\tag{2.6.Q}
\end{equation}
和薛定谔变分可谓一样. 使用<script type="math/tex">N</script>级近似的<script type="math/tex">U</script> <script type="math/tex">\eqref{fun2}</script>带入<script type="math/tex">\eqref{fun6Q}</script>,得
\begin{equation}
\label{fun7}
J[U^N]=\cfrac{\langle  \sum_i^N c_i \chi_i(r) | A | \sum_j^N c_j \chi_j(r)  \rangle }{\langle  \sum_i^N c_i \chi_i(r) | B | \sum_i^N c_j \chi_j(r)  \rangle } = \lambda^N
\tag{2.7}
\end{equation}
从而
<script type="math/tex">\begin{equation}
\label{fun8}
\begin{array}{l}
\sum_{i,j}^N A_{i,j}  c_i^{\ast}c_j - \lambda^N \sum_{i,j}^N B_{i,j}  c_i^{\ast}c_j    = 0 \\
\text{with} \\
A_{i,j} = \langle  \chi_i(r) | A |   \chi_j(r)  \rangle \ \\
B_{i,j} = \langle  \chi_i(r) | B |   \chi_j(r)  \rangle \ 
\end{array}
\tag{2.8}
\end{equation}</script></p>

<p>就像<script type="math/tex">\eqref{fun4}\eqref{fun5}</script>,对<script type="math/tex">\eqref{fun8}</script>的变分等价于偏导问题,把<script type="math/tex">\eqref{fun8}</script>对<script type="math/tex">c_i^{\ast}</script>求偏导得,
\begin{equation}
\label{fun9}
\sum_j^N \left [ A_{i,j} -\lambda B_{i,j} \right ] c_j =0 \; i=1,2,…,N
\tag{2.9}
\end{equation}
同<script type="math/tex">\eqref{eq18}</script>可以化成矩阵计算
\begin{equation}
\label{fun10}
\mathbf{AC=BCE}
\tag{2.10}
\end{equation}
当<script type="math/tex">B=1</script>时, <script type="math/tex">\eqref{fun10}</script>中的<script type="math/tex">\mathbf{B}=\mathbf{S}</script>,就变成了薛定谔方程的变分问题<script type="math/tex">\eqref{eq18}</script>.</p>

<h2 id="密度泛函中的变分">密度泛函中的变分</h2>
<ul>
  <li>Hohenberg P, Kohn W. Inhomogeneous electron gas[J]. Physical review, 1964, 136(3B): B864.</li>
  <li>Quantum Theory of Many Particle Systems@Xin-Zheng Li</li>
  <li><a href="https://books.google.com/books?id=v1YhAwAAQBAJ">Martin, R. M., &amp; Martin, R. M. (2004). Electronic structure: basic theory and practical methods. Cambridge university press.</a></li>
  <li>密度泛函理论与应用@张余洋, 郑庆荣</li>
  <li>电子结构理论与计算@李震宇</li>
  <li>Kohn W, Sham L J. Self-consistent equations including exchange and correlation effects[J]. Physical review, 1965, 140(4A): A1133.</li>
</ul>

<h3 id="hk-inhomogeneous-electron-gas">HK: Inhomogeneous electron gas</h3>
<p>HK的文章原文:
<img src="/uploads/2020/04/hk1.png" alt="" />
<br /><br />
<strong>直译过来就是,本文处理了在给定外势<script type="math/tex">v(r)</script>下，一个相互作用电子气体的基态问题. 存在一个与外势<script type="math/tex">V_{ext}(r)</script>无关的,密度的<em>universal</em>泛函<script type="math/tex">F[n(r)]</script>,泛函<script type="math/tex">E[n]=\int dr V_{ext}(r)\rho(r) +F[n(r)]</script>的取最小值时的密度<script type="math/tex">n</script>对应在外势场<script type="math/tex">V_{ext}(r)</script>作用下的系统基态密度.</strong>
<br /><br /></p>

<p>同时HK在文章的前两部分讨论了基本公式的证明，就是被后人成为H-K的第一、二定理.</p>
<ul>
  <li><strong>I. The Density as Basic Variable</strong>
<img src="/uploads/2020/04/hk-1.png" alt="" />
    <blockquote>
      <p>Theorem I: 对于在一个外势<script type="math/tex">V_{ext}(r)</script>作用下的多体相互作用系统, 外势<script type="math/tex">V_{ext}(r)</script>(除了一个常数)被基态密度决定<br />
Corollary I: 因为外势被密度决定，所以哈密顿量也被决定，进而<strong>任意态的多体波函数</strong>被确定。Therefore,<strong>系统的所有性质由基态密度<script type="math/tex">n_0(r)</script></strong>, in principle, 激发态的性质也可以由exact的密度泛函理论给出</p>
    </blockquote>
  </li>
  <li><strong>II. The Variational Principle</strong>
<img src="/uploads/2020/04/hk20.png" alt="" />
<img src="/uploads/2020/04/hk21.png" alt="" />
<br /><strong>…………</strong><br />
<img src="/uploads/2020/04/hk-2.png" alt="" />
    <blockquote>
      <p>Theoem II, ，如果我们知道密度<script type="math/tex">n(r)</script>的通用泛函<script type="math/tex">F_{HK}[n]</script>的精确形式,<strong>对于任意的外势<script type="math/tex">V_{ext}(r)</script>，系统严格的基态能量是泛函<script type="math/tex">E[n]=\int dr V_{ext}(r)\rho(r) +F_{HK}[\rho]</script>的全局最小值(v-representability)</strong>，严格的基态密度<script type="math/tex">n_0(r)</script>是泛函<script type="math/tex">E[n]</script>最小值时的密度<script type="math/tex">n(r)</script><br />
Corollary II: <strong>能量泛函<script type="math/tex">E(n)</script>足够决定体系的基态能量和基态密度</strong>. In general, 激发态的形式需要其他法的方法来确定。</p>
    </blockquote>
  </li>
</ul>

<p>HK定理一建立了密度泛函的基础，密度决定一切，将<script type="math/tex">3N</script>的问题变成<script type="math/tex">3</script>的问题<br />
HK定理二提供了求解基态密度及基态的方法:对能量泛函<script type="math/tex">E[n]</script>进行变分<br /></p>

<p><strong>HK定理处理的仍是多体系统,密度、能量等均是多体的，定理的证明也使用多体波函数.</strong><br />
<strong>HK定理并没有给出多体密度泛函<script type="math/tex">F_{HK}[n]</script>的具体表达式</strong>,论文中仅对一些，模型<script type="math/tex">F_{HK}[n]</script>进行了讨论.</p>

<h3 id="h-k能量变分">H-K能量变分</h3>
<p><strong>操作</strong>:<br />
在<script type="math/tex">n(r) \geq 0</script>, <script type="math/tex">\int dr n(r) = N</script>,<strong>且<script type="math/tex">n(r)</script>由某一外势对应的基态波函数<script type="math/tex">\Psi</script>产生条件下.</strong><br />
系统严格的基态能量是能量泛函<script type="math/tex">\eqref{dft2}</script>的全局最小值,严格的基态密度<script type="math/tex">n_0(r)</script>是泛函<script type="math/tex">E[n]</script>最小值时的密度<script type="math/tex">n(r)</script>.<br />
(根据薛定谔变分原理:<script type="math/tex">v \to H \to \Psi_i, \, i=0,1,2,3,...</script>)</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{equation}
\label{dft1}
\begin{array}{l}
E_{HK}[n] &= \displaystyle{  \int dr V_{ext}(r)n(r)  +F_{HK}[n] } \\
&= \displaystyle{  \int dr V_{ext}(r)n(r) + \langle \Psi,(T+U) \Psi \rangle }
\end{array}
\tag{3.1}
\end{equation} %]]></script>

<p>这种<b>由外势确定的多电子基态波函数,再确定密度,称作 <i> v-representability</i></b></p>

<p>使用<script type="math/tex">\eqref{A2}</script>对公式<script type="math/tex">\eqref{dft1}</script>进行变分可得
\begin{equation}
\label{dft1.1}
\begin{array}{l}
\displaystyle{<br />
\delta E_{HK}[n] = \int dr \delta n(r) ( V_{ext}(r) + \cfrac{\delta F_{HK}}{\delta n})
}
\end{array}
\tag{3.1.1}
\end{equation}</p>

<p><strong>证明:</strong><br />
薛定谔变分法是在<script type="math/tex">H=T+V</script>的情况下,对所有波函数变分,找到的极小值一定是基态.<br />
在所有满足<em>v-representability</em>的条件的多电子波函数<script type="math/tex">\Psi'</script>产生的试探密度<script type="math/tex">n(r)</script>中肯定包含<script type="math/tex">H=T+V</script>的基态，变分必然能找到基态
\begin{equation}
\label{dft2}
E_{HK}[n]=\langle \Psi’ | H | \Psi’ \rangle \geq \langle \Psi_0 | H | \Psi_0 \rangle = E[n_0]
\tag{3.2}
\end{equation}
这也就是说， 为了得到基态能量， 要遍历所有外势产生的density(波函数)</p>

<blockquote>
  <p>@Xin-Zheng Li老师谈到的，这里仍有一些问题
<img src="/uploads/2020/04/lixinzheng1.png" alt="" /></p>
</blockquote>

<h3 id="levy-constrained-search">Levy constrained-search</h3>
<p>在HK对能量变分的限制条件是密度(波函数)由外势产生,这种给出正确势场的条件称为<strong>v-representability(V可表示问题</strong><br />
Levy则仅要求变分的试探密度符合<script type="math/tex">\int dr n(r) = N</script>，这是HK定理的必要条件，这种给出正确的电子数<script type="math/tex">N</script>的条件称为<strong>N-representability(N可表示问题)</strong><br /></p>

<p><strong>操作:</strong><br />
在<script type="math/tex">\int dr n(r) = N</script>条件,Levy constrained-search先把满足的多体波函数按照其产生的<script type="math/tex">n</script>进行分类,先在每个<script type="math/tex">n</script>内部对波函数进行变分,这样的<script type="math/tex">n</script>必然满足<script type="math/tex">\int dr n(r) = N</script>， i.e. N-representability.</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{equation}
\label{dft3}
\begin{array}{l}
E &= \min \limits_{\Psi} \langle \Psi | H | \Psi \rangle  \\
      &= \min \limits_{n} \left \lbrace \min \limits_{\Psi \to n} \langle \Psi | H | \Psi \rangle  \right \rbrace
\end{array}
\tag{3.3}
\end{equation} %]]></script>

<p>where</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{equation}
\label{dft4}
\begin{array}{l}
\min \limits_{\Psi \to n} \langle \Psi | H | \Psi \rangle  &= \int dr V_{ext}(r)n(r) + \min \limits_{\Psi \to n} \langle \Psi,(T+U) \Psi \rangle \\
     &= \int dr V_{ext}(r)n(r) + F[n]
\end{array}
\tag{3.4}
\end{equation} %]]></script>

<p><strong>证明:</strong><br />
这就是薛定谔变分法的形式,取遍所有<strong>N-representability</strong>的波函数,这群波函数里面肯定包含基态的情况，必然能变分到极小值(基态).<br />
或者这样想:虽然<strong>N-representability</strong>是HK定理(<strong>v-representability</strong>)的必要条件,但是还是在薛定谔变分法范围内,肯定能变分到基态的极小值.</p>

<p><strong>显然,<script type="math/tex">F[n_0]=F_{HK}[n_0]</script>,其他的<script type="math/tex">n</script>, <script type="math/tex">F[n] \neq F_{HK}[n]</script></strong></p>

<p>如何找出所有的<strong>N-representability</strong>的波函数/密度,也不清楚,<script type="math/tex">F[n]</script>的形式也不知道,</p>
<blockquote>
  <p>它更大的价值， 在于for practical reason为交换关联泛函近似的进一步发展尝试提供了思路。</p>
</blockquote>

<h3 id="kohn-sham-scheme">Kohn-Sham Scheme</h3>
<p><strong>上面的问题都是针对的多体波函数,Kohn-Sham会带我们进入单粒子的方法</strong></p>

<p>还是以K-S的文章为主,更好理解.</p>

<p>对于一个受到外势<script type="math/tex">v</script>的相互作用非均一的电子气体，他的基态能可以写作:
\begin{array}{l}
\label{dft5}
\displaystyle{  E=\int v(r)n(r)dr + \cfrac{1}{2}\int \int \cfrac{n(r)n(r’)}{|r-r’}drdr’+G[n]}
\tag{3.5}
\end{array}
where</p>
<ul>
  <li><script type="math/tex">n(r)</script>是电子密度</li>
  <li><script type="math/tex">G[n]</script>是一个通用的密度泛函，<br />
W. KOHN AND L. J. SHAM first write
\begin{array}{l}
\label{dft6}
G[n]=T^s[n]+E_{xc}[n]
\tag{3.6}
\end{array}
where <script type="math/tex">T^s[n]</script>是一个具有密度<script type="math/tex">n</script>的无相互作用系统的动能. <br />
<script type="math/tex">E_{xc}</script>由W. KOHN AND L. J. SHAM定义, 是密度为<script type="math/tex">n</script>的相互作用系统的交换关联能量.<br />(其实就是<script type="math/tex">F_{HK}-T^s[n]</script>)</li>
</ul>

<p>根据H-K定理，对<script type="math/tex">\eqref{dft5}</script>进行变分,使用<script type="math/tex">\eqref{A2}</script>的公式,得
\begin{array}{l}
\label{dft7}
\displaystyle{  \int \delta n(r) 
\left \lbrace { v(r) + \int { \frac{n(r’)}{|r-r’|}}dr 
                     + \frac{\delta T^s[n]}{\delta n(r)} 
                     + \frac{\delta E_{xc}[n]}{\delta n(r)} 
} \right \rbrace dr=0}
\tag{3.7}
\end{array}</p>

<p>根据HK第一定理,对于一个外势为
\begin{array}{l}
\label{dft8}
\displaystyle{ 
v(r) + \int { \frac{n(r’)}{|r-r’|}}dr 
                     + \frac{\delta E_{xc}[n]}{\delta n(r)
}  }
\tag{3.8}
\end{array}
的无相互作用系统，有唯一对应的基态密度<script type="math/tex">n_0^s</script>,根据HK第二定理, 及公式<script type="math/tex">\eqref{dft1.1}</script>对试探密度<script type="math/tex">n^s</script>在该外势下的变分, 也是<script type="math/tex">\eqref{dft7}</script>的形式. 这给我们一个启发, 下面我们构建一个基态密度和多体系统一样的无作用系统.
<br /><br />
定义外势泛函
\begin{array}{l}
\label{dft9}
\displaystyle{ 
v^s[n]=v(r) + \int { \frac{n(r’)}{|r-r’|}}dr 
                     + \frac{\delta E_{xc}[n]}{\delta n(r)}
             }
\tag{3.9}
\end{array}
那么，我们通过(自洽)求解满足<script type="math/tex">\eqref{dft10}</script>，<script type="math/tex">\eqref{dft11}</script>的单粒子平均场薛定谔方程:
\begin{array}{l}
\label{dft10}
\displaystyle{ 
\left \lbrace -\cfrac{1}{2}\nabla^2 + v^s[n(r)] \right \rbrace \psi_i(r)
 = \epsilon_i \psi_i(r)
             }
\tag{3.10}
\end{array}
\begin{array}{l}
\label{dft11}
\displaystyle{
    n(r)= \sum_{i=1}^{N} = |\psi_i(r)|^2
             }
\tag{3.11}
\end{array}
得到的一个基态密度为<script type="math/tex">n_0^s</script>,受到外势为<script type="math/tex">v^s[n_0^s]</script>无相互作用系统<br />
<strong>根据HK第一定理,外势为<script type="math/tex">v^s[n_0^s]</script>的无相互作用系统有唯一的基态密度与之对应,通过求解薛定谔方程<script type="math/tex">\eqref{dft10}</script>得到的是<script type="math/tex">n_0^s</script>, 那么使用HK第二定理变分法得到的结果也肯定是<script type="math/tex">n_0^s</script>.</strong></p>

<p>根据HK第二定理,采用<em>non-interacting-v-representability</em>条件,对外势为<script type="math/tex">v^s[n0]</script>的无相互作用系统进行变分,同公式<script type="math/tex">\eqref{dft1.1}</script>
\begin{equation}
\label{dft12}
\begin{array}{l}
\displaystyle{<br />
\delta E_{HK}[n^s] 
= \int dr \delta n^s(r) ( v^s[n0] + \cfrac{\delta F_{HK}}{\delta n^s})
= \int dr \delta n^s(r) ( v^s[n0] + \cfrac{\delta T^s[n^s]}{\delta n^s})
=0
}
\end{array}
\tag{3.12}
\end{equation}
根据HK第一定理告诉我们<script type="math/tex">\eqref{dft12}</script>的解为<script type="math/tex">n^s=n_0^s</script>.<br />
对比<script type="math/tex">\eqref{dft12}</script>与<script type="math/tex">\eqref{dft7}</script>，<script type="math/tex">n=n_0^s</script>也是<script type="math/tex">\eqref{dft7}</script>的解,即多体相互作用体系的基态密度.</p>

<p><strong>综上:通过求解自洽方程<script type="math/tex">\eqref{dft10}\,\eqref{dft11}</script>, 得到的基态密度就是多体系统的基态密度</strong></p>

<h3 id="kohn-sham-schemen-representability">Kohn-Sham Scheme:N-representability</h3>
<blockquote>
  <p>@Xin-Zheng Li： 当然， 那个时候像v-representable、 N-representable这些问题人们还没认识清楚。 KS只是for
practical reason提出了一个自洽的求解方案， 求解<script type="math/tex">F_{HK}[n]</script>
在上世纪70年代末、 80年代初v-representable 、 N-representable 差不多搞 清楚后 ， 用vrepresentable的密度针对FHK 𝜌 的处理很自然的推广至用N-representable的密度针对<script type="math/tex">F[n]</script>的处理。
基于这个原因， 在后期关于DFT中KS scheme的讲解中， 人们可以直接跳过用v-representable的
密度处理<script type="math/tex">F_{HK}[n]</script>， 而直接用N-representable的密度处理<script type="math/tex">F[n]</script></p>
</blockquote>

<p>一样的道理,可以得到相同的方程,换波函数的方式推到</p>

<p>对于满足<script type="math/tex">\int dr n(r) = N</script>的试探密度,对应的能量也可以用无相互作用体系加<script type="math/tex">E_{xc}</script>来描述，
\begin{array}{l}
\label{dft13}
\displaystyle{  E_0 = \min \limits_{n \to N} \lbrace E[n] \rbrace 
= \min \limits_{n \to N} \left \lbrace  \int v(r)n(r)dr + T^s[n] + E_{H}[n] + E_{xc}[n]   \right \rbrace }
\tag{3.13}
\end{array}
where 各项含义同<script type="math/tex">\eqref{dft5}</script>. <script type="math/tex">E_{H}</script>就是<script type="math/tex">E_{Hartree}</script><br />
采用满足<script type="math/tex">\int dr n(r) = N</script>的试探密度<script type="math/tex">n(r)=\sum_{i=1}^N|\phi_i(r)|^2</script>,利用</p>

<script type="math/tex; mode=display">\cfrac{\delta n(r')}{\delta \psi_i^{\ast}(r)} = \psi_i(r)\delta(r'-r)</script>

<script type="math/tex; mode=display">\begin{array}{l}
\cfrac{\delta \int v(r')n(r')dr' }{\delta \psi_i^{\ast}(r)} =  \int v(r')dr' \psi_i(r)\delta(r'-r)  = v(r) \psi_i(r) 
\end{array}</script>

<script type="math/tex; mode=display">T^s[n] = \sum_{i=1}^N \langle \phi_i | \hat{T} | \psi_i \rangle = \sum_{i=1}^N \langle \phi_i | \int dr' | r' \rangle \langle r' | \hat{T} | \psi_i \rangle</script>

<script type="math/tex; mode=display">\begin{array}{l}
\cfrac{\delta T^s[n]}{\delta \psi_i^{\ast}(r)} = \langle r | \hat{T} | \psi_i \rangle = -\cfrac{1}{2}\nabla^2  \psi_i(r)
\end{array}</script>

<script type="math/tex; mode=display">% <![CDATA[
\begin{array}{l}
\cfrac{\delta E_H[n]}{\delta \psi_i^{\ast}(r)} &= \int dr' \cfrac{\delta E_H[n]}{ \delta n(r')}\cfrac{\delta n(r')}{\delta \psi_i^{\ast}(r) } \\
& = \int dr' V_H[n](r')  \psi_i(r)\delta(r'-r) \\
&= V_H[n](r) \psi_i(r)
\end{array} %]]></script>

<p>同理</p>

<script type="math/tex; mode=display">\begin{array}{l}
\cfrac{\delta E_{xc}[n]}{\delta \psi_i^{\ast}(r)} = V_{xc}[n](r) \psi_i(r)
\end{array}</script>

<p>使用拉格朗日乘子法定义泛函</p>

<script type="math/tex; mode=display">\begin{array}{l}
L[n] = E[n] - \epsilon ( \int n(r)dr -N )
\end{array}</script>

<p>将<script type="math/tex">L[n]</script>对<script type="math/tex">\psi_i^{\ast}(r)</script>变分得</p>

<script type="math/tex; mode=display">\begin{array}{l}
\cfrac{\delta L[n]}{\delta \psi_i^{\ast}(r)} =  ( -\cfrac{1}{2}\nabla^2 + v(r) + V_H(r) + V_{xc}(r) - \epsilon )  \psi_i(r)
\end{array}</script>

<p>取极值的条件是<script type="math/tex">\cfrac{\delta L[n]}{\delta \psi_i^{\ast}(r)}=0</script>,即</p>

<script type="math/tex; mode=display">\begin{array}{l}
 ( -\cfrac{1}{2}\nabla^2 + v(r) + V_H(r) + V_{xc}(r)  )  \psi_i(r) =  \epsilon  \psi_i(r)
\end{array}</script>

<p>定义
<script type="math/tex">% <![CDATA[
\label{dft15}
\begin{array}{l}
V_{eff}[n](r) &= v(r) +  V_{Hartree}[n](r) +V_{xc}[n](r) \\
           &= v(r) + \cfrac{\delta E_{Hartree}[n]}{\delta n(r)} + \cfrac{\delta E_{xc}}{\delta n(r)} \\
           &= v(r) + \displaystyle{   \int \cfrac{n(r')}{|r-r'|} dr' } + \cfrac{\delta E_{xc}}{\delta n(r)}
\end{array}
\tag{3.15} %]]></script>
同理自洽求解的
\begin{array}{l}
\label{dft16}
\displaystyle{ 
\left \lbrace -\cfrac{1}{2}\nabla^2 + v_{eff}[n(r)] \right \rbrace \psi_i(r)
 = \epsilon_i \psi_i(r)
             }
\tag{3.16}
\end{array}
\begin{array}{l}
\label{dft17}
\displaystyle{
    n(r)= \sum_{i=1}^{N} = |\psi_i(r)|^2
             }
\tag{3.17}
\end{array}
自洽得到的基态密度满足<script type="math/tex">\eqref{dft14}</script>,就是相互作用系统的基态密度.<br />
考虑到<script type="math/tex">\sum_{i=1}^{N} \epsilon_i = T^s[n] + 2E_{Hartree}+\int V_{xc} n dr</script><br />
还可以把相互作用体系的能量写作</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{array}{l}
\label{dft18}
E[n] &= T^s[n] + E_{Hartree}[n] + E_{xc}[n] \\
     &= \sum_{i=1}^{N} \epsilon_i - E_{Hartree}[n] -\int V_{xc} n dr  + E_{xc}[n]     
\tag{3.18}
\end{array} %]]></script>

<h3 id="关于hk-ks的备注">关于HK, KS的备注</h3>
<ul>
  <li>上面的推导,都没有对<script type="math/tex">r</script>进行加粗,是矢量,应该加粗</li>
  <li>KS轨道
<br /> 自洽求解的本征态<script type="math/tex">\psi_i(r)</script>,称为KS轨道.
<br /> KS轨道的能量<script type="math/tex">\epsilon_i</script>没有物理对应.</li>
  <li>自旋适用
<br /> 上述的公式没有提到自旋,引入自旋,小修改一下波函数和势能也成立</li>
  <li>基态简并
<br /> DFT适用于基态简并情况,使用n-representable的搜索可以找到.</li>
  <li>离子相互作用
<br /> 常把离子作用能添加到总能量泛函中去，上面的推导省略了，不影响结论，总能加上<script type="math/tex">E_{II}</script>即可
<br /> 加上一层结构优化循环</li>
</ul>

<h2 id="赝势时的ks方程">赝势时的KS方程</h2>
<h3 id="nc赝势">NC赝势</h3>
<p>把芯电子和原子核是为整体,与<script type="math/tex">\eqref{dft16}</script>相比,只是外势变成了赝势,电子数变少了.<br />
因为<script type="math/tex">n(r)=\sum_{i=1}^{occ}|\phi_i^{PS}(r)|^2</script>形式不变，所以变分后的自洽方程组形式也不变</p>
<h3 id="uspp">USPP</h3>
<ul>
  <li>Walker B, Gebauer R. Ultrasoft pseudopotentials in time-dependent density-functional theory[J]. The Journal of chemical physics, 2007, 127(16): 164106.</li>
</ul>

<p>因为软的KS轨道采用了软的KS轨道,需要添加缀加泛函才能得到体系的密度.<br />
而且使用KS方程解出来的KS轨道,<script type="math/tex">|\psi_i \rangle</script>,不再正交化<script type="math/tex">\langle \psi_i | \psi_j \rangle \neq \delta{i,j}</script>,而是<script type="math/tex">\langle \psi_i | S | \psi_j \rangle = \delta_{i,j}</script>.<br /></p>

<script type="math/tex; mode=display">n(\mathbf{r}) = \sum_i^{occ} \left [ |\psi_i(\mathbf{r})|^2 + \sum_{n,m,I} Q_{n,m}^{I}(\mathbf{r}) \langle \psi_i | \beta_n^I \rangle  \langle  \beta_m^I | \psi_i  \rangle  \right ] \tag{us-1}</script>

<p>变分后得到的自洽求解方程的势能项就不一样了,如下图,推导见<a href="/2020/04/05/qe-upf/">QE代码阅读: 赝势</a>
<img src="/uploads/2020/04/usppdelta.png" alt="" /></p>

        </article>
        <hr>

        
        
            
            
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                        
                        <h2 id="similar_posts">类似文章</h2>
                        <ul>
                        
                        <li class="relatedPost">
                            <a href="/2020/09/20/qe-spin/">QE代码阅读: 自旋相关
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
        
        
            </ul>
        
        <!--- github follow and star -->
        <iframe src="/html_script/github-btn.html?user=cndaqiang&repo=cndaqiang.github.io&type=star&count=true&size=large" frameborder="0" scrolling="0" width="160px" height="30px"></iframe>
        <iframe src="/html_script/github-btn.html?user=cndaqiang&type=follow&count=true&size=large" frameborder="0" scrolling="0" width="220px" height="30px"></iframe>
        <div class="post-recent">
    <div class="pre">
        
        <p><strong>上一篇</strong> <a href="/2020/04/24/qe-sum_band/">QE代码阅读: sum_band</a></p>
        
    </div>
    <div class="nex">

        
        <p><strong>下一篇</strong> <a href="/2020/04/30/functionals/">泛函及泛函变分</a></p>
        
    </div>
</div>

        <div id="adsense"></div>
<!-- 谷歌广告文章底部,夜广告，自适应 -->
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-8365330523291002"
     data-ad-slot="7816631956"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

        <hr>
        <h2 id="comments">评论</h2>
        




<!-- 来必力City版安装代码 -->
<div id="lv-container" data-id="city" data-uid="MTAyMC80MDQ4OC8xNzAxNQ==">
	<script type="text/javascript">
   (function(d, s) {
       var j, e = d.getElementsByTagName(s)[0];

       if (typeof LivereTower === 'function') { return; }

       j = d.createElement(s);
       j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
       j.async = true;

       e.parentNode.insertBefore(j, e);
   })(document, 'script');
	</script>
<noscript> 为正常使用来必力评论功能请激活JavaScript</noscript>
</div>
<!-- City版安装代码已完成 -->

		<hr>
		<h2 id="adsenseAfterComments">广告</h2>
        <div id="adsense"></div>
<!-- 谷歌广告文章底部,夜广告，自适应 -->
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-8365330523291002"
     data-ad-slot="7816631956"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

        

        


    </div>
    <button class="anchor"><i class="fa fa-anchor"></i></button>
    <div class="right">
        <div class="wrap">

            <!-- Content -->
            <div class="side content">
                <div>
                    目录
                </div>
                <ul id="content-side" class="content-ul">
                    
                    <li><a href="#similar_posts">类似文章</a></li>
                    
                    <li><a href="#comments">评论</a></li>
                </ul>
            </div>
            <!-- 其他div框放到这里 ，添加br 使不粘连--><br>
            <div class="side">
               <div>
                   <i class="fa fa-database"></i>
                  访客数据
               </div>
               <script type="text/javascript" src="//rf.revolvermaps.com/0/0/7.js?i=537vyn60ia7&amp;m=0&amp;c=007eff&amp;cr1=ff0000&amp;sx=0" async="async"></script>
            </div>
            <!-- <div class="side">bbbb</div> -->
        </div>
    </div>
</div>
<script>
/**
 * target _blank
 */
(function() {
    var aTags = document.querySelectorAll('article a:not([id])')
    for (var i = 0; i < aTags.length; i++) {
        aTags[i].setAttribute('target', '_blank')
    }
}());
</script>
<script src="/js/pageContent.js " charset="utf-8"></script>


    <footer class="site-footer">


    <div class="wrapper">

        <p class="description">
             本站记录我的学习笔记！ 
        </p>
        <p class="contact">
            联系方式: 
            <a href="https://github.com/cndaqiang" title="GitHub"><i class="fa fa-github" aria-hidden="true"></i></a>  
            <a href="mailto:who@cndaqiang.ac.cn" title="email"><i class="fa fa-envelope-o" aria-hidden="true"></i></a>   
            <a href="https://www.zhihu.com/people/cndaqiang" title="Zhihu"><i class="iconfont icon-zhihu"></i></a>   
            <a href="http://www.jianshu.com/u/5d47905688d0" title="Jianshu"><i class="iconfont icon-jianshu"></i></a>  
            <a href="https://twitter.com/cndaqiang" title="Twitter"><i class="fa fa-twitter" aria-hidden="true"></i></a>  
            <a href="https://www.facebook.com/daqiang.chen.12" title="Facebook"><i class="fa fa-facebook-official" aria-hidden="true"></i></a>    
        </p>
        <p>
            本站总访问量<span id="busuanzi_value_site_pv"></span>次，本站访客数<span id="busuanzi_value_site_uv"></span>人次，本文总阅读量<span id="busuanzi_value_page_pv"></span>次
        </p>
        <p class="power">
            <span>
                Site powered by <a href="https://cndaqiang.github.io/">cndaqiang</a>
            </span>
            <span>
                Theme designed by <a href="https://github.com/Gaohaoyang">HyG</a>.
            </span>
        </p>
    </div>
</footer>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <div class="back-to-top">
    <a href="#top" data-scroll>
        <i class="fa fa-arrow-up" aria-hidden="true"></i>
    </a>
</div>

    <script src=" /js/main.js " charset="utf-8"></script>
    <script src=" /js/smooth-scroll.min.js " charset="utf-8"></script>
    <script type="text/javascript">
      smoothScroll.init({
        speed: 500, // Integer. How fast to complete the scroll in milliseconds
        easing: 'easeInOutCubic', // Easing pattern to use
        offset: 20, // Integer. How far to offset the scrolling anchor location in pixels
      });
    </script>
    <!-- <script src=" /js/scroll.min.js " charset="utf-8"></script> -->
  </body>

</html>
