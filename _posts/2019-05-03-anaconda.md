---
layout: post
title:  "[linux]Anaconda安装"
date:   2019-05-03 17:18:00 +0800
categories: Anaconda Python
tags:  Python
author: cndaqiang
mathjax: true
---
* content
{:toc}










## 常用命令
```
激活环境
conda activate python37 # for Linux & Mac
#老版 source activate python37 # for Linux & Mac
退出环境
conda deactivate python37 # for Linux & Mac
#老版 source deactivate python37 # for Linux & Mac
```

## 下载
下载后，直接运行
```
wget https://repo.anaconda.com/archive/Anaconda2-2019.03-Linux-x86_64.sh
./Anaconda2-2019.03-Linux-x86_64.sh
```
安装后，添加PATH
```
export PATH=/home/cndaqiang/anaconda2/bin:$PATH
```
自定义模块
```
export PYTHONPATH="${PYTHONPATH}:${HOME}/MyTools/TDAP/py/module"
```

## 查看已有环境

```
~ $ conda info --env
# conda environments:
#
base                  *  /Users/cndaqiang/anaconda3
python27                 /Users/cndaqiang/anaconda3/envs/python27
```

## 创建环境
```
创建环境
conda create --name python37 python=3.7
激活环境
conda activate python37 # for Linux & Mac
退出环境
conda deactivate python37 # for Linux & Mac
删除环境
conda remove --name python37 --all
```
## 配置环境   
```
指定环境按照程序包
conda install -n python37 numpy
更新
conda update -n python37 numpy
删除
conda remove -n python37 numpy
```
也可以进入环境后
```
python -m pip install 
```

## 其他软件包
```
conda install -n python37 numpy
conda install -n python37 matplotlib
conda install -n python37 pandas
conda install -n python37 scipy
#自动输入脚本
echo y  | conda install -n  python37 numpy
echo y  | conda install -n  python37 matplotlib
echo y  | conda install -n  python37 pandas
echo y  | conda install -n  python37 scipy
```
pymatgen


## 更换仓库
[清华-Anaconda 镜像使用帮助](https://mirrors.tuna.tsinghua.edu.cn/help/anaconda/)<br>
`vi ~/.condarc`
填入
```
channels:
  - defaults
show_channel_urls: true
default_channels:
  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main
  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free
  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/r
custom_channels:
  conda-forge: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
  msys2: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
  bioconda: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
  menpo: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
  pytorch: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
  simpleitk: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
```

## 有趣的库
### 图片exif查看修改
```
python -m pip install pyexiv2
```
使用
```
>>> from pyexiv2 import Image
>>> i=Image("IMG_20210502_134203.jpg")
>>> i.read_exif()
{'Exif.Image.ImageWidth': '4000', 'Exif.Image.Model': 'MI 9', 'Exif.Image.ImageLength': '3000', 'Exif.Image.Orientation': '1', 'Exif.Image.DateTime': '2021:05:02 13:42:05', 'Exif.Image.YCbCrPositioning': '1', 'Exif.Image.ExifTag': '206', 'Exif.Photo.0x9aaa': '56 215 229 108 207 190 100 102 189 201 147 196 56 34 235 201 1
.....
#修改exif
>>> i.modify_exif({'Exif.Image.Make': 'cndaqiang'})
#关闭，保存修改
>>> i.close()
```
修改后就不同了
```
>>> import filecmp
>>> filecmp.cmp("IMG_20210502_134203.jpg","IMG_20210502_134203的副本.jpg")
```
对另一个文件做同样的更改,就相同了
```
>>> i=Image("IMG_20210502_134203的副本.jpg")
>>> i.modify_exif({'Exif.Image.Make': 'cndaqiang'})
>>> i.close()
>>> filecmp.cmp("IMG_20210502_134203.jpg","IMG_20210502_134203的副本.jpg")
True
```


## 问题

```
Traceback (most recent call last):
  File "/home/cndaqiang/anaconda3/bin/conda", line 7, in <module>
    from conda.cli import main
ModuleNotFoundError: No module named 'conda'
```
重新安装修复
```
./Anaconda3-5.3.1-Linux-x86_64.sh -u
```
anaconda安装的mpi和系统的mpi冲突，卸载anaconda安装的mpi
```
#查询包名称
conda list
#卸载
conda uninstall mpi
```
安装ase，及其他
```
pip install -i https://pypi.tuna.tsinghua.edu.cn/simple  ase
#
pip install -i https://pypi.tuna.tsinghua.edu.cn/simple uncertainties
pip install -i https://pypi.tuna.tsinghua.edu.cn/simple lmfit
```

### NFS服务器连接断开, anaconda命令会卡死
这样加一道检测命令
```bash
networkOK=$(ping -t 1 -c 1 mom | grep round-trip | tail | awk '{ print $NF }')
if [ $networkOK  ] 
then
  conda activate python37 #& #pid=$! ;sleep 5; kill -9 $pid
else
  echo "Can't mount mom, stop conda, Please not run: conda activate python37"
fi
```



------
>本文首发于[我的博客@cndaqiang](https://cndaqiang.github.io/).<br>
>本博客所有文章除特别声明外，均采用 [CC BY-SA 4.0 协议](https://creativecommons.org/licenses/by-sa/4.0/deed.zh) ，转载请注明出处！
