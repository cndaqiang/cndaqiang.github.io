---
layout: post
title:  "octopus 快速上手"
date:   2019-04-11 12:46:00 +0800
categories: DFT TDDFT
tags:  octopus
author: cndaqiang
mathjax: true
---
* content
{:toc}


octopus-8.4快速上手记录<br>
短期内应该不会用octopus了，记录免忘记<br>
不得不说octopus官方的教程写的真是太好了





## 参考
[octopus-Tutorial](https://octopus-code.org/wiki/Tutorial:Getting_started)

[ Gcc OPENMPI 编译octopus-8 遇到的问题和解决方案](/2018/12/21/gcc-octopus8/)

[ centos6.5 Gcc Openmpi 编译octopus-7.1 ](/2018/09/15/gun-openmpi-octopus-7.1/)

## Octopus 8.4 快速上手
octopus有原子坐标既可以运行<br>
如，新建`inp`填入
```
%Coordinates
'H'  |0 | 0 | 0
%
```
然后
```
mpirun -np 核数 octopus
```
就可以了，octopsu会提供赝势等等参数<br>

运算之后，生成`exec   restart   static`<br>
`static`里面包含计算结果和输出文件

### inp文件
#### 文件格式
- 可以在inp中自定义变量，**变量名区分大小写**，并进行相关数学计算[Mathematical expressions](https://octopus-code.org/wiki/Manual:Input_file#Mathematical_expressions)
- **计算参数不区分大小写**，不区分顺序
- 注释`#`开头
- 可以用 `include 文件名` 把其他文件放到inp文件中
- **输入文件只能是inp,不能改变名字**


### 参数

#### `BoxShape` 计算网格形状
[BoxShape](https://octopus-code.org/doc/10.4/html/vars.php?section=Mesh&name=BoxShape)

默认是`minimum`,原子越远离原点,网格点越多

使用sphere时,如果原子/电子超出设置的球形边界,不会被计算,会出现误差

This variable decides the shape of the simulation box. The default is minimum for finite systems and parallelepiped for periodic systems. Note that some incompatibilities apply:

**Spherical or minimum mesh is not allowed for periodic systems.**
Cylindrical mesh is not allowed for systems that are periodic in more than one dimension.
box_image is only allowed in 2D.

Options:
- sphere: The simulation box will be a sphere of radius Radius. (In 2D, this is a circle.), 半径`radius = 15.0*angstrom`
- cylinder: The simulation box will be a cylinder with radius Radius and height (in the x-direction) of 2 Xlength.
- minimum: The simulation box will be constructed by adding spheres created around each atom (or user-defined potential), of radius Radius.
- parallelepiped: The simulation box will be a parallelepiped whose dimensions are taken from the variable Lsize.
- box_image: The simulation box will be defined through an image, specified with BoxShapeImage. White (RGB = 255,255,255) means that the point is contained in the simulation box, while any other color means that the point is out. The image will be scaled to fit Lsize, while its resolution will define the default Spacing. The actual box may be slightly larger than Lsize to ensure one grid point = one pixel for default Spacing.
- hypercube: (experimental) The simulation box will be a hypercube or hyperparallelepiped. This is equivalent to the parallelepiped box but it can work with an arbitrary number of dimensions.
- user_defined: The shape of the simulation box will be read from the variable BoxShapeUsDef.

```
BoxShape = sphere
spacing = 0.19*angstrom
radius = 15.0*angstrom
```

####   `TDTimeStep`时间步长
TDTimeStep默认单位是$3.674932539796e-02 \hbar/eV$, $1 \hbae/eV = 0.658211951 fs$
```
TDTimeStep = 0.002 # 4.83776903362502e-05 fs, *826827 ~ 40fs
```


### 示例
```
CalculationMode = gs #计算方式 gs:基态(默认) td:时间依赖 unocc:非自洽计算  
UnitsOutput =  eV_Angstrom  #默认atomic原子单位制(能量是Hartree)

Nitrogen_mass=14.0 #可以在inp文件中定义变量，支持+-*/sqrt()等多种数学运算
	#更多数学运算https://octopus-code.org/wiki/Manual:Input_file#Mathematical_expressions


%Species  #元素描述block
 'N' | species_pseudo | set | standard | lmax | 1 | lloc | 0 | mass | Nitrogen_mass
#原素名 | 性质1 | 值 | 性质2 | 值
#赝势 species_pseudo | set默认就是用系统的 | standard
#     species_pseudo | file | `赝势文件名，支持 .psf(SIESTA),.upf,.fhi,.cpi,.xml,.hgh`  
# 更多参考https://octopus-code.org/doc/8.4/html/vars.php?section=System&name=Species
#lmax: The maximum angular-momentum channel that will be used for the pseudopotential.
#lloc: The angular-momentum channel of the pseudopotential to be considered local.
%


XYZCoordinates = 'N.xyz'
ExtraStates = 1

%Occupations
 2|1|1|1
%

BoxShape = sphere

Radius = 5.0*angstrom
#Spacing = 0.18*angstrom  #时空间网格大小

#参数也可以通过环境变量设置
#设置linux变量
#```
#export OCT_PARSE_ENV=1 #开启从环境读入功能
#export OCT_Spacing=0.18*angstrom  #以OCT_开头设置参数
#```

Output = wfs + density + elf + potential
#默认只产生info，显示能量，特征值，等，其他信息，设置输出
#wfs wavefunction ; elf : the electron localization function  ;potential : the Kohn-Sham potential
#dos : 态密度

OutputFormat = cube + xcrysden + dx + axis_x + plane_z
#输出文件格式，用于给不同的软件(vislt,gunplot , xcrysden,UCSF(density.dx))打开
#https://octopus-code.org/wiki/Tutorial:Visualization

#octopus目录中有很多小程序可以用

#支持 include 文件
```

#### 周期性示例

```
CalculationMode = gs

PeriodicDimensions = 3
Spacing = 0.5 

%LatticeVectors
0.0 | 0.5 | 0.5
0.5 | 0.0 | 0.5
0.5 | 0.5 | 0.0
%

a=10.18
%LatticeParameters
 a | a | a
%

%ReducedCoordinates
 "Si" | 0.0 | 0.0 | 0.0 
 "Si" | 1/4 | 1/4 | 1/4 
%

nk=2

%KPointsGrid
  nk |  nk |  nk  #第一行：倒空间每个方向k点数量，na | nb | nc 总数na*nb*nc Monk-Pack网格
 0.5 | 0.5 | 0.5  #之后的为K点的移位
 0.5 | 0.0 | 0.0
 0.0 | 0.5 | 0.0
 0.0 | 0.0 | 0.5
%

KPointsUseSymmetries = yes

ExtraStates = 1
Output = dos
```

#### td 计算示例
```
CalculationMode = td #gs
UnitsOutput = eV_Angstrom

Radius = 3.5*angstrom
Spacing = 0.18*angstrom

CH = 1.097*angstrom
%Coordinates
  "C" |           0 |          0 |           0
  "H" |  CH/sqrt(3) | CH/sqrt(3) |  CH/sqrt(3)
  "H" | -CH/sqrt(3) |-CH/sqrt(3) |  CH/sqrt(3)
  "H" |  CH/sqrt(3) |-CH/sqrt(3) | -CH/sqrt(3)
  "H" | -CH/sqrt(3) | CH/sqrt(3) | -CH/sqrt(3)
%

Tf = 1/eV
dt = 0.002/eV

TDPropagator = aetrs
TDMaxSteps = Tf/dt  #总步数
TDTimeStep = dt     #步长

FromScratch = yes
 
amplitude = 1*eV/angstrom
omega = 18.0*eV
tau0 = 0.5/eV
t0 = tau0

%TDExternalFields
  electric_field | 1 | 0 | 0 | omega | "envelope_cos"
#  电场/磁场/矢量势/标量势/ f(x,y,z) | nx | ny | nz 场的极化方向(nx,ny,nz) | omega | g(t) 字符型，定义在%TDFunctions中 |[ 相位phase(t) ]
# 外场 = f(x,y,z)*cos(w*t+phase(t))*g(t)
# f(x,y,z) : electric field, magnetic field, vector_potential
# g(t)与phase(t) 都是字符串，字符串内容随意，定义式在%TDFunctions中
#phase(t) 不设置时默认为0
%
 
%TDFunctions
  "envelope_cos" | tdf_cosinoidal | amplitude | tau0 | t0
# %TDExternalFields中g(t),phase(t) | 函数名:tdf_cw,tdf_gaussian,tdf_cosinoidal,...来自文件，自定义 | 相关参数
# https://octopus-code.org/doc/8.4/html/vars.php?section=Time-Dependent&name=TDFunctions

%

TDOutput = laser + multipoles
#TD输出
#laser: If set, outputs the laser field to the file td.general/laser. On by default if TDExternalFields is set.
#multipoles: Outputs the (electric) multipole moments of the density to the file td.general/multipoles. This is required to, e.g., calculate optical absorption spectra of finite systems. The maximum value of l can be set with the variable TDMultipoleLmax.
```
td计算输文件`td.general`里面包含`TDOutput`设定的文件


## Octopus 10.4 学习
### 输入
```
#基态计算
CalculationMode = gs
#单位
UnitsOutput = ev_angstrom
#以原点的球
BoxShape = sphere
#dr
spacing = 0.19*angstrom
#球的半径,注意直径是2倍
radius = 10*angstrom
#计算的空态,在需要td投影时可以增加空态
ExtraStates=20
#输出信息
Output =dos+ density
#输出格式
OutputFormat = xcrysden
%Coordinates
'H' | angstrom*    0.0000000000 | angstrom*    0.0000000000 | angstrom*    0.0000000000
%
```

## 报错
### 使用中文的tab键
```
Input: [PseudopotentialSet = standard]
Reading Coordinates from Coordinates block

**************************** FATAL ERROR *****************************
*** Fatal Error (description follows)
*--------------------------------------------------------------------
* From node =    0
*--------------------------------------------------------------------
* Error in block Coordinates line # 1
**********************************************************************


```

### 核数不合适
改成2，4，5，10个核都没有问题，6个核就报错
```
      Block       3 contains       1 states:       4 -       4
Info: Ground-state restart information will be read from 'restart/gs'.

           Info: Reading states: gs. 2021/03/23 at 22:18:22

ETA: .
Program received signal SIGFPE: Floating-point exception - erroneous arithmetic operation.

Backtrace for this error:

Program received signal SIGFPE: Floating-point exception - erroneous arithmetic operation.

Backtrace for this error:

Program received signal SIGFPE: Floating-point exception - erroneous arithmetic operation.
```
前面的并行信息也许可以参考
```
************************** Parallelization ***************************
Info: Octopus will run in *parallel*

      Number of processes           :      10
      Number of threads per process :       1

Info: Number of nodes in ParStates   group:     2 (       4)
Info: Number of nodes in ParDomains  group:     5 (  131995)
Info: Octopus will waste at least  0.00% of computer time.
**********************************************************************

************************** Parallelization ***************************
Info: Octopus will run in *parallel*

      Number of processes           :       4
      Number of threads per process :       1

Info: Number of nodes in ParStates   group:     4 (       4)
Info: Octopus will waste at least  0.00% of computer time.
**********************************************************************

************************** Parallelization ***************************
Info: Octopus will run in *parallel*

      Number of processes           :       5
      Number of threads per process :       1

Info: Number of nodes in ParDomains  group:     5 (  131995)
Info: Octopus will waste at least  0.00% of computer time.
**********************************************************************

************************** Parallelization ***************************
Info: Octopus will run in *parallel*

      Number of processes           :       6
      Number of threads per process :       1

Info: Number of nodes in ParStates   group:     3 (       4)
Info: Number of nodes in ParDomains  group:     2 (  131995)

** Warning:
**   Info: Octopus will waste at least 33.33% of computer time.
**   Usually a number of processors which is a multiple of small primes is best.

```




------
>本博客所有文章除特别声明外，均采用 [CC BY-SA 4.0 协议](https://creativecommons.org/licenses/by-sa/4.0/deed.zh) ，转载请注明出处！
