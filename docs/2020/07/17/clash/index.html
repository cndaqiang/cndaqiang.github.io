<!DOCTYPE html>
<html style="filter:grayscale(0%);">

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    

    <title>Linuxä½¿ç”¨clash</title>
    <meta name="description" content="">

    <link rel="shortcut icon" href="/favicon.jpg?" type="image/x-icon">
    <link rel="icon" href="/favicon.jpg?" type="image/x-icon">
    <!---2020-01-17 change font-awesome-->
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/4.7.0/css/font-awesome.css">
    <!--- 
    <link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"> 
    -->
    <link rel="stylesheet" href="/css/cndaqiang.css"> 
	<!---å›¾æ ‡cdn iconï¼Œæ¯æ¬¡åœ¨iconfontä¸­æ·»åŠ ä¸€ä¸ªå›¾æ ‡ï¼Œè¿™ä¸ªé“¾æ¥å°±è¦æ›´æ–°--->
   <link rel="stylesheet" href="https://at.alicdn.com/t/font_461356_ofctiykkk5.css">
	 <link rel="stylesheet" href="/css/main.css ">
   <link rel="canonical" href="http://0.0.0.0:4000/2020/07/17/clash/">
   <link rel="alternate" type="application/rss+xml" title="cndaqiang" href="http://0.0.0.0:4000/feed.xml ">


    <script>
    // ç™¾åº¦ç»Ÿè®¡ä»£ç 
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?8ba332e6517ae0ba8a13339285d97bb3";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
    </script>



<!-- è°·æ­Œç»Ÿè®¡ --><!-- è·¨ç½‘åŸŸè·Ÿè¸ª -->
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?UA-109057291-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-109057291-1');
</script>



<script defer src="https://cloud.umami.is/script.js" data-website-id="27e72116-bcc0-4a4d-82a5-485b4105820e"></script>


<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
    tex2jax: { inlineMath: [["$","$"],["\\(","\\)"]] },
    "HTML-CSS": {
      linebreaks: { automatic: true, width: "container" }
    }
});
</script>
<script type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<!---   è°·æ­Œcseç«™å†…æœç´¢-->
<!--- <script async src="https://cse.google.com/cse.js?cx=011772597085732398296:uzswyrqhpft"></script>
--->





</head>


  <body>

    <!-- å¤‡æ¡ˆä¸æ˜¾ç¤ºé•œåƒ-->


<header id="top">
    <div class="wrapper">
      
        <a href="/" class="brand">cndaqiang</a>
        <small>Web Linux DFT</small> 
        
        <button id="headerMenu" class="menu"><i class="fa fa-bars"></i></button>
        <nav id="headerNav">
            <ul>
                <li>
                    
                    <a href="/">
                    
                        <i class="fa fa-home"></i>Home
                    </a>
                </li>

                
                    
                    <li>
                        
                        <a href="/archive/">
                        
                            <i class="fa fa-archive"></i>ä¸“æ 
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/collection/">
                        
                            <i class="fa fa-bookmark"></i>å·¥å…·
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/category/">
                        
                            <i class="fa fa-th-list"></i>åˆ†ç±»
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/tag/">
                        
                            <i class="fa fa-tags"></i>æ ‡ç­¾
                        </a>
                    </li>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>
        </nav>
    </div>
</header>


        <!---æ–‡ç« é¡µé¢--->

<div class="page clearfix" post>
    <div class="left">
        <h1>Linuxä½¿ç”¨clash</h1>
        <div class="label">

            <div class="label-card">
                <i class="fa fa-calendar"></i>2020-07-17
            </div>

            <div class="label-card">
                <i class="fa fa-user"></i>cndaqiang
                
            </div>

            <div class="label-card">
                
            </div>

            <div class="label-card">
            


<!-- <span class="point">â€¢</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#Linux" title="Category: Linux" rel="category">Linux</a>
    
  

  <!-- <span class="point">â€¢</span> -->
</span>


            </div>

            <div class="label-card">
            
<!-- <span class="point">â€¢</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <!--a href="/tag/#clash" title="Tag: clash" rel="tag">clash</a-->
        <a href="/tag/#clash" title="Tag: clash" rel="tag">clash</a>
    
  

</span>


            </div>
            <!--- 2020-01-17 RSS-->
            <div class="label-card">
                <a href="/feed.xml" title="RSS"><i class="fa fa-rss-square" aria-hidden="true"></i>RSS</a>
            </div>

            <div class="label-card">
                <a href="https://github.com/cndaqiang/cndaqiang.github.io" title="RSS"><i class="fa fa-thumbs-o-up" aria-hidden="true"></i>Star</a>
            </div>
            
            <!--- github start , copy from https://github.com/mdo/github-buttons--->
            <!---
            <div>
                <iframe src="/html_script/github-btn.html?user=cndaqiang&repo=cndaqiang.github.io&type=star&count=true&size=large" frameborder="0" scrolling="0" width="160px" height="30px"></iframe>
            </div>
            --->

        </div>
        
        <hr>
        <article itemscope itemtype="http://schema.org/BlogPosting">
        <ul id="markdown-toc">
  <li><a href="#2022-06-20æ›´æ–°" id="markdown-toc-2022-06-20æ›´æ–°">2022-06-20æ›´æ–°</a></li>
  <li><a href="#2022-02-23æ›´æ–°" id="markdown-toc-2022-02-23æ›´æ–°">2022-02-23æ›´æ–°</a></li>
  <li><a href="#å‚è€ƒ" id="markdown-toc-å‚è€ƒ">å‚è€ƒ</a></li>
  <li><a href="#æ–‡ä»¶è¯´æ˜" id="markdown-toc-æ–‡ä»¶è¯´æ˜">æ–‡ä»¶è¯´æ˜</a></li>
  <li><a href="#ä¸‹è½½å®¢æˆ·ç«¯" id="markdown-toc-ä¸‹è½½å®¢æˆ·ç«¯">ä¸‹è½½å®¢æˆ·ç«¯</a></li>
  <li><a href="#åˆå§‹åŒ–ç¨‹åº" id="markdown-toc-åˆå§‹åŒ–ç¨‹åº">åˆå§‹åŒ–ç¨‹åº</a></li>
  <li><a href="#é…ç½®æ–‡ä»¶" id="markdown-toc-é…ç½®æ–‡ä»¶">é…ç½®æ–‡ä»¶</a>    <ul>
      <li><a href="#å¸¸ç”¨é…ç½®å‚æ•°" id="markdown-toc-å¸¸ç”¨é…ç½®å‚æ•°">å¸¸ç”¨é…ç½®å‚æ•°</a></li>
      <li><a href="#åˆ†ç»„è®¾ç½®" id="markdown-toc-åˆ†ç»„è®¾ç½®">åˆ†ç»„è®¾ç½®</a></li>
      <li><a href="#è§„åˆ™" id="markdown-toc-è§„åˆ™">è§„åˆ™</a></li>
    </ul>
  </li>
  <li><a href="#è¿è¡Œ" id="markdown-toc-è¿è¡Œ">è¿è¡Œ</a></li>
  <li><a href="#å…¶ä»–" id="markdown-toc-å…¶ä»–">å…¶ä»–</a>    <ul>
      <li><a href="#dashboardé…ç½®" id="markdown-toc-dashboardé…ç½®">dashboardé…ç½®</a>        <ul>
          <li><a href="#å…¬å…±dashboard" id="markdown-toc-å…¬å…±dashboard">å…¬å…±dashboard</a></li>
          <li><a href="#ç§æœ‰dashboard" id="markdown-toc-ç§æœ‰dashboard">ç§æœ‰dashboard</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#æ·»åŠ åˆ°å¿«æ·è„šæœ¬" id="markdown-toc-æ·»åŠ åˆ°å¿«æ·è„šæœ¬">æ·»åŠ åˆ°å¿«æ·è„šæœ¬</a></li>
  <li><a href="#è®¢é˜…ç›¸å…³" id="markdown-toc-è®¢é˜…ç›¸å…³">è®¢é˜…ç›¸å…³</a>    <ul>
      <li><a href="#subconverterè½¬æ¢è®¢é˜…urlä¸ºclashé…ç½®æ–‡ä»¶" id="markdown-toc-subconverterè½¬æ¢è®¢é˜…urlä¸ºclashé…ç½®æ–‡ä»¶">subconverterè½¬æ¢è®¢é˜…urlä¸ºclashé…ç½®æ–‡ä»¶</a>        <ul>
          <li><a href="#é€šè¿‡httpè½¬æ¢è®¢é˜…æ–‡ä»¶" id="markdown-toc-é€šè¿‡httpè½¬æ¢è®¢é˜…æ–‡ä»¶">é€šè¿‡httpè½¬æ¢è®¢é˜…æ–‡ä»¶</a></li>
          <li><a href="#æ¨èå‘½ä»¤è¡Œè½¬æ¢" id="markdown-toc-æ¨èå‘½ä»¤è¡Œè½¬æ¢">[æ¨è]å‘½ä»¤è¡Œè½¬æ¢</a></li>
          <li><a href="#è‡ªå®šä¹‰subconverterç”Ÿæˆçš„é…ç½®æ–‡ä»¶" id="markdown-toc-è‡ªå®šä¹‰subconverterç”Ÿæˆçš„é…ç½®æ–‡ä»¶">è‡ªå®šä¹‰subconverterç”Ÿæˆçš„é…ç½®æ–‡ä»¶</a></li>
        </ul>
      </li>
      <li><a href="#æœ‰é…ç½®æ–‡ä»¶åå¯åŠ¨clashå³å¯" id="markdown-toc-æœ‰é…ç½®æ–‡ä»¶åå¯åŠ¨clashå³å¯">æœ‰é…ç½®æ–‡ä»¶å,å¯åŠ¨clashå³å¯</a></li>
    </ul>
  </li>
  <li><a href="#æ–°æœåŠ¡å™¨ä»å¤´é…ç½®clash" id="markdown-toc-æ–°æœåŠ¡å™¨ä»å¤´é…ç½®clash">æ–°æœåŠ¡å™¨ä»å¤´é…ç½®clash</a></li>
  <li><a href="#openwrtè‡ªå®šä¹‰é…ç½®æ–‡ä»¶çš„ä¸€ç§æ–¹å¼" id="markdown-toc-openwrtè‡ªå®šä¹‰é…ç½®æ–‡ä»¶çš„ä¸€ç§æ–¹å¼">Openwrtè‡ªå®šä¹‰é…ç½®æ–‡ä»¶çš„ä¸€ç§æ–¹å¼</a></li>
  <li><a href="#è‡ªå·±åˆ›å»ºç­–ç•¥å¹¶é…ç½®åˆ†æµ" id="markdown-toc-è‡ªå·±åˆ›å»ºç­–ç•¥å¹¶é…ç½®åˆ†æµ">è‡ªå·±åˆ›å»ºç­–ç•¥å¹¶é…ç½®åˆ†æµ</a>    <ul>
      <li><a href="#ä¸ºäº†é¿å…gptè¢«å°å·è¿™é‡Œæ·»åŠ è‡ªå·±çš„èŠ‚ç‚¹è¿›è¡Œgptè®¿é—®" id="markdown-toc-ä¸ºäº†é¿å…gptè¢«å°å·è¿™é‡Œæ·»åŠ è‡ªå·±çš„èŠ‚ç‚¹è¿›è¡Œgptè®¿é—®">ä¸ºäº†é¿å…GPTè¢«å°å·ï¼Œè¿™é‡Œæ·»åŠ è‡ªå·±çš„èŠ‚ç‚¹è¿›è¡ŒGPTè®¿é—®.</a></li>
      <li><a href="#åˆ›å»ºä¸€ä¸ªåŒ…å«æ‰€æœ‰èŠ‚ç‚¹çš„ç¾¤ç»„" id="markdown-toc-åˆ›å»ºä¸€ä¸ªåŒ…å«æ‰€æœ‰èŠ‚ç‚¹çš„ç¾¤ç»„">åˆ›å»ºä¸€ä¸ªåŒ…å«æ‰€æœ‰èŠ‚ç‚¹çš„ç¾¤ç»„</a></li>
    </ul>
  </li>
  <li><a href="#macä½¿ç”¨clash" id="markdown-toc-macä½¿ç”¨clash">macä½¿ç”¨clash</a></li>
</ul>

<h2 id="2022-06-20æ›´æ–°">2022-06-20æ›´æ–°</h2>
<p>linuxçš„<a href="https://github.com/juewuy/ShellClash">shellå®¢æˆ·ç«¯:ShellClash</a></p>

<p>å¯ä»¥å¾ˆç®€å•çš„åœ¨æœåŠ¡å™¨å’Œopenwrtç­‰ç³»ç»Ÿä¸Šå¸ƒç½®clash.</p>

<h2 id="2022-02-23æ›´æ–°">2022-02-23æ›´æ–°</h2>
<p>linuxçš„<a href="https://github.com/Fndroid/clash_for_windows_pkg/releases">GUIå®¢æˆ·ç«¯:CFW</a>æœ‰äº†,é€‚åˆlinuxä½œä¸ºä¸»åŠ›æœºçš„ç”¨æˆ·</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget https://github.com/Fndroid/clash_for_windows_pkg/releases/download/0.19.8/Clash.for.Windows-0.19.8-x64-linux.tar.gz
tar xzvf Clash.for.Windows-0.19.8-x64-linux.tar.gz
cd Clash\ for\ Windows-0.19.8-x64-linux/
./cfw
</code></pre></div></div>

<p>ä¸‹é¢çš„æ–¹æ³•é€‚åˆä¸€å°æœåŠ¡å™¨ä¸Šè¿è¡Œclash,ç»™å±€åŸŸç½‘å†…å…¶ä»–æœºå™¨æä¾›ä»£ç†</p>

<h2 id="å‚è€ƒ">å‚è€ƒ</h2>
<p><a href="https://www.cnblogs.com/sueyyyy/p/12424178.html">linuxç¯å¢ƒä½¿ç”¨clashå®ç°ç½‘ç»œä»£ç†è®¿é—®å¤–ç½‘</a><br />
<a href="https://ytlee.cn/2021/04/clash-for-linux-automatically-renews-the-subscription-link/">Clash For Linuxè‡ªåŠ¨æ›´æ–°è®¢é˜…é…ç½®</a></p>

<h2 id="æ–‡ä»¶è¯´æ˜">æ–‡ä»¶è¯´æ˜</h2>
<ul>
  <li>å®¢æˆ·ç«¯ï¼Œå¯æ‰§è¡Œç¨‹åº:clash<br />
é¡¹ç›®åœ°å€:https://github.com/Dreamacro/clash</li>
  <li>é…ç½®æ–‡ä»¶:<code class="language-plaintext highlighter-rouge">~/.config/clash/config.yaml</code><br />
é‡Œé¢æ”¾ç€clashçš„æ¥å£,æ§åˆ¶å‚æ•°ï¼Œé“¾æ¥ä¿¡æ¯ç­‰</li>
  <li>ipæ•°æ®åº“<code class="language-plaintext highlighter-rouge">~/.config/clash/Country.mmdb</code><br />
å¯åŠ¨ç¨‹åºåä¼šè‡ªåŠ¨ä¸‹è½½ï¼Œä¸‹è½½å¤±è´¥ï¼Œç»ˆç«¯ä¼šæç¤ºé”™è¯¯ï¼Œå¤åˆ¶æç¤ºçš„ä¸‹è½½é“¾æ¥ï¼Œæ‰‹åŠ¨ä¸‹è½½æ”¾åˆ°<code class="language-plaintext highlighter-rouge">~/.config/clash/config.yaml</code></li>
</ul>

<h2 id="ä¸‹è½½å®¢æˆ·ç«¯">ä¸‹è½½å®¢æˆ·ç«¯</h2>
<p>ä¸‹è½½é¡µé¢,https://github.com/Dreamacro/clash/releases</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget https://github.com/Dreamacro/clash/releases/download/v1.9.0/clash-linux-amd64-v1.9.0.gz
gzip -d clash-linux-amd64-v1.9.0.gz
</code></pre></div></div>

<h2 id="åˆå§‹åŒ–ç¨‹åº">åˆå§‹åŒ–ç¨‹åº</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(python37) cndaqiang@girl:~/MyTools/clash$ ./clash-linux-amd64-v0.19.0
</code></pre></div></div>
<p>è‹¥æ— <code class="language-plaintext highlighter-rouge">~/.config/clash/config.yaml</code>ä¸<code class="language-plaintext highlighter-rouge">~/.config/clash/Country.mmdb</code>ä¼šæç¤ºï¼Œç„¶åè‡ªåŠ¨ä¸‹è½½</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cndaqiang@GIRL clash$ ./clash-linux-amd64-v1.9.0
INFO[0000] Can't find config, create a initial config file
INFO[0000] Can't find MMDB, start download
FATA[0011] Initial configuration directory error: Can't initial MMDB: Can't download MMDB: Get "https://github-production-release-asset-2e65be.s3.amazonaws.com/231014917/281a0e00-c369-11ea-8903-79a958b78b99?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAIWNJYAX4CSVEH53A%2F20200717%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20200717T124944Z&amp;X-Amz-Expires=300&amp;X-Amz-Signature=95c6abc781a12fad2be03e640220a1f01f67e580d60d4510b9d80e233a164fbc&amp;X-Amz-SignedHeaders=host&amp;actor_id=0&amp;repo_id=231014917&amp;response-content-disposition=attachment%3B%20filename%3DCountry.mmdb&amp;response-content-type=application%2Foctet-stream": net/http: TLS handshake timeout 
</code></pre></div></div>
<p>å¦‚æœä¸‹è½½ipæ•°æ®åº“å¤±è´¥ï¼Œäººä¸ºä»£ç†ä¸‹è½½åæ”¾åˆ°<code class="language-plaintext highlighter-rouge">~/.config/clash/</code></p>

<h2 id="é…ç½®æ–‡ä»¶">é…ç½®æ–‡ä»¶</h2>
<p>ç¼–è¾‘<code class="language-plaintext highlighter-rouge">~/.config/clash/config.yaml</code>æ–‡ä»¶,ä¹°çš„æœºåœºä¹Ÿæä¾›ç›¸åº”çš„é…ç½®æ–‡ä»¶,ä¹Ÿå¯ä»¥æŠŠæœºåœºæä¾›çš„è®¢é˜…åœ°å€æŒ‰ç…§<a href="/2020/07/17/clash/#%E8%AE%A2%E9%98%85%E7%9B%B8%E5%85%B3">ä¸‹é¢çš„æ–¹å¼</a>ç”Ÿæˆé…ç½®æ–‡ä»¶</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#httpä»£ç†
port: 10091
#socksä»£ç†
socks-port: 10092
#æ˜¯å¦å…è®¸å±€åŸŸç½‘è¿æ¥
allow-lan: true
#è¿è¡Œæ¨¡å¼: è§„åˆ™Rule,å…¨å±€Global,ç›´è¿Direct
mode: Global
log-level: silent
#ç½‘é¡µç®¡ç†ipå’Œç«¯å£
external-controller: '0.0.0.0:10090'
#ç®¡ç†å¯†ç 
secret: ''
#ä¸€å †ä»£ç†
Proxy:
  -
    name: xxxx
    type: trojan
    server: xxxx
    port: xxxx
    password: xxxx
    sni: xxx
</code></pre></div></div>
<h3 id="å¸¸ç”¨é…ç½®å‚æ•°">å¸¸ç”¨é…ç½®å‚æ•°</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mixed-port: 10092
allow-lan: true
mode: Rule
bind-address: '192.168.192.204'
external-controller: 192.168.192.204:9090
ipv6: true
</code></pre></div></div>

<h3 id="åˆ†ç»„è®¾ç½®">åˆ†ç»„è®¾ç½®</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>proxy-groups:
  - name: ğŸ”° èŠ‚ç‚¹é€‰æ‹© #ç»„å
    type: select     #ç±»å‹,é€‰æ‹©
    proxies:         #é€‰é¡¹
      - â™»ï¸è‡ªåŠ¨é€‰æ‹©   #å…¶ä»–åˆ†ç»„
      - ğŸ¯ å…¨çƒç›´è¿  #å…¶ä»–åˆ†ç»„
      - å…¬ç›Š|æ–°åŠ å¡é«˜é€ŸèŠ‚ç‚¹|H.Kä¸­è½¬|1Gps  #ä»£ç†èŠ‚ç‚¹
  - name: â™»ï¸è‡ªåŠ¨é€‰æ‹©
    type: url-test #æµ‹è¯•url
    url: http://www.gstatic.com/generate_204
    interval: 300
    proxies:
      - å…¬ç›Š|æ–°åŠ å¡é«˜é€ŸèŠ‚ç‚¹|H.Kä¸­è½¬|1Gps
</code></pre></div></div>

<h3 id="è§„åˆ™">è§„åˆ™</h3>
<p>æŒ‡å®šç¬¦åˆè§„åˆ™çš„åŸŸåé‡‡ç”¨çš„åˆ†ç»„</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rules:
 - DOMAIN-SUFFIX,local,ğŸ¯ å…¨çƒç›´è¿
 - IP-CIDR,192.168.0.0/16,ğŸ¯ å…¨çƒç›´è¿,no-resolve
 - DOMAIN-SUFFIX,android.com,ğŸ”° èŠ‚ç‚¹é€‰æ‹©
 - DOMAIN-KEYWORD,XLLiveUD,ğŸ¯ å…¨çƒç›´è¿
 - GEOIP,CN,ğŸ¯ å…¨çƒç›´è¿
 - MATCH,ğŸŸ æ¼ç½‘ä¹‹é±¼    #å…¶ä»–ç½‘ç«™é€‰æ‹©ğŸŸ æ¼ç½‘ä¹‹é±¼åˆ†ç»„
</code></pre></div></div>

<p>è§„åˆ™å®šä¹‰</p>
<ul>
  <li>DOMAIN-SUFFIXï¼šåŸŸååç¼€åŒ¹é…</li>
  <li>DOMAINï¼šåŸŸååŒ¹é…</li>
  <li>DOMAIN-KEYWORDï¼šåŸŸåå…³é”®å­—åŒ¹é…</li>
  <li>IP-CIDRï¼šIP æ®µåŒ¹é…</li>
  <li>SRC-IP-CIDRï¼šæº IP æ®µåŒ¹é…</li>
  <li>GEOIPï¼šGEOIP æ•°æ®åº“ï¼ˆå›½å®¶ä»£ç ï¼‰åŒ¹é…</li>
  <li>DST-PORTï¼šç›®æ ‡ç«¯å£åŒ¹é…</li>
  <li>SRC-PORTï¼šæºç«¯å£åŒ¹é…</li>
  <li>PROCESS-NAMEï¼šæºè¿›ç¨‹ååŒ¹é…</li>
  <li>RULE-SETï¼šRule Provider è§„åˆ™åŒ¹é…</li>
  <li>MATCHï¼šå…¨åŒ¹é…</li>
</ul>

<p><strong>è§„åˆ™é å‰çš„ä¼˜å…ˆçº§é«˜</strong>,æˆ‘ä»¬è¦æ’å…¥è‡ªå®šä¹‰è§„åˆ™,è¦æ’åœ¨<code class="language-plaintext highlighter-rouge">MATCHï¼šå…¨åŒ¹é…</code>çš„å‰é¢</p>

<h2 id="è¿è¡Œ">è¿è¡Œ</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cndaqiang@GIRL clash$ ./clash-linux-amd64-v1.9.0
</code></pre></div></div>
<p>æµè§ˆå™¨æ·»åŠ è®¾ç½®çš„http/socksä»£ç†</p>

<h2 id="å…¶ä»–">å…¶ä»–</h2>
<h3 id="dashboardé…ç½®">dashboardé…ç½®</h3>
<h4 id="å…¬å…±dashboard">å…¬å…±dashboard</h4>
<p>ç½‘é¡µæ‰“å¼€<a href="http://clash.razord.top/">http://clash.razord.top/</a>,é€‰æ‹©è®¾ç½®ï¼Œç‚¹å‡»ç¼–è¾‘å¤–éƒ¨æ§åˆ¶è®¾ç½®æ—è¾¹çš„è“è‰²ip:ç«¯å£<br />
å…¶ä»–çš„GUIç®¡ç†ç½‘é¡µä¹Ÿæ˜¯å¯ä»¥çš„<a href="http://yacd.haishan.me/">http://yacd.haishan.me/</a>.</p>

<p>å¡«å…¥é…ç½®æ–‡ä»¶ä¸­çš„ç®¡ç†ipç«¯å£å¯†ç ï¼Œè¿ä¸Šclash
<img src="/uploads/2020/07/clash.png" alt="" />
ä¹‹åå¯ä»¥ç»§ç»­åœ¨è¿™é‡Œè®¾ç½®ç«¯å£å’Œå…¶ä»–ç®¡ç†<br />
<strong>è¿™é‡Œçš„ç»“æœå¹¶ä¸ä¼šä¿å­˜åˆ°é…ç½®æ–‡ä»¶ï¼Œå°±æ˜¯ä¸´æ—¶ç”Ÿæ•ˆ</strong>
<img src="/uploads/2020/07/clash2.png" alt="" />
<strong>åœ¨ä»£ç†é‡Œé€‰æ‹©ä½¿ç”¨çš„æœåŠ¡å™¨</strong>
<img src="/uploads/2020/07/clash3.png" alt="" /></p>

<h4 id="ç§æœ‰dashboard">ç§æœ‰dashboard</h4>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd $CLASHDIR/ui
git clone git@github.com:Dreamacro/clash-dashboard.git
cd 
git checkout gh-pages
</code></pre></div></div>
<p>å¯ä»¥æŠŠ<code class="language-plaintext highlighter-rouge">clash-dashboard</code>ç›®å½•ç›´æ¥æ”¾åˆ°æœåŠ¡å™¨çš„webç›®å½•,è¿›è¡Œè®¿é—®(http://mom/clash-dashboard/#/proxies),ä¹Ÿå¯ä»¥ç”¨clashæä¾›çš„webæœåŠ¡(192.168.192.204/ui)è¿›è¡Œè®¿é—®,ä½¿ç”¨clashçš„æœåŠ¡éœ€è¦æ·»åŠ å‚æ•°<code class="language-plaintext highlighter-rouge">external-ui</code></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>external-controller: 192.168.192.204:9090
external-ui: /home/cndaqiang/soft/clash/ui/clash-dashboard
</code></pre></div></div>
<p>ä¹Ÿå¯ä»¥ç”¨å…¶ä»–çš„dashboard:<a href="https://github.com/haishanh/yacd">yacd</a></p>

<h2 id="æ·»åŠ åˆ°å¿«æ·è„šæœ¬">æ·»åŠ åˆ°å¿«æ·è„šæœ¬</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#å¯åŠ¨clash
pkill -f clash-linux-amd64-v1.9.0; sleep 10; nohup $HOME/MyTools/clash/clash-linux-amd64-v1.9.0 &gt; /tmp/clash.pid &amp;
</code></pre></div></div>

<h2 id="è®¢é˜…ç›¸å…³">è®¢é˜…ç›¸å…³</h2>
<h3 id="subconverterè½¬æ¢è®¢é˜…urlä¸ºclashé…ç½®æ–‡ä»¶">subconverterè½¬æ¢è®¢é˜…urlä¸ºclashé…ç½®æ–‡ä»¶</h3>
<p>ä¸‹è½½<a href="https://github.com/tindy2013/subconverter">subconverter</a>,è§£å‹,</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget https://github.com/tindy2013/subconverter/releases/download/v0.7.1/subconverter_linux64.tar.gz
tar xzvf subconverter_linux64.tar.gz
</code></pre></div></div>

<p>åˆ©ç”¨ä¸‹é¢ä¸¤ç§æ–¹å¼ç”Ÿæˆ<code class="language-plaintext highlighter-rouge">config.yml</code>,å¹¶å¤åˆ¶åˆ°clashé…ç½®ç›®å½•</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cndaqiang@GIRL subconverter$ cp config.yml ~/.config/clash/config.yaml
</code></pre></div></div>

<h4 id="é€šè¿‡httpè½¬æ¢è®¢é˜…æ–‡ä»¶">é€šè¿‡httpè½¬æ¢è®¢é˜…æ–‡ä»¶</h4>
<p>é€‚åˆæ­å»ºè½¬æ¢æœåŠ¡å™¨,ä¾›æ‰€æœ‰çš„æœºå™¨ä½¿ç”¨</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cndaqiang@GIRL subconverter$ ./subconverter
2022/02/21 Mon 21:15:44.125582 [1058 10739384][INFO] SubConverter v0.7.1 starting up..
2022/02/21 Mon 21:15:44.127224 [1058 10739384][INFO] Reading preference settings...
......
2022/02/21 Mon 21:15:44.164532 [1058 10739384][INFO] Startup completed. Serving HTTP @ http://0.0.0.0:25500
</code></pre></div></div>
<p>ä½¿ç”¨httpè·å–clashé…ç½®æ–‡ä»¶, ç½‘å€è§„åˆ™è¯¦è§<a href="https://github.com/tindy2013/subconverter/blob/master/README-cn.md">README-cn.md</a>,æ³¨æ„è¦æŠŠè®¢é˜…è¿æ¥è½¬ä¸º<a href="https://www.urlencoder.org/">URLEncode</a>,ç¤ºä¾‹</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cndaqiang@GIRL tmp$ curl -s "http://127.0.0.1:25500/sub?target=clash&amp;url=http%3A%2F%2Fdy.clashweb.site%2Fapi%2Fv1%2Fclient%2Fsubscribe%3Ftoken%3Dcndaqiangstoken" &gt; config.yaml
cndaqiang@GIRL tmp$ head  config.yaml
port: 7890
socks-port: 7891
allow-lan: true
mode: Rule
log-level: info
external-controller: :9090
proxies:
  - {name: æ—¥æœ¬01-CM-2.0, server: xxx.gz.cm.888022.site, port: 32224, type: ss, cipher: chacha20-ietf-poly1305, password: ec684a62-be94-47f6-820c-779e4d921234, udp: true}
  ...
</code></pre></div></div>
<p>æ ¹æ®URLEncodeçš„æ ¼å¼ä¹Ÿå¯ä»¥è‡ªå·±å†™ä¸€ä¸ª</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cndaqiang@GIRL tmp$ curl -s "http://127.0.0.1:25500/sub?target=clash&amp;url="$(echo "http://dy.clashweb.site/api/v1/client/subscribe?token=cndaqiangstoken" | sed  "s|/|%2F|g" | sed  "s|:|%3A|g"  | sed  "s|?|%3F|g")
</code></pre></div></div>
<h4 id="æ¨èå‘½ä»¤è¡Œè½¬æ¢">[æ¨è]å‘½ä»¤è¡Œè½¬æ¢</h4>
<p>ä¿®æ”¹é…ç½®æ–‡ä»¶,è‡ªå®šä¹‰é…ç½®ç±»å‹<code class="language-plaintext highlighter-rouge">[cndaqiang]</code>,urlå¯ä»¥ä¸ºæ–‡ä»¶ä¹Ÿå¯ä»¥ä¸ºè®¢é˜…åœ°å€</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cndaqiang@GIRL subconverter$ vi generate.ini
#å†…å®¹å¦‚ä¸‹
[cndaqiang]
path=config.yml
target=clash
ver=4
url=http://dy.clashweb.site/api/v1/client/subscribe?token=cndaqiangstoken
</code></pre></div></div>
<p>ç”Ÿæˆé…ç½®æ–‡ä»¶<code class="language-plaintext highlighter-rouge">config.yml</code></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cndaqiang@GIRL subconverter$ ./subconverter -g --artifact "cndaqiang"
#è¿™é‡Œç”Ÿæˆçš„æ˜¯config.yml,é…ç½®æ–‡ä»¶æ—¶yaml
cndaqiang@GIRL subconverter$ cp config.yml ~/.config/clash/config.yaml
</code></pre></div></div>

<h4 id="è‡ªå®šä¹‰subconverterç”Ÿæˆçš„é…ç½®æ–‡ä»¶">è‡ªå®šä¹‰subconverterç”Ÿæˆçš„é…ç½®æ–‡ä»¶</h4>
<p><strong>ç®€å•ç²—æš´å°±ç›´æ¥ä¿®æ”¹<code class="language-plaintext highlighter-rouge">vi base/all_base.tpl</code>å°±å¯ä»¥</strong><br /></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
port: { { default(global.clash.http_port, "7890") } }
...
</code></pre></div></div>

<p>åœ¨<code class="language-plaintext highlighter-rouge">vi pref.toml</code>ä¸­è®¾ç½®æ¨¡æ¿ä¹Ÿå¯ä»¥</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
[[template.globals]]
key = "clash.http_port"
value = "7890"
...
</code></pre></div></div>

<h3 id="æœ‰é…ç½®æ–‡ä»¶åå¯åŠ¨clashå³å¯">æœ‰é…ç½®æ–‡ä»¶å,å¯åŠ¨clashå³å¯</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cndaqiang@GIRL clash$ ./clash-linux-amd64-v1.8.0
INFO[0000] Start initial compatible provider ğŸ”° èŠ‚ç‚¹é€‰æ‹©
INFO[0000] Start initial compatible provider ğŸ›‘ å…¨çƒæ‹¦æˆª
INFO[0000] Start initial compatible provider ğŸš« è¿è¥åŠ«æŒ
</code></pre></div></div>
<p>1.9ç‰ˆæœ¬è™½ç„¶æŠ¥é”™<code class="language-plaintext highlighter-rouge">ERRO[0000] Start DNS server error: missing port in address</code>,ä½†æ˜¯ä¸å½±å“ä½¿ç”¨</p>

<h2 id="æ–°æœåŠ¡å™¨ä»å¤´é…ç½®clash">æ–°æœåŠ¡å™¨ä»å¤´é…ç½®clash</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd $HOME/soft
CLASHDIR=$PWD/clash
mkdir $CLASHDIR
mkdir $CLASHDIR/bin
mkdir $CLASHDIR/log
mkdir $CLASHDIR/ui
cd $CLASHDIR
#giteeå¤‡ä»½
version=clash-linux-amd64-v1.9.0
wget http://cndaqiang.gitee.io/packages//mirrors/clash/${version}.gz
gzip -d ${version}.gz
chmod +x $version
#ç”Ÿæˆé…ç½®æ–‡ä»¶
./$version
#åˆå§‹åŒ–å®Œæˆåç»ˆæ­¢

#ä¸‹è½½subconvert
wget https://github.com/tindy2013/subconverter/releases/download/v0.7.1/subconverter_linux64.tar.gz
tar xzvf subconverter_linux64.tar.gz
cd $CLASHDIR/subconverter
cat &gt;&gt; generate.ini &lt;&lt;EOF
[cndaqiang]
path=config.yml
target=clash
ver=4
url=http://dy.clashweb.site/api/v1/client/subscribe?token=cndaqiangstoken
#å½“ç½‘ç»œç¯å¢ƒä¸å¥½æ—¶ï¼Œä½¿ç”¨æå‰ä¸‹è½½åæ”¾åˆ°æœ¬åœ°çš„wwwç›®å½•ä¸´æ—¶å¯ç”¨ä¹Ÿå¯
EOF
#

#æœ¬åœ°dashboardå¯é€‰
cd $CLASHDIR/ui
git clone git@github.com:Dreamacro/clash-dashboard.git
git checkout gh-pages
     
#æ”¹clashå‚æ•°          
vi base/all_base.tpl
#
./subconverter -g --artifact "cndaqiang"
cp $CLASHDIR/subconverter/config.yml $HOME/.config/clash/config.yaml


#æ‰§è¡Œ
ln -s $CLASHDIR/$version $CLASHDIR/bin/clash
$CLASHDIR/bin/clash


#é…ç½®æ–‡ä»¶ä½¿ç”¨ç³»ç»ŸæœåŠ¡å¯åŠ¨
cd $CLASHDIR/bin/
cat &gt;  restart-clash.sh &lt;&lt;EOF
#!/bin/bash
PIDFILE=$CLASHDIR/log/clash.pid
if [ -f \$PIDFILE ]
then
kill -9 \$(cat \$PIDFILE )
fi
#ç”Ÿæˆæ–°çš„PIDæ–‡ä»¶
echo \$\$ &gt; \$PIDFILE 
#æ–°é…ç½®æ–‡ä»¶
rm -rf $CLASHDIR/subconverter/config.yml
$CLASHDIR/subconverter/subconverter -g --artifact "cndaqiang"
if [ -f $CLASHDIR/subconverter/config.yml ]
then
        echo ä¸‹è½½$CLASHDIR/subconverter/config.ymlæˆåŠŸ
        cp $CLASHDIR/subconverter/config.yml $CLASHDIR/subconverter/config.yml.bak
else
        echo ä¸‹è½½å¤±è´¥ï¼Œä½¿ç”¨å¤‡ä»½$CLASHDIRh/subconverter/config.yml.bak
        cp $CLASHDIR/subconverter/config.yml.bak $CLASHDIR/subconverter/config.yml
fi


#æ·»åŠ è‡ªå®šä¹‰çš„è§„åˆ™, å¦‚libgenèµ°ä»£ç†
line=\$(grep -rn rules $CLASHDIR/subconverter/config.yml | awk  -F: '{ print \$1 }')

sed -i \${line}a'\ - DOMAIN-KEYWORD,libgen,â™»ï¸ è‡ªåŠ¨é€‰æ‹©          ' $CLASHDIR/subconverter/config.yml
sed -i \${line}a'\ - DOMAIN-KEYWORD,sci-hub,â™»ï¸ è‡ªåŠ¨é€‰æ‹©         ' $CLASHDIR/subconverter/config.yml      
sed -i \${line}a'\ - DOMAIN-KEYWORD,sciencedirect,ğŸ¯ å…¨çƒç›´è¿   ' $CLASHDIR/subconverter/config.yml    
sed -i \${line}a'\ - DOMAIN-SUFFIX,aps.org,ğŸ¯ å…¨çƒç›´è¿          ' $CLASHDIR/subconverter/config.yml       
sed -i \${line}a'\ - DOMAIN-SUFFIX,webofscience.com,ğŸ¯ å…¨çƒç›´è¿ ' $CLASHDIR/subconverter/config.yml             
sed -i \${line}a'\ - DOMAIN-SUFFIX,iop.org,ğŸ¯ å…¨çƒç›´è¿          ' $CLASHDIR/subconverter/config.yml           
sed -i \${line}a'\ - DOMAIN-SUFFIX,scitation.org,ğŸ¯ å…¨çƒç›´è¿    ' $CLASHDIR/subconverter/config.yml                 
sed -i \${line}a'\ - DOMAIN-SUFFIX,elsevier.com,ğŸ¯ å…¨çƒç›´è¿     ' $CLASHDIR/subconverter/config.yml                
sed -i \${line}a'\ - DOMAIN-SUFFIX,wiley.com,ğŸ¯ å…¨çƒç›´è¿        ' $CLASHDIR/subconverter/config.yml             
sed -i \${line}a'\ - DOMAIN-SUFFIX,acs.org,ğŸ¯ å…¨çƒç›´è¿          ' $CLASHDIR/subconverter/config.yml           
sed -i \${line}a'\ - DOMAIN-SUFFIX,nih.gov,ğŸ¯ å…¨çƒç›´è¿          ' $CLASHDIR/subconverter/config.yml           
sed -i \${line}a'\ - DOMAIN-SUFFIX,springer.com,ğŸ¯ å…¨çƒç›´è¿     ' $CLASHDIR/subconverter/config.yml                
sed -i \${line}a'\ - DOMAIN-SUFFIX,nature.com,ğŸ¯ å…¨çƒç›´è¿       ' $CLASHDIR/subconverter/config.yml              
sed -i \${line}a'\ - DOMAIN-SUFFIX,science.org,ğŸ¯ å…¨çƒç›´è¿      ' $CLASHDIR/subconverter/config.yml               
sed -i \${line}a'\ - DOMAIN-SUFFIX,jps.jp,ğŸ¯ å…¨çƒç›´è¿      ' $CLASHDIR/subconverter/config.yml               
sed -i ${line}a'\ - DOMAIN-SUFFIX,xiaomi.eu,â™»ï¸ è‡ªåŠ¨é€‰æ‹©      ' /home/cndaqiang/soft/clash/subconverter/config.yml

diff $CLASHDIR/subconverter/config.yml $HOME/.config/clash/config.yaml
#å¦‚æœä¸¤ä¸ªæ–‡ä»¶ä¸€è‡´ï¼Œå°±ç›´æ¥å¼€å¯clashï¼Œå¦‚æœä¸ä¸€è‡´å°±ç”Ÿæˆå¤‡ä»½æ—§æ–‡ä»¶å¹¶ä¸‹è½½æ›¿æ¢æ–°çš„æ–‡ä»¶
if [ ! "\$?" == 0 ]
then
  cp  $CLASHDIR/subconverter/config.yml $HOME/.config/clash/config.yaml
fi
#
#æ‰§è¡Œ
$CLASHDIR/bin/clash | tee $CLASHDIR/log/clash.log
EOF

chmod +x restart-clash.sh
#ç»ˆæ­¢æ–‡ä»¶
cat &gt;  stop-clash.sh &lt;&lt;EOF
#!/bin/bash
PIDFILE=$CLASHDIR/log/clash.pid
if [ -f \$PIDFILE ]
then
kill -9 \$(cat \$PIDFILE )
fi
EOF
chmod +x stop-clash.sh

#é…ç½®åŸºäºç”¨æˆ·èº«ä»½(æŠŠcndaqiangæ¢æˆè‡ªå·±çš„ç”¨æˆ·å)çš„ç³»ç»ŸæœåŠ¡
cat &gt; $CLASHDIR/bin/clash.service &lt;&lt;EOF
[Unit]
[Service]
User=cndaqiang
Group=cndaqiang
ExecStart=$CLASHDIR/bin/restart-clash.sh
ExecStop=$CLASHDIR/bin/stop-clash.sh
TimeoutSec=0
StandardOutput=tty
RemainAfterExit=yes
[Install]
WantedBy=multi-user.target
EOF

sudo cp $CLASHDIR/bin/clash.service /etc/systemd/system/clash.service
#å¯åŠ¨æœåŠ¡
sudo systemctl start clash
#å¼€æœºå¯åŠ¨
sudo systemctl enable clash

#å¦‚åªåœ¨zerotierçš„å†…ç½‘ä½¿ç”¨clash,åœ¨`/etc/rc.local`ä¸­æ·»åŠ 
systemctl start clash

#è®¡åˆ’ä»»åŠ¡ï¼Œæ¯å¤©ä¸€ç‚¹æ›´æ–°clash
crontab -e
0 1 * * * systemctl restart clash
</code></pre></div></div>

<h2 id="openwrtè‡ªå®šä¹‰é…ç½®æ–‡ä»¶çš„ä¸€ç§æ–¹å¼">Openwrtè‡ªå®šä¹‰é…ç½®æ–‡ä»¶çš„ä¸€ç§æ–¹å¼</h2>
<p>å®‰è£…è½¯ä»¶åŒ…</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>opkg update
opkg install subconverter diffutils
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CLASHDIR=$HOME/clash
mylocalconfig=$HOME/clash/mylocalconfig.yaml
mkdir -p $CLASHDIR
mkdir $CLASHDIR/bin
mkdir $CLASHDIR/log
ln -s /etc/openclash/clash $CLASHDIR/bin/
cp -r /etc/subconverter $CLASHDIR/subconverter
#å¯ä»¥é€‚å½“ä¿®æ”¹clashç”Ÿæˆå‚æ•°
#vi base/all_base.tpl =&gt; mixed-port: N
#è¾“å…¥æ–‡ä»¶
cat &gt; $CLASHDIR/subconverter/generate.ini &lt;&lt;EOF
[cndaqiang]
path=config.yml
target=clash
ver=4
url=http://dy.clashweb.site/api/v1/client/subscribe?token=cndaqiangstoken
#å½“ç½‘ç»œç¯å¢ƒä¸å¥½æ—¶ï¼Œä½¿ç”¨æå‰ä¸‹è½½åæ”¾åˆ°æœ¬åœ°çš„wwwç›®å½•ä¸´æ—¶å¯ç”¨ä¹Ÿå¯
EOF
#

#é…ç½®æ–‡ä»¶ä½¿ç”¨ç³»ç»ŸæœåŠ¡å¯åŠ¨
cat &gt;  $CLASHDIR/bin/restart-clash.sh &lt;&lt;EOF
#!/bin/bash
PIDFILE=$CLASHDIR/log/clash.pid
if [ -f \$PIDFILE ]
then
kill -9 \$(cat \$PIDFILE )
fi
#ç”Ÿæˆæ–°çš„PIDæ–‡ä»¶
echo \$\$ &gt; \$PIDFILE
#
#æ–°é…ç½®æ–‡ä»¶
rm -rf $CLASHDIR/subconverter/config.yml
cd $CLASHDIR/subconverter/
subconverter -g --artifact "cndaqiang"
if [ -f $CLASHDIR/subconverter/config.yml ]
then
        echo ä¸‹è½½$CLASHDIR/subconverter/config.ymlæˆåŠŸ
        cp $CLASHDIR/subconverter/config.yml $CLASHDIR/subconverter/config.yml.bak
else
        echo ä¸‹è½½å¤±è´¥ï¼Œä½¿ç”¨å¤‡ä»½$CLASHDIRh/subconverter/config.yml.bak
        cp $CLASHDIR/subconverter/config.yml.bak $CLASHDIR/subconverter/config.yml
fi
#
#æ·»åŠ è‡ªå®šä¹‰çš„è§„åˆ™, å¦‚libgenèµ°ä»£ç†
line=\$(grep -rn rules $CLASHDIR/subconverter/config.yml | awk  -F: '{ print \$1 }')
sed -i \${line}a'\ \ - DOMAIN-KEYWORD,libgen,â™»ï¸ è‡ªåŠ¨é€‰æ‹©           ' $CLASHDIR/subconverter/config.yml
sed -i \${line}a'\ \ - DOMAIN-KEYWORD,sci-hub,â™»ï¸ è‡ªåŠ¨é€‰æ‹©          ' $CLASHDIR/subconverter/config.yml      
sed -i \${line}a'\ \ - DOMAIN-KEYWORD,sciencedirect,ğŸ¯ å…¨çƒç›´è¿   ' $CLASHDIR/subconverter/config.yml    
sed -i \${line}a'\ \ - DOMAIN-SUFFIX,aps.org,ğŸ¯ å…¨çƒç›´è¿          ' $CLASHDIR/subconverter/config.yml       
sed -i \${line}a'\ \ - DOMAIN-SUFFIX,webofscience.com,ğŸ¯ å…¨çƒç›´è¿ ' $CLASHDIR/subconverter/config.yml             
sed -i \${line}a'\ \ - DOMAIN-SUFFIX,iop.org,ğŸ¯ å…¨çƒç›´è¿          ' $CLASHDIR/subconverter/config.yml           
sed -i \${line}a'\ \ - DOMAIN-SUFFIX,scitation.org,ğŸ¯ å…¨çƒç›´è¿    ' $CLASHDIR/subconverter/config.yml                 
sed -i \${line}a'\ \ - DOMAIN-SUFFIX,elsevier.com,ğŸ¯ å…¨çƒç›´è¿     ' $CLASHDIR/subconverter/config.yml                
sed -i \${line}a'\ \ - DOMAIN-SUFFIX,wiley.com,ğŸ¯ å…¨çƒç›´è¿        ' $CLASHDIR/subconverter/config.yml             
sed -i \${line}a'\ \ - DOMAIN-SUFFIX,acs.org,ğŸ¯ å…¨çƒç›´è¿          ' $CLASHDIR/subconverter/config.yml           
sed -i \${line}a'\ \ - DOMAIN-SUFFIX,nih.gov,ğŸ¯ å…¨çƒç›´è¿          ' $CLASHDIR/subconverter/config.yml           
sed -i \${line}a'\ \ - DOMAIN-SUFFIX,springer.com,ğŸ¯ å…¨çƒç›´è¿     ' $CLASHDIR/subconverter/config.yml                
sed -i \${line}a'\ \ - DOMAIN-SUFFIX,nature.com,ğŸ¯ å…¨çƒç›´è¿       ' $CLASHDIR/subconverter/config.yml              
sed -i \${line}a'\ \ - DOMAIN-SUFFIX,science.org,ğŸ¯ å…¨çƒç›´è¿      ' $CLASHDIR/subconverter/config.yml               
sed -i \${line}a'\ \ - DOMAIN-SUFFIX,jps.jp,ğŸ¯ å…¨çƒç›´è¿           ' $CLASHDIR/subconverter/config.yml               
sed -i \${line}a'\ \ - DOMAIN-SUFFIX,xiaomi.eu,â™»ï¸ è‡ªåŠ¨é€‰æ‹©         ' $CLASHDIR/subconverter/config.yml
#
#åˆ›å»ºæ–°ç­–ç•¥ç»„(è‡ªåŠ¨ç­›é€‰èŠ‚ç‚¹)
sourceFile=$CLASHDIR/subconverter/config.yml
includeFile=\${sourceFile}.chat.cndaqiang.in
echo "  - name: ChatGPT" &gt; \$includeFile
hang0=\$(grep -n 'è‡ªåŠ¨é€‰æ‹©' \$sourceFile | grep name | awk -F: '{ print \$1 }')
hang=\$((hang0+1))
sed -n "\${hang},\\\$p" \$sourceFile  | awk '/^[[:space:]]*-/ {exit} {print}' &gt;&gt; \$includeFile
#ç­›é€‰èŠ‚ç‚¹
sed -n "\${hang},\\\$p" \$sourceFile  | awk '/name/ {exit} {print}' | grep -i GPT &gt;&gt; \$includeFile
#ç”Ÿæˆæ–°çš„æ–‡ä»¶
awk -v line="\${hang0}" -v includeFile="\$includeFile" 'NR==line{system("cat " includeFile )} {print}' \$sourceFile &gt; ${sourceFile}.tmp
mv ${sourceFile}.tmp \$sourceFile
rm \$includeFile
line=\$(grep -rn rules \$sourceFile | awk  -F: '{ print \$1 }')
GPT=\$(grep -i chatgpt \$sourceFile | grep name | head -1| sed 's/[,":{}]/ /g' | awk  '{ print \$3 }')
if [ \$GPT ]
then
sed -i \${line}a'\ \ - DOMAIN-KEYWORD,openai, ChatGPT           ' \$sourceFile
sed -i \${line}a'\ \ - DOMAIN-KEYWORD,perplexity, ChatGPT       ' \$sourceFile
fi
#

#
if [ ! -f $mylocalconfig ]; then touch $mylocalconfig;fi
diff $CLASHDIR/subconverter/config.yml $mylocalconfig
#å¦‚æœä¸¤ä¸ªæ–‡ä»¶ä¸ä¸€è‡´å°±ç”Ÿæˆå¤‡ä»½æ—§æ–‡ä»¶å¹¶ä¸‹è½½æ›¿æ¢æ–°çš„æ–‡ä»¶
if [ ! "\$?" == 0 ]
then
  cp  $CLASHDIR/subconverter/config.yml $mylocalconfig
fi
#
$CLASHDIR/bin/clash -f $mylocalconfig | tee $CLASHDIR/log/clash.log
#$CLASHDIR/bin/clash -f $mylocalconfig &gt; $CLASHDIR/log/clash.log 2&gt;&amp;1 &amp;
EOF
chmod +x $CLASHDIR/bin/restart-clash.sh
</code></pre></div></div>
<p>å¯ä»¥æµ‹è¯•ç”Ÿæˆçš„æ–‡ä»¶æ˜¯å¦å¯ç”¨</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@CRouter:~/clash/subconverter# /etc/openclash/clash -f config.yml
</code></pre></div></div>
<p>å…³é—­æ–‡ä»¶</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat &gt;  $CLASHDIR/bin/stop-clash.sh &lt;&lt;EOF
#!/bin/bash
PIDFILE=$CLASHDIR/log/clash.pid
if [ -f \$PIDFILE ]
then
kill -9 \$(cat \$PIDFILE )
fi
EOF
chmod +x $CLASHDIR/bin/stop-clash.sh
</code></pre></div></div>

<blockquote>
  <p>å¦‚æœæƒ³å…±äº«å°±æŠŠ<code class="language-plaintext highlighter-rouge">mylocalconfig=/www/clashconfig/mylocalconfig.yaml</code>å°±å¯ä»¥ä»openwrtçš„ç½‘é¡µä¸‹è½½ä¿®æ”¹åçš„é…ç½®äº†<code class="language-plaintext highlighter-rouge">http://192.168.12.1/clashconfig/mylocalconfig.yaml</code></p>

  <p>ä¹Ÿå¯ä»¥å¤åˆ¶åˆ°<code class="language-plaintext highlighter-rouge">/etc/openclash/config/mylocalconfig.yaml</code>ä½œä¸ºopenclashçš„è¾“å…¥</p>

  <p><strong>æˆ‘è§‰å¾—openclashéå¸¸çš„å¡,ä»…ä½œä¸ºä¸´æ—¶ä»£ç†ä½¿ç”¨,æˆ‘å¸¸ç”¨çš„è¿˜æ˜¯/root/clash/bin/restart-clash.sh</strong></p>

  <p>openclashæ›¾ç»ä½¿ç”¨çš„é…ç½®</p>
  <ul>
    <li>æ­¤æ¬¡ä½¿ç”¨OpebnClashæ’ä»¶,ç™½åå•æ¨¡å¼,å¦å¤–é…ç½®æ–‡ä»¶ä¸­åˆ¶å®šçš„ç«¯å£(subconverterçš„é…ç½®<code class="language-plaintext highlighter-rouge">base/all_base.tpl</code>åˆ¶å®š),æ˜¯å¯ä»¥èµ°zerotierè®¿é—®çš„,æ‰€ä»¥å¯ä»¥è¿œç¨‹è®¿é—®</li>
    <li><code class="language-plaintext highlighter-rouge">Luci&gt;OpenClash&gt;æ’ä»¶è®¾ç½®&gt;å®šæ—¶é‡å¯</code>,é‡å¯æ—¶é—´å¤§äº<code class="language-plaintext highlighter-rouge">build-clash-config.sh</code>æ—¶é—´,å°±å¯ä»¥å®ç°å®šæœŸæ›´æ–°é…ç½®</li>
  </ul>
</blockquote>

<p>ç”Ÿæˆç³»ç»Ÿæ§åˆ¶è„šæœ¬</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat &gt; $CLASHDIR/bin/myclash &lt;&lt; EOF
#!/bin/sh /etc/rc.common

START=99
STOP=10

start() {
    echo "Starting My Clash Service"
    $CLASHDIR/bin/restart-clash.sh
    # æ·»åŠ å¯åŠ¨æœåŠ¡çš„å‘½ä»¤
}

stop() {
    echo "Stopping My Clash Service"
    # æ·»åŠ åœæ­¢æœåŠ¡çš„å‘½ä»¤
    $CLASHDIR/bin/stop-clash.sh
}

restart() {
    echo "Restarting My Clash Service"
    stop
    start
}

# æ·»åŠ å…¶ä»–éœ€è¦çš„å‡½æ•°

# æ·»åŠ å…¶ä»–éœ€è¦çš„é€»è¾‘

# Exit on unsupported action
run "$@"
EOF
#
chmod +x $CLASHDIR/bin/myclash
cp $CLASHDIR/bin/myclash /etc/init.d/
</code></pre></div></div>

<p>æ·»åŠ å®šæœŸå¯åŠ¨</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#0 1 * * * /root/clash/bin/restart-clash.sh
0 1 * * * /etc/init.d/myclash restart
</code></pre></div></div>

<p>é…ç½®dashboard</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget 'https://codeload.github.com/cndaqiang/clash-dashboard/zip/refs/heads/gh-pages'
unzip -x gh-pages
mv clash-dashboard-gh-pages /www/clash-dashboard
</code></pre></div></div>

<h2 id="è‡ªå·±åˆ›å»ºç­–ç•¥å¹¶é…ç½®åˆ†æµ">è‡ªå·±åˆ›å»ºç­–ç•¥å¹¶é…ç½®åˆ†æµ</h2>
<h3 id="ä¸ºäº†é¿å…gptè¢«å°å·è¿™é‡Œæ·»åŠ è‡ªå·±çš„èŠ‚ç‚¹è¿›è¡Œgptè®¿é—®">ä¸ºäº†é¿å…GPTè¢«å°å·ï¼Œè¿™é‡Œæ·»åŠ è‡ªå·±çš„èŠ‚ç‚¹è¿›è¡ŒGPTè®¿é—®.</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sourceFile=/home/cndaqiang/soft/clash/subconverter/config.yml
#æ·»åŠ èŠ‚ç‚¹
line=$(grep -n 'proxies' $sourceFile | head -1 | awk -F: '{ print $1 }')
sed -i ${line}a'\ \ - {name: "cndaqiang.ChatGPT", server: 192.168.192.10, port: 2090, type: socks5}' $sourceFile
</code></pre></div></div>
<h3 id="åˆ›å»ºä¸€ä¸ªåŒ…å«æ‰€æœ‰èŠ‚ç‚¹çš„ç¾¤ç»„">åˆ›å»ºä¸€ä¸ªåŒ…å«æ‰€æœ‰èŠ‚ç‚¹çš„ç¾¤ç»„</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sourceFile=/home/cndaqiang/soft/clash/subconverter/config.yml
includeFile=${sourceFile}.chat.cndaqiang.in
echo "  - name: æ‰€æœ‰èŠ‚ç‚¹
    type: select
    proxies:
grep '{name:' $sourceFile | awk -F'name: ' '{print $2}' | awk -F', ' '{gsub(/"/, "", $1);  print "      - " $1}' &gt;&gt; $includeFile
</code></pre></div></div>

<p>ä¸æƒ³è½¬è¯‘äº†,è‡ªå·±æ·»åŠ åˆ°<code class="language-plaintext highlighter-rouge">restart-clash.sh</code></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#è‡ªåŠ¨ç­›é€‰èŠ‚ç‚¹
sourceFile=/home/cndaqiang/soft/clash/subconverter/config.yml
includeFile=${sourceFile}.chat.cndaqiang.in
#...............................................ç­›é€‰ç¾å›½èŠ‚ç‚¹å¹¶è®¾ç½®è‡ªåŠ¨é€‰æ‹©
#è¿™æ˜¯æŠ„çš„â€œâ™»ï¸è‡ªåŠ¨é€‰æ‹©â€çš„ç­–ç•¥ï¼Œå³è‡ªåŠ¨æµ‹è¯•èŠ‚ç‚¹çš„æ–¹æ³•
echo "  - name: QS_US" &gt; $includeFile
hang0=$(grep -n 'è‡ªåŠ¨é€‰æ‹©' $sourceFile | grep name | awk -F: '{ print $1 }')
hang=$((hang0+1))
sed -n "${hang},\$p" $sourceFile  | awk '/^[[:space:]]*-/ {exit} {print}' &gt;&gt;    $includeFile
#ç­›é€‰èŠ‚ç‚¹
sed -n "${hang},\$p" $sourceFile  | awk '/name/ {exit} {print}' | grep -i ç¾å›½   &gt;&gt; $includeFile
sed -n "${hang},\$p" $sourceFile  | awk '/name/ {exit} {print}' | grep -i US   &gt;&gt; $includeFile
#...............................................ç­›é€‰GPTèŠ‚ç‚¹.
#æ·»åŠ è‡ªå·±çš„èŠ‚ç‚¹
echo "  - name: ChatGPT
    type: select
    proxies:
      - cndaqiang.ChatGPT" &gt;&gt; $includeFile
#äº¦å¯ä»"èŠ‚ç‚¹é€‰æ‹©"ä¸­ç­›é€‰å…¶ä»–çš„èŠ‚ç‚¹
hang0=$(grep -n 'èŠ‚ç‚¹é€‰æ‹©' $sourceFile | grep name | awk -F: '{ print $1 }')
hang=$((hang0+1))
sed -n "${hang},\$p" $sourceFile  | awk '/name/ {exit} {print}' | grep -i GPT   &gt;&gt; $includeFile
#..........................................................
#ç”Ÿæˆæ–°çš„æ–‡ä»¶
awk -v line="${hang0}" -v includeFile="$includeFile" 'NR==line{system("cat "    includeFile )} {print}' $sourceFile &gt; .tmp
mv .tmp $sourceFile
rm $includeFile
line=$(grep -rn rules $sourceFile | awk  -F: '{ print $1 }')
#.
GPT=$(grep -i chatgpt $sourceFile | grep name | head -1| sed 's/[,":{}]/ /g' | awk  '{ print $3 }')
if [ $GPT ]
then
sed -i ${line}a'\ \ - DOMAIN-SUFFIX,oaistatic.com, ChatGPT           ' $sourceFile
sed -i ${line}a'\ \ - DOMAIN-SUFFIX,openai.com, ChatGPT           ' $sourceFile
sed -i ${line}a'\ \ - DOMAIN-SUFFIX,chatgpt.com, ChatGPT           ' $sourceFile
sed -i ${line}a'\ \ - DOMAIN-SUFFIX,gravatar.com, ChatGPT          ' $sourceFile
sed -i ${line}a'\ \ - DOMAIN-SUFFIX,oaistatic.com, ChatGPT           ' $sourceFile
sed -i ${line}a'\ \ - DOMAIN-SUFFIX,scholar.google.com, ChatGPT           ' $sourceFile
fi

# å…¶ä»–ç½‘ç«™
https://raw.githubusercontent.com/gfwlist/gfwlist/master/gfwlist.txt
#ç¾å›½èŠ‚ç‚¹
sed -i ${line}a'\ \ - DOMAIN-SUFFIX,ai, QS_US       ' $sourceFile
sed -i ${line}a'\ \ - DOMAIN-SUFFIX,phind.com, QS_US       ' $sourceFile
sed -i ${line}a'\ \ - DOMAIN-SUFFIX,gemini.google.com, QS_US        ' $sourceFile
# å…¶ä»–ç½‘å€
sed -i ${line}a'\ \ - DOMAIN-SUFFIX,github.com,â™»ï¸ è‡ªåŠ¨é€‰æ‹©      '  $sourceFile
sed -i ${line}a'\ \ - DOMAIN-SUFFIX,githubusercontent.com,â™»ï¸ è‡ªåŠ¨é€‰æ‹©      '   $sourceFile
</code></pre></div></div>

<h2 id="macä½¿ç”¨clash">macä½¿ç”¨clash</h2>
<p>é…ç½®æ–‡ä»¶<code class="language-plaintext highlighter-rouge">config.yaml</code>ä¸­è®¾ç½®ç«¯å£, å¯ä»¥è¦†ç›–èŠ‚ç‚¹è®¢é˜…çš„é…ç½®</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mixed-port: 7890
</code></pre></div></div>

<hr />
<blockquote>
  <p>æœ¬æ–‡é¦–å‘äº<a href="https://cndaqiang.github.io/">æˆ‘çš„åšå®¢@cndaqiang</a>.<br />
æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh">CC BY-SA 4.0 åè®®</a> ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p>
</blockquote>

        </article>
        <hr>

        
        
            
            
                
                    
                
            
        
            
            
                
                    
                
            
                
                    
                
            
                
                    
                
            
                
                    
                
            
        
            
            
                
                    
                
            
                
                    
                
            
                
                    
                
            
                
                    
                
            
        
            
            
                
                    
                
            
        
            
            
                
                    
                
            
        
            
            
                
                    
                
            
        
            
            
                
                    
                
            
        
            
            
                
                    
                
            
                
                    
                
            
        
            
            
                
                    
                
            
                
                    
                
            
        
            
            
                
                    
                
            
        
        
        <!--- github follow and star -->
        <iframe src="/html_script/github-btn.html?user=cndaqiang&repo=cndaqiang.github.io&type=star&count=true&size=large" frameborder="0" scrolling="0" width="160px" height="30px"></iframe>
        <iframe src="/html_script/github-btn.html?user=cndaqiang&type=follow&count=true&size=large" frameborder="0" scrolling="0" width="220px" height="30px"></iframe>
        <div class="post-recent">
    <div class="pre">
        
        <p><strong>ä¸Šä¸€ç¯‡</strong> <a href="/2020/07/01/js/">JavaScriptå­¦ä¹ </a></p>
        
    </div>
    <div class="nex">

        
        <p><strong>ä¸‹ä¸€ç¯‡</strong> <a href="/2020/09/02/gpaw/">GPAWå®‰è£…</a></p>
        
    </div>
</div>

        
            





            <!--å¹¿å‘Š _includes/adsenseAfterComments.html -->
            

        
        

        


    </div>
    <button class="anchor"><i class="fa fa-anchor"></i></button>
    <div class="right">
        <div class="wrap">

            <!-- Content -->
            <div class="side content">
                <div>
                    ç›®å½•
                </div>
                <ul id="content-side" class="content-ul">
                    
                     <!-- å…³é—­è¯„è®ºåŠŸèƒ½ <li><a href="#comments">è¯„è®º</a></li> -->
                </ul>
            </div>
            <!-- å…¶ä»–divæ¡†æ”¾åˆ°è¿™é‡Œ ï¼Œæ·»åŠ br ä½¿ä¸ç²˜è¿--><br>
            <!-- adsens -->
            <!--å¹¿å‘Š _includes/adsense_side.html -->
            

            
            
                 
                <div class="side">
                   <div>
                       <i class="fa fa-database"></i>
                      è®¿å®¢æ•°æ®
                   </div>
                   <script type="text/javascript" src="//rf.revolvermaps.com/0/0/7.js?i=537vyn60ia7&amp;m=0&amp;c=007eff&amp;cr1=ff0000&amp;sx=0" async="async"></script>
                </div>
                
            
            <!-- <div class="side">bbbb</div> -->
        </div>
    </div>
</div>
<script>
/**
 * target _blank
 */
(function() {
    var aTags = document.querySelectorAll('article a:not([id])')
    for (var i = 0; i < aTags.length; i++) {
        aTags[i].setAttribute('target', '_blank')
    }
}());
</script>
<script src="/js/pageContent.js " charset="utf-8"></script>


    <footer class="site-footer">


    <div class="wrapper">
        


        <!-- 
        <p class="contact">
            
            è”ç³»æ–¹å¼: 
             <a href="https://github.com/cndaqiang" title="GitHub"><i class="fa fa-github" aria-hidden="true"></i></a>   
              
              
              
              
              
              
              
              
            .
        
        -->
         
        </p>
        <p>
            
            æœ¬ç«™æ€»è®¿é—®é‡<span id="busuanzi_value_site_pv"></span>æ¬¡ï¼Œè®¿å®¢<span id="busuanzi_value_site_uv"></span>äººæ¬¡ï¼Œæœ¬æ–‡é˜…è¯»é‡<span id="busuanzi_value_page_pv"></span>æ¬¡.
            
        <!-- 
             <a href="https://us.umami.is/websites/27e72116-bcc0-4a4d-82a5-485b4105820e"> å®æ—¶è®¿å®¢æ•°æ®</a>  
        -->
        </p>
        <!-- 
        <p class="power">
            <span>
                Site powered by <a href="https://cndaqiang.github.io/">cndaqiang</a>
            </span>
            <span>
                Theme designed by <a href="https://github.com/Gaohaoyang">HyG</a>.
            </span>
        </p>
        -->
        <p class="description">
            <!-- 
                 
            -->
            &copy; 2024 cndaqiang. Archived since 11/01/2014.
            </p>
    
    </div>
</footer>

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
 
    <div class="back-to-top">
    <a href="#top" data-scroll>
        <i class="fa fa-arrow-up" aria-hidden="true"></i>
    </a>
</div>

    <script src=" /js/main.js " charset="utf-8"></script>
    <script src=" /js/smooth-scroll.min.js " charset="utf-8"></script>
    <script type="text/javascript">
      smoothScroll.init({
        speed: 500, // Integer. How fast to complete the scroll in milliseconds
        easing: 'easeInOutCubic', // Easing pattern to use
        offset: 20, // Integer. How far to offset the scrolling anchor location in pixels
      });
    </script>
    <!-- <script src=" /js/scroll.min.js " charset="utf-8"></script> -->
  </body>

</html>
