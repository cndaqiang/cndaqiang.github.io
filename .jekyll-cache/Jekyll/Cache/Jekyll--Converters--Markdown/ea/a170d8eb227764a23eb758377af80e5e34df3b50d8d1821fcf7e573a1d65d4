I"·<ul id="markdown-toc">
  <li><a href="#åˆ›å»ºç”¨æˆ·" id="markdown-toc-åˆ›å»ºç”¨æˆ·">åˆ›å»ºç”¨æˆ·</a></li>
  <li><a href="#æŒ‚è½½å®‰è£…å…‰ç›˜ä½œä¸ºæœ¬åœ°yumä»“åº“" id="markdown-toc-æŒ‚è½½å®‰è£…å…‰ç›˜ä½œä¸ºæœ¬åœ°yumä»“åº“">æŒ‚è½½å®‰è£…å…‰ç›˜ä½œä¸ºæœ¬åœ°yumä»“åº“</a>    <ul>
      <li><a href="#æŒ‚è½½å®‰è£…å…‰ç›˜" id="markdown-toc-æŒ‚è½½å®‰è£…å…‰ç›˜">æŒ‚è½½å®‰è£…å…‰ç›˜</a></li>
      <li><a href="#é…ç½®å…‰ç›˜ä¸ºyumæº" id="markdown-toc-é…ç½®å…‰ç›˜ä¸ºyumæº">é…ç½®å…‰ç›˜ä¸ºyumæº</a></li>
    </ul>
  </li>
  <li><a href="#ç½‘ç»œé…ç½®" id="markdown-toc-ç½‘ç»œé…ç½®">ç½‘ç»œé…ç½®</a>    <ul>
      <li><a href="#æ”¹ä¸»æœºå" id="markdown-toc-æ”¹ä¸»æœºå">æ”¹ä¸»æœºå</a></li>
      <li><a href="#ç½‘ç»œ" id="markdown-toc-ç½‘ç»œ">ç½‘ç»œ</a>        <ul>
          <li><a href="#ç½‘å¡é…ç½®æ–‡ä»¶è§„åˆ™" id="markdown-toc-ç½‘å¡é…ç½®æ–‡ä»¶è§„åˆ™">ç½‘å¡é…ç½®æ–‡ä»¶è§„åˆ™</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#nis-è´¦æˆ·ç®¡ç†æœåŠ¡å™¨" id="markdown-toc-nis-è´¦æˆ·ç®¡ç†æœåŠ¡å™¨">NIS è´¦æˆ·ç®¡ç†æœåŠ¡å™¨</a>    <ul>
      <li><a href="#å…³é—­selinuxå’Œé˜²ç«å¢™" id="markdown-toc-å…³é—­selinuxå’Œé˜²ç«å¢™">å…³é—­Selinuxå’Œé˜²ç«å¢™</a></li>
      <li><a href="#æœåŠ¡å™¨" id="markdown-toc-æœåŠ¡å™¨">æœåŠ¡å™¨</a></li>
      <li><a href="#å®¢æˆ·ç«¯" id="markdown-toc-å®¢æˆ·ç«¯">å®¢æˆ·ç«¯</a></li>
      <li><a href="#clientæµ‹è¯•" id="markdown-toc-clientæµ‹è¯•">clientæµ‹è¯•</a></li>
      <li><a href="#å¼€å¯é˜²ç«å¢™çš„è®¾ç½®" id="markdown-toc-å¼€å¯é˜²ç«å¢™çš„è®¾ç½®">å¼€å¯é˜²ç«å¢™çš„è®¾ç½®</a></li>
    </ul>
  </li>
  <li><a href="#nfsæ–‡ä»¶ç³»ç»Ÿå…±äº«æœåŠ¡å™¨" id="markdown-toc-nfsæ–‡ä»¶ç³»ç»Ÿå…±äº«æœåŠ¡å™¨">NFSæ–‡ä»¶ç³»ç»Ÿå…±äº«æœåŠ¡å™¨</a>    <ul>
      <li><a href="#æœåŠ¡å™¨ç«¯" id="markdown-toc-æœåŠ¡å™¨ç«¯">æœåŠ¡å™¨ç«¯</a></li>
      <li><a href="#å®¢æˆ·ç«¯-1" id="markdown-toc-å®¢æˆ·ç«¯-1">å®¢æˆ·ç«¯</a></li>
    </ul>
  </li>
  <li><a href="#é˜²ç«å¢™iptables" id="markdown-toc-é˜²ç«å¢™iptables">é˜²ç«å¢™iptables</a>    <ul>
      <li><a href="#æŸ¥çœ‹iptablesç°æœ‰è§„åˆ™iptables--nvl" id="markdown-toc-æŸ¥çœ‹iptablesç°æœ‰è§„åˆ™iptables--nvl">æŸ¥çœ‹iptablesç°æœ‰è§„åˆ™<code class="highlighter-rouge">iptables -nvL</code></a></li>
      <li><a href="#åˆ é™¤è§„åˆ™iptables--d-" id="markdown-toc-åˆ é™¤è§„åˆ™iptables--d-">åˆ é™¤è§„åˆ™<code class="highlighter-rouge">iptables -D </code></a></li>
      <li><a href="#å¢åŠ è§„åˆ™" id="markdown-toc-å¢åŠ è§„åˆ™">å¢åŠ è§„åˆ™</a></li>
      <li><a href="#ä¿å­˜ç”Ÿæ•ˆ" id="markdown-toc-ä¿å­˜ç”Ÿæ•ˆ">ä¿å­˜ç”Ÿæ•ˆ</a></li>
    </ul>
  </li>
  <li><a href="#pbsä½œä¸šç®¡ç†ç³»ç»Ÿ" id="markdown-toc-pbsä½œä¸šç®¡ç†ç³»ç»Ÿ">pbsä½œä¸šç®¡ç†ç³»ç»Ÿ</a>    <ul>
      <li><a href="#ç®¡ç†èŠ‚ç‚¹mom01" id="markdown-toc-ç®¡ç†èŠ‚ç‚¹mom01">ç®¡ç†èŠ‚ç‚¹mom01</a></li>
      <li><a href="#è®¡ç®—èŠ‚ç‚¹mom01boy01" id="markdown-toc-è®¡ç®—èŠ‚ç‚¹mom01boy01">è®¡ç®—èŠ‚ç‚¹mom01,boy01</a>        <ul>
          <li><a href="#è®¡ç®—èŠ‚ç‚¹mom01å•æœºpbs" id="markdown-toc-è®¡ç®—èŠ‚ç‚¹mom01å•æœºpbs">è®¡ç®—èŠ‚ç‚¹mom01(å•æœºpbs)</a></li>
          <li><a href="#è®¡ç®—èŠ‚ç‚¹boy01é›†ç¾¤" id="markdown-toc-è®¡ç®—èŠ‚ç‚¹boy01é›†ç¾¤">è®¡ç®—èŠ‚ç‚¹boy01(é›†ç¾¤)</a></li>
          <li><a href="#å¢åŠ è®¡ç®—èŠ‚ç‚¹ä¿®æ”¹ç®¡ç†èŠ‚ç‚¹å’Œè®¡ç®—èŠ‚ç‚¹é…ç½®æ–‡ä»¶é‡å¯å³å¯" id="markdown-toc-å¢åŠ è®¡ç®—èŠ‚ç‚¹ä¿®æ”¹ç®¡ç†èŠ‚ç‚¹å’Œè®¡ç®—èŠ‚ç‚¹é…ç½®æ–‡ä»¶é‡å¯å³å¯">å¢åŠ è®¡ç®—èŠ‚ç‚¹ï¼Œä¿®æ”¹ç®¡ç†èŠ‚ç‚¹å’Œè®¡ç®—èŠ‚ç‚¹é…ç½®æ–‡ä»¶é‡å¯å³å¯</a></li>
        </ul>
      </li>
      <li><a href="#äº¤ä½œä¸š" id="markdown-toc-äº¤ä½œä¸š">äº¤ä½œä¸š</a></li>
      <li><a href="#pbså‡ºé”™æ—¶-é‡å¯pbsæœåŠ¡æŸ¥çœ‹pbs_xxx-statusæ‰¾é”™è¯¯åŸå› " id="markdown-toc-pbså‡ºé”™æ—¶-é‡å¯pbsæœåŠ¡æŸ¥çœ‹pbs_xxx-statusæ‰¾é”™è¯¯åŸå› ">pbså‡ºé”™æ—¶ é‡å¯pbsæœåŠ¡ï¼ŒæŸ¥çœ‹pbs_xxx statusï¼Œæ‰¾é”™è¯¯åŸå› </a>        <ul>
          <li><a href="#é…ç½®æ–‡ä»¶å†™é”™" id="markdown-toc-é…ç½®æ–‡ä»¶å†™é”™">é…ç½®æ–‡ä»¶å†™é”™</a></li>
          <li><a href="#ç«¯å£å ç”¨å¯¼è‡´" id="markdown-toc-ç«¯å£å ç”¨å¯¼è‡´">ç«¯å£å ç”¨å¯¼è‡´</a></li>
          <li><a href="#æ·»åŠ è®¡ç®—èŠ‚ç‚¹" id="markdown-toc-æ·»åŠ è®¡ç®—èŠ‚ç‚¹">æ·»åŠ è®¡ç®—èŠ‚ç‚¹</a>            <ul>
              <li><a href="#å°†ç®¡ç†èŠ‚ç‚¹æ·»åŠ åˆ°è®¡ç®—èŠ‚ç‚¹" id="markdown-toc-å°†ç®¡ç†èŠ‚ç‚¹æ·»åŠ åˆ°è®¡ç®—èŠ‚ç‚¹">å°†ç®¡ç†èŠ‚ç‚¹æ·»åŠ åˆ°è®¡ç®—èŠ‚ç‚¹</a></li>
            </ul>
          </li>
          <li><a href="#å…±äº«æ–‡ä»¶ä¸é…ç½®ä½¿å¾—momlockå†²çª" id="markdown-toc-å…±äº«æ–‡ä»¶ä¸é…ç½®ä½¿å¾—momlockå†²çª">å…±äº«æ–‡ä»¶ä¸é…ç½®ä½¿å¾—mom.lockå†²çª</a></li>
        </ul>
      </li>
      <li><a href="#pbså‘½ä»¤" id="markdown-toc-pbså‘½ä»¤">pbså‘½ä»¤</a></li>
    </ul>
  </li>
  <li><a href="#å¤‡ä»½" id="markdown-toc-å¤‡ä»½">å¤‡ä»½</a>    <ul>
      <li><a href="#å¤‡ä»½ç£ç›˜" id="markdown-toc-å¤‡ä»½ç£ç›˜">å¤‡ä»½ç£ç›˜</a></li>
      <li><a href="#å…‹éš†ç£ç›˜" id="markdown-toc-å…‹éš†ç£ç›˜">å…‹éš†ç£ç›˜</a></li>
    </ul>
  </li>
</ul>

<p>åŸºäºpbsä½œä¸šç³»ç»Ÿçš„é›†ç¾¤ï¼Œæ”¯æŒNISï¼ŒNFSæœåŠ¡ï¼Œslurmçš„åæœŸæœ‰æ—¶é—´è¡¥ä¸Šã€‚
æœ¬æ–‡æœ€åˆå‘åœ¨<a href="https://github.com/cndaqiang/E5-PC-daily/issues/6">Centos 7 é›†ç¾¤æ­å»º</a></p>

<h2 id="åˆ›å»ºç”¨æˆ·">åˆ›å»ºç”¨æˆ·</h2>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>useradd -d ç”¨æˆ·å®¶ç›®å½• -M ç”¨æˆ·å
passwd ç”¨æˆ·å
# æ·»åŠ åˆ°sudoç»„
usermod -aG wheel ç”¨æˆ·å
</code></pre></div></div>
<h2 id="æŒ‚è½½å®‰è£…å…‰ç›˜ä½œä¸ºæœ¬åœ°yumä»“åº“">æŒ‚è½½å®‰è£…å…‰ç›˜ä½œä¸ºæœ¬åœ°yumä»“åº“</h2>
<p>æ²¡æœ‰å¤–ç½‘éœ€è¦å®‰è£…ç¨‹åºæ—¶ï¼Œå¯é€šè¿‡æŒ‚è½½å…‰é©±/isoæ–‡ä»¶ä½œä¸ºæœ¬åœ°ä»“åº“</p>
<h3 id="æŒ‚è½½å®‰è£…å…‰ç›˜">æŒ‚è½½å®‰è£…å…‰ç›˜</h3>
<p>æŒ‚è½½isoæ–‡ä»¶</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir /media/CentOS-7-x86_64-Everything-1908
mount -o loop /opt/source/CentOS-7-x86_64-Everything-1908.iso /media/CentOS-7-x86_64-Everything-1908
</code></pre></div></div>
<p>or æŒ‚è½½å…‰é©±</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir  /media/diskOS
mount /dev/cdrom /media/diskOS #æŒ‚è½½å…‰ç›˜
</code></pre></div></div>

<h3 id="é…ç½®å…‰ç›˜ä¸ºyumæº">é…ç½®å…‰ç›˜ä¸ºyumæº</h3>

<ol>
  <li>æŒ‚è½½iso/å…‰é©±</li>
  <li>é…ç½®yum
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd /etc/yum.repos.d/
#å–æ¶ˆç½‘ç»œyum
mv CentOS-Base.repo CentOS-Base.repo.bak
#é…ç½®å…‰ç›˜é•œåƒ 
vi CentOS-Media.repo 
</code></pre></div>    </div>
    <p>ä¿®æ”¹</p>
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[c7-media]
name=CentOS-$releasever - Media
#æŠŠæŒ‚è½½ç›®å½•æ·»åŠ åˆ°baseurl
[c7-media]
name=CentOS-$releasever - Media
baseurl=file:///media/CentOS-7-x86_64-Everything-1908  #æ­¤å¤„æ·»åŠ æ–°çš„æŒ‚è½½åœ°å€
     file:///media/cdrom/
     file:///media/cdrecorder/
gpgcheck=1
enabled=1 #æ­¤å¤„è®¾ç½®1æ‰“å¼€
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7
</code></pre></div>    </div>
  </li>
  <li>å®‰è£…æµ‹è¯•
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@node8 source]# yum install python
å·²åŠ è½½æ’ä»¶ï¼šfastestmirror, langpacks
Loading mirror speeds from cached hostfile
 * c7-media:
c7-media                                                 | 3.6 kB     00:00  #&lt;æ­¤å¤„çœ‹å‡ºå·²ç»æ›¿æ¢ä¸ºäº†å…‰ç›˜çš„æº
æ­£åœ¨è§£å†³ä¾èµ–å…³ç³»
--&gt; æ­£åœ¨æ£€æŸ¥äº‹åŠ¡
---&gt; è½¯ä»¶åŒ… python.x86_64.0.2.7.5-68.el7 å°†è¢« å‡çº§
</code></pre></div>    </div>
  </li>
</ol>

<h2 id="ç½‘ç»œé…ç½®">ç½‘ç»œé…ç½®</h2>
<h3 id="æ”¹ä¸»æœºå">æ”¹ä¸»æœºå</h3>
<p><a href="https://blog.csdn.net/tantexian/article/details/45958275">å¦‚ä½•åœ¨CentOS 7ä¸Šä¿®æ”¹ä¸»æœºåhostname</a></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#æ°¸ä¹…
hostnamectl --static set-hostname newname
</code></pre></div></div>
<p>ä¿®æ”¹æ›´æ–°<code class="highlighter-rouge">/etc/hosts</code></p>

<h3 id="ç½‘ç»œ">ç½‘ç»œ</h3>
<p>å¼€æœºå¯ç”¨ç½‘å¡</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vi /etc/sysconfig/network-scripts/ifcfg-eth0
#è®¾ç½®ONBOOT=yesåˆ™å¼€æœºå¯åŠ¨
#åŒæ—¶ä¹Ÿæ˜¯ç½‘å¡é…ç½®æ–‡ä»¶
</code></pre></div></div>
<p>ä¸´æ—¶å¼€å¯</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ifup eth0
</code></pre></div></div>
<p>å…³é—­</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ifdown eth0
</code></pre></div></div>
<h4 id="ç½‘å¡é…ç½®æ–‡ä»¶è§„åˆ™">ç½‘å¡é…ç½®æ–‡ä»¶è§„åˆ™</h4>
<p>vi /etc/sysconfig/network-scripts/ifcfg-ens34  #ä¸åŒçš„ç½‘å¡ ifcfg-è·Ÿçš„åç¼€ä¸åŒ</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>TYPE=Ethernet
PROXY_METHOD=none
BROWSER_ONLY=no
BOOTPROTO=dhcp
DEFROUTE=yes
IPV4_FAILURE_FATAL=no
IPV6INIT=yes
IPV6_AUTOCONF=yes
IPV6_DEFROUTE=yes
IPV6_FAILURE_FATAL=no
IPV6_ADDR_GEN_MODE=stable-privacy
NAME=ens34
UUID=bf1e0d23-8b7a-40e0-83e7-1dcbb072206c
DEVICE=ens34
ONBOOT=yes
</code></pre></div></div>

<h2 id="nis-è´¦æˆ·ç®¡ç†æœåŠ¡å™¨">NIS è´¦æˆ·ç®¡ç†æœåŠ¡å™¨</h2>
<p><a href="http://cn.linux.vbird.org/linux_server/0430nis.php#whatisnis">ç¬¬åå››ç« ã€è´¦å·æ§ç®¡ï¼š NIS æœåŠ¡å™¨</a>
<a href="http://www.178pt.com/32.html">Centos7- NISç¯å¢ƒæ­å»º</a>
<a href="https://www.fee.im/2019/03/install-nis-on-centos7/">åœ¨Centos7ä¸Šå®‰è£…NIS</a>
 Network Information Services (NIS server) æœ€æ—©åº”è¯¥æ˜¯ç§°ä¸º Sun Yellow Pages (ç®€ç§° yp)
ä¸€å°æœåŠ¡å™¨(ç®¡ç†èŠ‚ç‚¹)ä¿å­˜ç”¨æˆ·è´¦æˆ·å¯†ç ï¼Œæ‰€æœ‰æœåŠ¡å™¨ç”¨æˆ·éƒ½ä¿å­˜åœ¨NISæœåŠ¡å™¨ä¸Š</p>
<ul>
  <li>yp-tools ï¼šæä¾› NIS ç›¸å…³çš„æŸ¥å¯»æŒ‡ä»¤åŠŸèƒ½</li>
  <li>ypbind   ï¼šæä¾› NIS Client ç«¯çš„è®¾å®šè½¯ä»¶</li>
  <li>ypserv   ï¼šæä¾› NIS Server ç«¯çš„è®¾å®šè½¯ä»¶</li>
  <li>rpcbind  ï¼šå°±æ˜¯ RPC ä¸€å®šéœ€è¦çš„æ•°æ®å•Šï¼</li>
</ul>

<h3 id="å…³é—­selinuxå’Œé˜²ç«å¢™">å…³é—­Selinuxå’Œé˜²ç«å¢™</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim /etc/selinux/config
</code></pre></div></div>
<p>è®¾ç½®</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELINUX=disabled
</code></pre></div></div>
<p>å…³é—­é˜²ç«å¢™</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl stop firewalld
systemctl disable firewalld
reboot
</code></pre></div></div>

<h3 id="æœåŠ¡å™¨">æœåŠ¡å™¨</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yum -y install ypserv ypbind yp-tools
</code></pre></div></div>
<p>è®¾ç½®åŸŸ</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>echo "NISDOMAIN=CC19" &gt;&gt; /etc/sysconfig/network
</code></pre></div></div>
<p>å¯åŠ¨æœåŠ¡</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl start ypserv
systemctl start rpcbind
systemctl start yppasswdd
#å¼€æœºå¯åŠ¨
systemctl enable ypserv
systemctl enable rpcbind
systemctl enable yppasswdd
</code></pre></div></div>
<p>åˆ›å»ºç”¨æˆ·</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@mom01 ~]# sudo adduser --home /home/c1 c1
[root@mom01 ~]# passwd c1
Changing password for user c1.
New password: 
Retype new password: 
passwd: all authentication tokens updated successfully.
</code></pre></div></div>
<p>æ›´æ–°ç”¨æˆ·ä¿¡æ¯æ•°æ®åº“</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/usr/lib64/yp/ypinit -m
# æ–°å¢è´¦æˆ·æ—¶ï¼Œéœ€è¦æ›´æ–°æ•°æ®åº“  
make -C /var/yp
</code></pre></div></div>
<h3 id="å®¢æˆ·ç«¯">å®¢æˆ·ç«¯</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yum -y install ypbind yp-tools
</code></pre></div></div>
<p>è®¾ç½®åŸŸ</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>echo "NISDOMAIN=CC19" &gt;&gt; /etc/sysconfig/network
</code></pre></div></div>
<p>è®¾ç½®ç”¨æˆ·è®¤è¯ä¿¡æ¯è¯»å–é¡ºåº</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim /etc/nsswitch.conf
</code></pre></div></div>
<p>åœ¨å­˜åœ¨çš„è®¤è¯æ–¹å¼å‰æ·»åŠ nis</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>passwd:     files sss nis
shadow:     files sss nis
group:      files sss nis 
#initgroups: files sss

#hosts:     db files nisplus nis dns
hosts:      files nis dns myhostname

</code></pre></div></div>
<p>è®¾ç½®nså®¢æˆ·ç«¯</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim /etc/yp.conf
</code></pre></div></div>
<p>æ·»åŠ <code class="highlighter-rouge">domain CC19   broadcast</code>ï¼ŒæŒ‡å®šæœåŠ¡å™¨åœ°å€ä¹Ÿè¡Œ</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim /etc/sysconfig/authconfig
</code></pre></div></div>
<p>ä¿®æ”¹<code class="highlighter-rouge">USENIS=yes</code></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim /etc/pam.d/system-auth
</code></pre></div></div>
<p>æ·»åŠ nis<code class="highlighter-rouge">password    sufficient    pam_unix.so sha512 shadow nis  nullok try_first_pass use_authtok</code>
å¯åŠ¨</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl start rpcbind
systemctl start ypbind

systemctl enable rpcbind
systemctl enable ypbind
</code></pre></div></div>
<h3 id="clientæµ‹è¯•">clientæµ‹è¯•</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@boy01 ~]# yptest
Test 1: domainname
Configured domainname is "CC19"

Test 2: ypbind
Used NIS server: mom01

Test 3: yp_match
WARNING: No such key in map (Map passwd.byname, key nobody)

Test 4: yp_first
c1 c1:$6$v6nN75rW$20nFRAqDHqGVOyXFxaRUtG5ZeiySw7.hZkg0HfvD2kb/g/5daMfRCMAxuEG0nelTjZ//VaSKx0E8CRClhxzcP.:1001:1001::/home/c1:/bin/bash

Test 5: yp_next
cndaqang cndaqang:$6$aBRr9Jo4YWMFHhFQ$Wk.5DGrfsxipEVQPM2NaKJw.3sLdGlGUKGGxZzGFeYfiFqtHEI.B68akDTeNZN77SMkGPYZmQ1Z2iyUfYRYd4/:1000:1000:cndaqang:/home/cndaqang:/bin/bash

Test 6: yp_master
mom01

Test 7: yp_order
1568563871

Test 8: yp_maplist
netid.byname
mail.aliases
protocols.byname
protocols.bynumber
services.byservicename
services.byname
rpc.bynumber
rpc.byname
hosts.byaddr
hosts.byname
group.bygid
group.byname
passwd.byuid
passwd.byname
ypservers

Test 9: yp_all
c1 c1:$6$v6nN75rW$20nFRAqDHqGVOyXFxaRUtG5ZeiySw7.hZkg0HfvD2kb/g/5daMfRCMAxuEG0nelTjZ//VaSKx0E8CRClhxzaP.:1001:1001::/home/c1:/bin/bash
cndaqang cndaqang:$6$aBRr9Jo4YWMFHhFQ$Wk.5DGrfsxipEVQPM2NaKJw.3sLdGlGUKGGxZzGFeYfiFqtHEI.B68akDTeNZN77SMkGPYZmQ1Z2iyUfYRYd5/:1000:1000:cndaqang:/home/cndaqang:/bin/bash
1 tests failed
</code></pre></div></div>
<p>æŸ¥çœ‹nisæœåŠ¡å™¨</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@boy01 ~]# ypwhich
mom01
</code></pre></div></div>

<h3 id="å¼€å¯é˜²ç«å¢™çš„è®¾ç½®">å¼€å¯é˜²ç«å¢™çš„è®¾ç½®</h3>
<p>å› ä¸ºè®¡ç®—èŠ‚ç‚¹boyxxå’Œç®¡ç†èŠ‚ç‚¹momä¹‹é—´è¿˜æœ‰å±€åŸŸç½‘ï¼Œ å¯ä»¥æŠŠæ­¤éƒ¨åˆ†çš„é˜²ç«å¢™ç«¯å£æ‰“å¼€ï¼Œå…³é—­è¿æ¥å¤–ç½‘çš„ç«¯å£<br />
æŸ¥çœ‹NISæœåŠ¡å™¨ç«¯å£å ç”¨</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@mom01 ~]# rpcinfo -p localhost
   program vers proto   port  service
    100000    4   tcp    111  portmapper
    100000    3   tcp    111  portmapper
    100000    2   tcp    111  portmapper
    100000    4   udp    111  portmapper
    100000    3   udp    111  portmapper
    100000    2   udp    111  portmapper
    100004    2   udp    992  ypserv
    100004    1   udp    992  ypserv
    100004    2   tcp    995  ypserv
    100004    1   tcp    995  ypserv
    100009    1   udp   1007  yppasswdd
</code></pre></div></div>
<p>ç”±äºlinuxç«¯å£èŒƒå›´ <a href="https://bbs.csdn.net/topics/340204446">1024ä»¥ä¸‹æ˜¯ç³»ç»Ÿä¿ç•™çš„ï¼Œä»1024-65535æ˜¯ç”¨æˆ·ä½¿ç”¨çš„</a>ï¼Œå­ç½‘11.11.11.0/24ï¼Œå…³é—­é»˜è®¤é˜²ç«å¢™ï¼Œä½¿ç”¨iptables
å¯ä»¥</p>
<ul>
  <li>æ‰“å¼€å†…ç½‘ç½‘å¡çš„é˜²ç«å¢™<code class="highlighter-rouge">iptables -A INPUT -i ens33 -j ACCEPT</code></li>
  <li>å…è®¸å†…ç½‘ipé€šè¿‡<code class="highlighter-rouge">iptables -I INPUT -s 11.11.11.0/24  -j ACCEPT</code></li>
</ul>

<h2 id="nfsæ–‡ä»¶ç³»ç»Ÿå…±äº«æœåŠ¡å™¨">NFSæ–‡ä»¶ç³»ç»Ÿå…±äº«æœåŠ¡å™¨</h2>
<p><a href="https://qizhanming.com/blog/2018/08/08/how-to-install-nfs-on-centos-7">CentOS 7 ä¸‹ yum å®‰è£…å’Œé…ç½® NFS</a>
NFS æ˜¯ Network File System çš„ç¼©å†™ï¼Œå³ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿã€‚å³è®¡ç®—èŠ‚ç‚¹å¯ä»¥æ‰§è¡Œç®¡ç†èŠ‚ç‚¹çš„ç¨‹åºï¼ŒæŸ¥çœ‹ç”¨æˆ·çš„æ–‡ä»¶</p>

<h3 id="æœåŠ¡å™¨ç«¯">æœåŠ¡å™¨ç«¯</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yum -y install nfs-utils
systemctl enable rpcbind
systemctl enable nfs
systemctl start rpcbind
systemctl start nfs
#æŸ¥çœ‹ç«¯å£
rpcinfo -p localhost | grep nfs
    100003    3   tcp   2049  nfs
    100003    4   tcp   2049  nfs
    100227    3   tcp   2049  nfs_acl
    100003    3   udp   2049  nfs
    100003    4   udp   2049  nfs
    100227    3   udp   2049  nfs_acl
</code></pre></div></div>
<p>è®¾ç½®å…±äº«ç›®å½•ï¼Œæ­¤å¤„è®¾ç½®è®¡ç®—ç¨‹åºç›®å½•<code class="highlighter-rouge">/opt</code>,ç”¨æˆ·æ•°æ®ç›®å½•<code class="highlighter-rouge">/home</code></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>chmod 755 /home
chmod 755 /opt
</code></pre></div></div>
<p>æ·»åŠ åˆ°é…ç½®æ–‡ä»¶<code class="highlighter-rouge">vi /etc/exports</code></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># shareDir ip(rw,no_root_squash,no_all_squash,sync)
# ip  192.168.0.0/24: å®¢æˆ·ç«¯ IP èŒƒå›´ï¼Œ* ä»£è¡¨æ‰€æœ‰ï¼Œå³æ²¡æœ‰é™åˆ¶ã€‚
# rw: æƒé™è®¾ç½®ï¼Œå¯è¯»å¯å†™ã€‚
# sync: åŒæ­¥å…±äº«ç›®å½•ã€‚
# no_root_squash: å¯ä»¥ä½¿ç”¨ root æˆæƒã€‚
# no_all_squash: å¯ä»¥ä½¿ç”¨æ™®é€šç”¨æˆ·æˆæƒã€‚

/home *(rw,no_root_squash,sync)
/opt  *(rw,no_root_squash,sync)
</code></pre></div></div>
<p>é‡å¯æœåŠ¡</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl restart nfs
</code></pre></div></div>
<p>æŸ¥çœ‹å…±äº«æƒ…å†µ</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@mom01 home]#  showmount -e localhost
Export list for localhost:
/opt  *
/home *
</code></pre></div></div>
<p>é˜²ç«å¢™å·²è®¾ç½®å¯¹é›†ç¾¤å†…ç½‘æ‰“å¼€</p>
<h3 id="å®¢æˆ·ç«¯-1">å®¢æˆ·ç«¯</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yum -y install nfs-utils
systemctl enable rpcbind
systemctl start rpcbind
</code></pre></div></div>
<p><strong>å®¢æˆ·ç«¯ä¸éœ€è¦æ‰“å¼€é˜²ç«å¢™ï¼Œå› ä¸ºå®¢æˆ·ç«¯æ—¶å‘å‡ºè¯·æ±‚æ–¹ï¼Œç½‘ç»œèƒ½è¿æ¥åˆ°æœåŠ¡ç«¯å³å¯ã€‚
å®¢æˆ·ç«¯ä¹Ÿä¸éœ€è¦å¼€å¯ NFS æœåŠ¡ï¼Œå› ä¸ºä¸å…±äº«ç›®å½•ã€‚</strong><br />
æŸ¥çœ‹ç®¡ç†èŠ‚ç‚¹nfsæƒ…å†µ</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@boy01 ~]# showmount -e mom01
Export list for mom01:
/opt  *
/home *
</code></pre></div></div>
<p>æŒ‚è½½</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@boy01 ~]# mount mom01:/opt /opt
[root@boy01 ~]# mount mom01:/home /home
[root@boy01 ~]# ls /home/
c1  cndaqang  test
</code></pre></div></div>
<p>å¼€æœºæŒ‚è½½,æ·»åŠ mountå‘½ä»¤åˆ°å¼€æœºè„šæœ¬ï¼Œæˆ–æ·»åŠ åˆ°<code class="highlighter-rouge">/etc/fstab</code></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mom01:/home     /home                   nfs     defaults        0 0
mom01:/opt      /opt                    nfs     defaults        0 0
</code></pre></div></div>

<h2 id="é˜²ç«å¢™iptables">é˜²ç«å¢™iptables</h2>
<p><a href="https://www.cnblogs.com/kreo/p/4368811.html">CentOS7å®‰è£…iptablesé˜²ç«å¢™</a>
<a href="https://blog.51cto.com/balich/1745244">Linux ä¸‹çš„ï¼ˆé˜²ç«å¢™ï¼‰iptables</a></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#install
yum -y install iptables iptables-services 
#remove default firewalld
systemctl stop firewalld
systemctl disable firewalld
systemctl mask firewalld
</code></pre></div></div>
<h3 id="æŸ¥çœ‹iptablesç°æœ‰è§„åˆ™iptables--nvl">æŸ¥çœ‹iptablesç°æœ‰è§„åˆ™<code class="highlighter-rouge">iptables -nvL</code></h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@mom01 ~]# iptables -nvL
Chain INPUT (policy DROP 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination         
  100  7320 ACCEPT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            tcp dpt:22
   10   832 ACCEPT     all  --  lo     *       0.0.0.0/0            0.0.0.0/0           

Chain FORWARD (policy DROP 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination         

Chain OUTPUT (policy ACCEPT 76 packets, 9016 bytes)
 pkts bytes target     prot opt in     out     source               destination  
</code></pre></div></div>
<h3 id="åˆ é™¤è§„åˆ™iptables--d-">åˆ é™¤è§„åˆ™<code class="highlighter-rouge">iptables -D </code></h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@mom01 ~]# iptables -nvL --line-number
Chain INPUT (policy DROP 2 packets, 148 bytes)
num   pkts bytes target     prot opt in     out     source               destination         
1      184 13504 ACCEPT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            tcp dpt:22
2       16  1444 ACCEPT     all  --  lo     *       0.0.0.0/0            0.0.0.0/0           
3        0     0 ACCEPT     all  --  ens33  *       0.0.0.0/0            0.0.0.0/0           

Chain FORWARD (policy DROP 0 packets, 0 bytes)
num   pkts bytes target     prot opt in     out     source               destination         

Chain OUTPUT (policy ACCEPT 21 packets, 2928 bytes)
num   pkts bytes target     prot opt in     out     source               destination         
[root@mom01 ~]# iptables -D INPUT 3
[root@mom01 ~]# iptables -nvL --line-number
Chain INPUT (policy DROP 0 packets, 0 bytes)
num   pkts bytes target     prot opt in     out     source               destination         
1      203 14796 ACCEPT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            tcp dpt:22
2       16  1444 ACCEPT     all  --  lo     *       0.0.0.0/0            0.0.0.0/0           

Chain FORWARD (policy DROP 0 packets, 0 bytes)
num   pkts bytes target     prot opt in     out     source               destination         

Chain OUTPUT (policy ACCEPT 4 packets, 464 bytes)
num   pkts bytes target     prot opt in     out     source               destination
</code></pre></div></div>
<h3 id="å¢åŠ è§„åˆ™">å¢åŠ è§„åˆ™</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#å…è®¸æ‰€æœ‰
iptables -P INPUT ACCEPT
#æ¸…ç©ºæ‰€æœ‰é»˜è®¤è§„åˆ™**è‹¥æœª`iptables -P INPUT ACCEPT`, ä¼šæ¸…ç©ºé»˜è®¤çš„ssh**
iptables -F
#æ¸…ç©ºæ‰€æœ‰è‡ªå®šä¹‰è§„åˆ™
iptables -X
#æ‰€æœ‰è®¡æ•°å™¨å½’0
iptables -Z
#å…è®¸æ¥è‡ªäºloæ¥å£çš„æ•°æ®åŒ…(æœ¬åœ°è®¿é—®)ï¼Œè‹¥æ— æ­¤ï¼Œå¾ˆå¤šæœåŠ¡æ¯”å¦‚ypservæ— æ³•å¯åŠ¨
iptables -A INPUT -i lo -j ACCEPT
#-Aä»£è¡¨ç¼€åŠ ï¼Œ-I æ’å…¥å¸¦å¼€å¤´ï¼Œ -iç½‘å¡ -jæ“ä½œ
#å…è®¸æ¥è‡ªäºå†…ç½‘ç½‘å¡ens33çš„æ•°æ®åŒ…(é›†ç¾¤è®¿é—®)
iptables -A INPUT -i ens33 -j ACCEPT
#å…è®¸11.11.11.1è®¿é—®æ‰€æœ‰ç«¯å£
iptables -I INPUT -s 11.11.11.1  -j ACCEPT
#å…è®¸11.11.11.0/24ç½‘æ®µipè®¿é—®æ‰€æœ‰ç«¯å£(é›†ç¾¤æ“ä½œ)
iptables -I INPUT -s 11.11.11.0/24  -j ACCEPT
#å¼€æ”¾22ç«¯å£
iptables -A INPUT -p tcp --dport 22 -j ACCEPT
#å¼€æ”¾21ç«¯å£(FTP)
iptables -A INPUT -p tcp --dport 21 -j ACCEPT
#å¼€æ”¾80ç«¯å£(HTTP)
iptables -A INPUT -p tcp --dport 80 -j ACCEPT
#å¼€æ”¾443ç«¯å£(HTTPS)
iptables -A INPUT -p tcp --dport 443 -j ACCEPT
#å…è®¸ping
iptables -A INPUT -p icmp --icmp-type 8 -j ACCEPT
##å…è®¸æ¥å—æœ¬æœºè¯·æ±‚ä¹‹åçš„è¿”å›æ•°æ® RELATED,æ˜¯ä¸ºFTPè®¾ç½®çš„
#iptables -A INPUT -m state --state  RELATED,ESTABLISHED -j ACCEPT
#å…¶ä»–å…¥ç«™ä¸€å¾‹ä¸¢å¼ƒ 
iptables -P INPUT DROP
#æ‰€æœ‰å‡ºç«™ä¸€å¾‹ç»¿ç¯
iptables -P OUTPUT ACCEPT
#æ‰€æœ‰è½¬å‘ä¸€å¾‹ä¸¢å¼ƒ
iptables -P FORWARD DROP
</code></pre></div></div>
<h3 id="ä¿å­˜ç”Ÿæ•ˆ">ä¿å­˜ç”Ÿæ•ˆ</h3>
<p>æ‰§è¡Œ<code class="highlighter-rouge">iptables</code>åç«‹å³ç”Ÿæ•ˆï¼Œé‡å¯æœ‰æ•ˆ</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl enable iptables
service iptables save
</code></pre></div></div>

<h2 id="pbsä½œä¸šç®¡ç†ç³»ç»Ÿ">pbsä½œä¸šç®¡ç†ç³»ç»Ÿ</h2>
<h3 id="ç®¡ç†èŠ‚ç‚¹mom01">ç®¡ç†èŠ‚ç‚¹mom01</h3>
<p>ç¨‹åºéƒ½å®‰è£…åœ¨<code class="highlighter-rouge">/opt</code>, ç®¡ç†èŠ‚ç‚¹å’Œè®¡ç®—èŠ‚ç‚¹å…±äº«<code class="highlighter-rouge">/opt</code>ç›®å½•</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> yum -y install libxml2-devel openssl-devel gcc gcc-c++ boost-devel libtool
./configure --prefix=/opt/CC19/torque6  --with-default-server=$HOSTNAME
#--prefix= ç¨‹åºå®‰è£…ç›®å½•
#--with-server-home=/opt/CC19/torque6/share é…ç½®æ–‡ä»¶ç›®å½• é»˜è®¤/var/spool/torque
make -j8
make install
#PATH
export TORQUE_HOME=/opt/CC19/torque6
export PATH=$TORQUE_HOME/bin:$TORQUE_HOME/sbin:$PATH
#å¹¶æŠŠä¸Šè¿°PATHæ·»åŠ åˆ°`/etc/profile`
#æ·»åŠ åˆ°ç³»ç»ŸæœåŠ¡
cp contrib/init.d/{pbs_{server,sched,mom},trqauthd} /etc/init.d/
systemctl daemon-reload
make packages
libtool --finish /opt/CC19/torque6/lib
</code></pre></div></div>
<p>åˆå§‹åŒ–</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./torque.setup root
hostname: mom01
Currently no servers active. Default server will be listed as active server. Error  15133
Active server name: mom01  pbs_server port is: 15001
trqauthd daemonized - port /tmp/trqauthd-unix
trqauthd successfully started
initializing TORQUE (admin: root)

You have selected to start pbs_server in create mode.
If the server database exists it will be overwritten.
do you wish to continue y/(n)?y
</code></pre></div></div>
<p>é…ç½®æ–‡ä»¶(è®¡ç®—èŠ‚ç‚¹)</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vi /opt/CC19/torque6/server_priv/nodes
# åœ¨dockerä¸Šå®‰è£…æ—¶ï¼Œæ˜¯è¿™ä¸ªæ–‡ä»¶ï¼Œä¸çŸ¥é“å“ªé‡Œè®¾ç½®çš„ä¸åŒå¯¼è‡´ä¸ä¸€æ · vi /var/spool/torque/server_priv/nodes
#å¡«å…¥è®¡ç®—èŠ‚ç‚¹ np=æ ¸æ•° é˜Ÿåˆ—åï¼Œ å¦‚
mom01 np=4 regular
boy01 np=8 regula
</code></pre></div></div>
<p>é…ç½®regularé˜Ÿåˆ—</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@mom01 torque-6.1.1.1]# qmgr
Max open servers: 9
Qmgr: creat queue regular queue_type=execution
Qmgr: set server default_queue=regular
Qmgr: set queue regular started=true
Qmgr: set queue regular enabled=true
Qmgr: set server scheduling=true
</code></pre></div></div>
<p>å¯åŠ¨pbsæœåŠ¡</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>for i in trqauthd pbs_server pbs_sched  ; do systemctl restart  $i.service ; done
#æ£€æŸ¥æ˜¯å¦å¯åŠ¨å®Œæˆ
for i in trqauthd pbs_server pbs_sched  ; do systemctl status  $i.service ; done
</code></pre></div></div>
<p>æŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯(æ³¨ï¼šæ­¤å¤„è¿˜æœªé…ç½®è®¡ç®—èŠ‚ç‚¹mom01, boy01ï¼Œæ‰€ä»¥æ˜¯downçŠ¶æ€)</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@mom01 torque-6.1.1.1]#  qnodes -l all
mom01                down
boy01                down
</code></pre></div></div>
<h3 id="è®¡ç®—èŠ‚ç‚¹mom01boy01">è®¡ç®—èŠ‚ç‚¹mom01,boy01</h3>
<p>æ³¨ï¼šå·²é…ç½®NISï¼ŒNFS</p>
<h4 id="è®¡ç®—èŠ‚ç‚¹mom01å•æœºpbs">è®¡ç®—èŠ‚ç‚¹mom01(å•æœºpbs)</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#ä¿®æ”¹é…ç½®æ–‡ä»¶                                              
[root@mom01 torque-6.1.1.1]# vi /var/spool/torque/mom_priv/config
#åŠ å…¥ä¸‹é¢ä¸¤è¡Œ
$pbsserver mom01                                                                  
$logevent 255        
#å¯åŠ¨æœåŠ¡         
[root@mom01 torque-6.1.1.1]# systemctl restart pbs_mom.service 
[root@mom01 torque-6.1.1.1]# systemctl status pbs_mom.service 
â— pbs_mom.service - TORQUE pbs_mom daemon
   Loaded: loaded (/usr/lib/systemd/system/pbs_mom.service; disabled; vendor preset: disabled)
   Active: active (running) since Tue 2019-09-17 13:21:36 CST; 6s ago
  Process: 75096 ExecStop=/bin/bash -c     for i in {1..5}; do      kill -0 $MAINPID &amp;&gt;/dev/null || exit 0;      /opt/CC19/torque6/sbin/momctl -s &amp;&amp; exit;      sleep 1;    done   (code=exited, status=0/SUCCESS)
 Main PID: 75102 (pbs_mom)
    Tasks: 11
   CGroup: /system.slice/pbs_mom.service
           â””â”€75102 /opt/CC19/torque6/sbin/pbs_mom -F -d /var/spool/torque

Sep 17 13:21:36 mom01 systemd[1]: Started TORQUE pbs_mom daemon.
Sep 17 13:21:36 mom01 systemd[1]: Starting TORQUE pbs_mom daemon...         
</code></pre></div></div>
<p>å›åˆ°ç®¡ç†èŠ‚ç‚¹æŸ¥çœ‹ï¼šmom01å·²ä¸Šçº¿</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@mom01 torque-6.1.1.1]# qnodes -l all
mom01                free
boy01                down
</code></pre></div></div>
<h4 id="è®¡ç®—èŠ‚ç‚¹boy01é›†ç¾¤">è®¡ç®—èŠ‚ç‚¹boy01(é›†ç¾¤)</h4>
<p>ç™»é™†è®¡ç®—èŠ‚ç‚¹boy01ï¼Œæ³¨ï¼šå·²é…ç½®NISï¼ŒNFS</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd /opt/sourcecode/torque-6.1.1.1/
./torque-package-clients-linux-x86_64.sh --install
./torque-package-mom-linux-x86_64.sh --install
#ä¿®æ”¹é…ç½®æ–‡ä»¶                                              
[root@boy01 torque-6.1.1.1]# vi /var/spool/torque/mom_priv/config
#åŠ å…¥ä¸‹é¢ä¸¤è¡Œ
$pbsserver mom01                                                                  
$logevent 255        
#å¯åŠ¨æœåŠ¡         
[root@boy01 torque-6.1.1.1]# systemctl restart pbs_mom.service 
[root@boy01 torque-6.1.1.1]# systemctl status pbs_mom.service 
</code></pre></div></div>
<p>å›åˆ°ç®¡ç†èŠ‚ç‚¹æŸ¥çœ‹</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@mom01 torque-6.1.1.1]# qnodes -l all
mom01                free
boy01                free
</code></pre></div></div>
<h4 id="å¢åŠ è®¡ç®—èŠ‚ç‚¹ä¿®æ”¹ç®¡ç†èŠ‚ç‚¹å’Œè®¡ç®—èŠ‚ç‚¹é…ç½®æ–‡ä»¶é‡å¯å³å¯">å¢åŠ è®¡ç®—èŠ‚ç‚¹ï¼Œä¿®æ”¹ç®¡ç†èŠ‚ç‚¹å’Œè®¡ç®—èŠ‚ç‚¹é…ç½®æ–‡ä»¶é‡å¯å³å¯</h4>

<h3 id="äº¤ä½œä¸š">äº¤ä½œä¸š</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[c1@mom01 ~]$ rm result 
[c1@mom01 ~]$ cat run.pbs 
#PBS -N test
#PBS -l nodes=1:ppn=4
#PBS -l walltime=1:00:00:00
#PBS -q regular
#PBS -V
#PBS -S /bin/bash
#PBS -o test.out
#
cd $PBS_O_WORKDIR
echo "hello" 
echo $HOSTNAME &gt;&gt; result
ping -c 4 11.11.11.100 
sleep 60
[c1@mom01 ~]$ qsub run.pbs 
3.mom01
[c1@mom01 ~]$ qsub run.pbs 
4.mom01
[c1@mom01 ~]$ qstat 
Job ID                    Name             User            Time Use S Queue
------------------------- ---------------- --------------- -------- - -----     
3.mom01                    test             c1                     0 R regular        
4.mom01                    test             c1                     0 R regular        
[c1@mom01 ~]$ qstat -f 3 | grep host
    exec_host = mom01/0-3
    submit_host = mom01
[c1@mom01 ~]$ qstat -f 4 | grep host
    exec_host = boy01/0-3
    submit_host = mom01
#æŸ¥çœ‹ç»“æœ
[c1@mom01 ~]$ cat result 
mom01
boy01
</code></pre></div></div>

<h3 id="pbså‡ºé”™æ—¶-é‡å¯pbsæœåŠ¡æŸ¥çœ‹pbs_xxx-statusæ‰¾é”™è¯¯åŸå› ">pbså‡ºé”™æ—¶ é‡å¯pbsæœåŠ¡ï¼ŒæŸ¥çœ‹pbs_xxx statusï¼Œæ‰¾é”™è¯¯åŸå› </h3>

<h4 id="é…ç½®æ–‡ä»¶å†™é”™">é…ç½®æ–‡ä»¶å†™é”™</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@mom01 torque-6.1.1.1]# qnodes

Unable to communicate with mom01(11.11.11.100)
Cannot connect to specified server host 'mom01'.
qnodes: cannot connect to server mom01, error=111 (Connection refused)
</code></pre></div></div>
<p>æ‰¾åˆ°é”™è¯¯åŸå› ï¼Œè§£å†³ï¼Œå¯åŠ¨æœåŠ¡</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@mom01 torque-6.1.1.1]# service pbs_server status
â— pbs_server.service - TORQUE pbs_server daemon
   Loaded: loaded (/usr/lib/systemd/system/pbs_server.service; disabled; vendor preset: disabled)
   Active: failed (Result: exit-code) since Mon 2019-09-16 23:19:02 CST; 2s ago
  Process: 30495 ExecStart=/opt/CC19/torque6/sbin/pbs_server -F -d $PBS_HOME $PBS_ARGS (code=exited, status=3)
 Main PID: 30495 (code=exited, status=3)

Sep 16 23:19:02 mom01 systemd[1]: Started TORQUE pbs_server daemon.
Sep 16 23:19:02 mom01 systemd[1]: Starting TORQUE pbs_server daemon...
Sep 16 23:19:02 mom01 PBS_Server[30495]: LOG_ERROR::parse_node_name, invalid character in token "$logevent" on line 2
Sep 16 23:19:02 mom01 PBS_Server[30495]: LOG_ERROR::PBS_Server, pbsd_init failed
Sep 16 23:19:02 mom01 systemd[1]: pbs_server.service: main process exited, code=exited, status=3/NOTIMPLEMENTED
Sep 16 23:19:02 mom01 systemd[1]: Unit pbs_server.service entered failed state.
Sep 16 23:19:02 mom01 systemd[1]: pbs_server.service failed.
#é”™è¯¯åŸå› æ˜¯ï¼š/opt/CC19/torque6/server_priv/nodes é…ç½®æ–‡ä»¶å†™é”™äº†
#åˆ é™¤é…ç½®æ–‡ä»¶ä¸­çš„ $logevent 255å³å¯
[root@mom01 torque-6.1.1.1]# vi /opt/CC19/torque6/server_priv/nodes 
[root@mom01 torque-6.1.1.1]# service pbs_server start
Starting pbs_server (via systemctl):                       [  OK  ]
[root@mom01 torque-6.1.1.1]# service pbs_server status
â— pbs_server.service - TORQUE pbs_server daemon
   Loaded: loaded (/usr/lib/systemd/system/pbs_server.service; disabled; vendor preset: disabled)
   Active: active (running) since Mon 2019-09-16 23:19:26 CST; 2s ago
 Main PID: 30565 (pbs_server)
    Tasks: 10
   CGroup: /system.slice/pbs_server.service
           â””â”€30565 /opt/CC19/torque6/sbin/pbs_server -F -d /opt/CC19/torque6

Sep 16 23:19:26 mom01 systemd[1]: Started TORQUE pbs_server daemon.
Sep 16 23:19:26 mom01 systemd[1]: Starting TORQUE pbs_server daemon...
Sep 16 23:19:26 mom01 pbs_server[30565]: Assertion failed, bad pointer in link: file "req_select.c", line 401
Sep 16 23:19:26 mom01 pbs_server[30565]: Assertion failed, bad pointer in link: file "req_select.c", line 401
[root@mom01 torque-6.1.1.1]# qnodes
boy01
     state = down
     power_state = Running
     np = 8
     properties = regular
     ntype = cluster
     mom_service_port = 15002
     mom_manager_port = 15003

</code></pre></div></div>
<h4 id="ç«¯å£å ç”¨å¯¼è‡´">ç«¯å£å ç”¨å¯¼è‡´</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@mom01 torque-6.1.1.1]# service pbs_server status                                                   
â— pbs_server.service - TORQUE pbs_server daemon                                                          
   Loaded: loaded (/usr/lib/systemd/system/pbs_server.service; disabled; vendor preset: disabled)        
   Active: failed (Result: exit-code) since Tue 2019-09-17 09:52:41 CST; 4min 29s ago                    
  Process: 3987 ExecStart=/opt/CC19/torque6/sbin/pbs_server -F -d $PBS_HOME $PBS_ARGS (code=exited, statu
s=3)                                                                                                     
 Main PID: 3987 (code=exited, status=3)                                                                  
                                                                                                         
Sep 17 09:52:41 mom01 systemd[1]: Started TORQUE pbs_server daemon.                                      
Sep 17 09:52:41 mom01 systemd[1]: Starting TORQUE pbs_server daemon...                                   
Sep 17 09:52:41 mom01 pbs_server[3987]: pbs_server port already bound: Address already in use            
Sep 17 09:52:41 mom01 systemd[1]: pbs_server.service: main process exited, code=exited, status=3/...ENTED
Sep 17 09:52:41 mom01 systemd[1]: Unit pbs_server.service entered failed state.                          
Sep 17 09:52:41 mom01 systemd[1]: pbs_server.service failed.                                             
Hint: Some lines were ellipsized, use -l to show in full.  
</code></pre></div></div>
<p>åŸå› <strong>pbs_server port already bound</strong></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#æŸ¥çœ‹ç«¯å£                                              
[root@mom01 torque-6.1.1.1]# netstat -ntulp                                                              
Active Internet connections (only servers)                                                               
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name                  
tcp        0      0 0.0.0.0:15001           0.0.0.0:*               LISTEN      3745/pbs_server  
#å‘ç°å­˜åœ¨ç«¯å£å æ®ï¼Œæ€æ‰          
[root@mom01 torque-6.1.1.1]# kill -9 3745                                                                
[root@mom01 torque-6.1.1.1]# service pbs_server status                                                   
â— pbs_server.service - TORQUE pbs_server daemon                                                          
   Loaded: loaded (/usr/lib/systemd/system/pbs_server.service; disabled; vendor preset: disabled)        
   Active: failed (Result: exit-code) since Tue 2019-09-17 09:52:41 CST; 5min ago                        
  Process: 3987 ExecStart=/opt/CC19/torque6/sbin/pbs_server -F -d $PBS_HOME $PBS_ARGS (code=exited, statu
s=3)                                                                                                     
 Main PID: 3987 (code=exited, status=3)                                                                  
                                                                                                         
Sep 17 09:52:41 mom01 systemd[1]: Started TORQUE pbs_server daemon.                                                         
Sep 17 09:52:41 mom01 systemd[1]: Starting TORQUE pbs_server daemon...                                                      
Sep 17 09:52:41 mom01 pbs_server[3987]: pbs_server port already bound: Address already in use                               
Sep 17 09:52:41 mom01 systemd[1]: pbs_server.service: main process exited, code=exited, status=3/...ENTEDSep 17 09:52:41 mom
01 systemd[1]: Unit pbs_server.service entered failed state.                                                                
Sep 17 09:52:41 mom01 systemd[1]: pbs_server.service failed.                                                                
Hint: Some lines were ellipsized, use -l to show in full.                                                                   
[root@mom01 torque-6.1.1.1]# service pbs_server start                                                                       
Starting pbs_server (via systemctl):                       [  OK  ]                                                         
[root@mom01 torque-6.1.1.1]# service pbs_server status                                                                      
â— pbs_server.service - TORQUE pbs_server daemon                                                                             
   Loaded: loaded (/usr/lib/systemd/system/pbs_server.service; disabled; vendor preset: disabled)                           
   Active: active (running) since Tue 2019-09-17 09:58:43 CST; 1s ago                                                       
Sep 17 09:52:41 mom01 systemd[1]: Started TORQUE pbs_server daemon.                                                        Sep 17 09:52:41 mom01 systemd[1]: Starting TORQUE pbs_server daemon...   
</code></pre></div></div>

<h4 id="æ·»åŠ è®¡ç®—èŠ‚ç‚¹">æ·»åŠ è®¡ç®—èŠ‚ç‚¹</h4>
<h5 id="å°†ç®¡ç†èŠ‚ç‚¹æ·»åŠ åˆ°è®¡ç®—èŠ‚ç‚¹">å°†ç®¡ç†èŠ‚ç‚¹æ·»åŠ åˆ°è®¡ç®—èŠ‚ç‚¹</h5>
<p>systemctl daemon-reload
ä¸»èŠ‚ç‚¹,æŸ¥çœ‹pbs_momç»“æœä¸åŒ</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@mom01 torque-6.1.1.1]# service pbs_mom status                                                                                             
pbs_mom running but subsys not locked                      [FAILED]                                                                             
[root@mom01 torque-6.1.1.1]# systemctl status pbs_mom.service                                                                                   
â— pbs_mom.service - TORQUE pbs_mom daemon                                                                                                       
   Loaded: loaded (/usr/lib/systemd/system/pbs_mom.service; disabled; vendor preset: disabled)                                                  
   Active: active (running) since Tue 2019-09-17 10:11:11 CST; 1min 13s ago                                                                     
  Process: 5350 ExecStop=/bin/bash -c     for i in {1..5}; do      kill -0 $MAINPID &amp;&gt;/dev/null || exit 0;      /opt/CC19/torque6/sbin/momctl -s
 &amp;&amp; exit;      sleep 1;    done   (code=exited, status=0/SUCCESS)                                                                               
 Main PID: 5369 (pbs_mom)                                                                                                                       
    Tasks: 11                                                                                                                                   
   CGroup: /system.slice/pbs_mom.service                                                                                                        
           â””â”€5369 /opt/CC19/torque6/sbin/pbs_mom -F -d /opt/CC19/torque6                                                                        
                                                                                                                                                
Sep 17 10:11:11 mom01 systemd[1]: Started TORQUE pbs_mom daemon.                                                                                
Sep 17 10:11:11 mom01 systemd[1]: Starting TORQUE pbs_mom daemon...  
</code></pre></div></div>
<p>qnodesæŸ¥çœ‹å·²ç»ä¸Šçº¿äº†</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@mom01 torque-6.1.1.1]# qnodes -l all                                                                                                      
boy01                down                                                                                                                       
mom01                free 
</code></pre></div></div>

<h4 id="å…±äº«æ–‡ä»¶ä¸é…ç½®ä½¿å¾—momlockå†²çª">å…±äº«æ–‡ä»¶ä¸é…ç½®ä½¿å¾—mom.lockå†²çª</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@boy01 ~]# systemctl status pbs_mom.service                                                                                                               
â— pbs_mom.service - SYSV: pbs_mom is part of a batch scheduler                                                                                                 
   Loaded: loaded (/etc/rc.d/init.d/pbs_mom; bad; vendor preset: disabled)                                                                                     
   Active: failed (Result: exit-code) since Tue 2019-09-17 10:17:43 CST; 40s ago                                                                               
     Docs: man:systemd-sysv-generator(8)                                                                                                                       
  Process: 2657 ExecStart=/etc/rc.d/init.d/pbs_mom start (code=exited, status=1/FAILURE)                                                                       
                                                                                                                                                               
Sep 17 10:17:42 boy01 systemd[1]: Starting SYSV: pbs_mom is part of a batch scheduler...                                                                       
Sep 17 10:17:43 boy01 pbs_mom[2673]: LOG_ERROR::Resource temporarily unavailable (11) in pbs_mom, cannot lock '/opt/CC19/torque6/mom_priv/mom.lock...om running
Sep 17 10:17:43 boy01 pbs_mom[2657]: Starting TORQUE Mom: cannot lock '/opt/CC19/torque6/mom_priv/mom.lock' - another mom running                              
Sep 17 10:17:43 boy01 pbs_mom[2657]: [FAILED]                                                                                                                  
Sep 17 10:17:43 boy01 systemd[1]: pbs_mom.service: control process exited, code=exited status=1                                                                
Sep 17 10:17:43 boy01 systemd[1]: Failed to start SYSV: pbs_mom is part of a batch scheduler.                                                                  
Sep 17 10:17:43 boy01 systemd[1]: Unit pbs_mom.service entered failed state.                                                                                   
Sep 17 10:17:43 boy01 systemd[1]: pbs_mom.service failed.                                                                                                      
Hint: Some lines were ellipsized, use -l to show in full.
</code></pre></div></div>
<p>é”™è¯¯åŸå› **Starting TORQUE Mom: cannot lock â€˜/opt/CC19/torque6/mom_priv/mom.lockâ€™ - another mom running **
ä¿®æ”¹é…ç½®</p>

<h3 id="pbså‘½ä»¤">pbså‘½ä»¤</h3>
<p>æ›´å¤šå‘½ä»¤å‚è€ƒ<a href="/2018/01/11/torque-install-centos/">å•æœºcentosç¼–è¯‘å®‰è£…ä½¿ç”¨PBS torque</a></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>äº¤æ¢ä½œä¸šé¡ºåº
[chendq@node8 core165]$ mqstat
Job ID                    Name             User            Time Use S Queue
------------------------- ---------------- --------------- -------- - -----
12.node8.localdomain       test             chendq                 0 Q regular
13.node8.localdomain       test             chendq                 0 Q regular
14.node8.localdomain       test             chendq                 0 Q regular
15.node8.localdomain       tdap             chendq                 0 Q regular
[chendq@node8 core165]$ qorder 15.node8.localdomain 12.node8.localdomain
[chendq@node8 core165]$ mqstat
Job ID                    Name             User            Time Use S Queue
------------------------- ---------------- --------------- -------- - -----
12.node8.localdomain       test             chendq                 0 Q regular
13.node8.localdomain       test             chendq                 0 Q regular
14.node8.localdomain       test             chendq                 0 Q regular
15.node8.localdomain       tdap             chendq          14:30:44 R regular
</code></pre></div></div>

<h2 id="å¤‡ä»½">å¤‡ä»½</h2>
<h3 id="å¤‡ä»½ç£ç›˜">å¤‡ä»½ç£ç›˜</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dd if=/dev/sdb of=mbr.bin
å¦å¼€çª—å£ï¼ŒæŸ¥çœ‹è¿›åº¦
watch -n 5 killall -USR1 dd
</code></pre></div></div>
<h3 id="å…‹éš†ç£ç›˜">å…‹éš†ç£ç›˜</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dd if=/dev/sdb of=/dev/sdc
dd if=/dev/sdb3 of=/dev/sdc3
</code></pre></div></div>
:ET