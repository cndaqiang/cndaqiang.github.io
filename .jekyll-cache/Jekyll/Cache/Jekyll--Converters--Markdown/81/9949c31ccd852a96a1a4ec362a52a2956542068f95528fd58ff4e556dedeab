I"¡<<ul id="markdown-toc">
  <li><a href="#å‚è€ƒ" id="markdown-toc-å‚è€ƒ">å‚è€ƒ</a></li>
  <li><a href="#read_input_fileè¯»å…¥è¾“å…¥æ–‡ä»¶" id="markdown-toc-read_input_fileè¯»å…¥è¾“å…¥æ–‡ä»¶"><strong>read_input_file</strong>è¯»å…¥è¾“å…¥æ–‡ä»¶</a>    <ul>
      <li><a href="#read_namelists" id="markdown-toc-read_namelists"><code class="highlighter-rouge">read_namelists</code></a></li>
      <li><a href="#read_cards" id="markdown-toc-read_cards"><code class="highlighter-rouge">read_cards</code></a></li>
    </ul>
  </li>
  <li><a href="#input_parametersä¸­çš„å˜é‡" id="markdown-toc-input_parametersä¸­çš„å˜é‡"><code class="highlighter-rouge">input_parameters</code>ä¸­çš„å˜é‡</a></li>
  <li><a href="#control_flagsä¸­çš„å˜é‡" id="markdown-toc-control_flagsä¸­çš„å˜é‡"><code class="highlighter-rouge">control_flags</code>ä¸­çš„å˜é‡</a></li>
  <li><a href="#constantså¸¸é‡" id="markdown-toc-constantså¸¸é‡"><code class="highlighter-rouge">constants</code>å¸¸é‡</a></li>
  <li><a href="#å¸¸ç”¨å˜é‡è¡¨" id="markdown-toc-å¸¸ç”¨å˜é‡è¡¨">å¸¸ç”¨å˜é‡è¡¨</a>    <ul>
      <li><a href="#æ™¶æ ¼ç›¸å…³cell_base" id="markdown-toc-æ™¶æ ¼ç›¸å…³cell_base">æ™¶æ ¼ç›¸å…³cell_base</a></li>
      <li><a href="#åŸå­ç›¸å…³ions_base" id="markdown-toc-åŸå­ç›¸å…³ions_base">åŸå­ç›¸å…³ions_base</a></li>
    </ul>
  </li>
</ul>

<p>QEä»£ç é˜…è¯»ç³»åˆ—ï¼Œä¸ªäººå­¦ä¹ è®°å½•ï¼Œä»…ä¾›å‚è€ƒã€‚<br />
ä»£ç ä»“åº“<a href="https://gitee.com/cndaqiang/QE-6.4.1/tree/master">QE-6.4.1@cndaqiang</a><br /></p>

<h2 id="å‚è€ƒ">å‚è€ƒ</h2>
<p><a href="https://github.com/QEF/q-e.git">q-e code</a><br /></p>

<h2 id="read_input_fileè¯»å…¥è¾“å…¥æ–‡ä»¶"><strong>read_input_file</strong>è¯»å…¥è¾“å…¥æ–‡ä»¶</h2>
<p>File:<code class="highlighter-rouge">Modules/read_input.f90</code><br />
<strong>è¯»å…¥è¾“å…¥æ–‡ä»¶ï¼Œè®¾ç½®<code class="highlighter-rouge">MODULE input_parameters</code>ä¸­çš„å˜é‡(NAMELIST,CARD)</strong></p>

<ul class="task-list">
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />MODULE read_input</p>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" /><strong><code class="highlighter-rouge">SUBROUTINE read_input_file( prog, input_file_ )</code></strong><br />
    è°ƒç”¨çš„æ¨¡å¼å¦‚PWscfçš„â€PWâ€, manypwscfçš„â€PWâ€,i-PIçš„â€PW+iPâ€i,nebçš„â€PWâ€,manycpçš„â€CPâ€<br /> å¯¹äºç”µå­ç»“æ„è®¡ç®—éƒ½æ˜¯æŒ‰ç…§â€PWâ€çš„æ¨¡å¼è¯»å…¥</p>

    <ul class="task-list">
      <li class="task-list-item">
        <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" /><code class="highlighter-rouge">ierr = open_input_file( input_file_, xmlinput )</code> æ‰“å¼€è¾“å…¥æ–‡ä»¶</p>
      </li>
      <li class="task-list-item">
        <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" /><code class="highlighter-rouge">CALL read_namelists( prog, qestdin )</code> è¯»å…¥NAMELISTå‹å˜é‡<code class="highlighter-rouge">&amp;NAMELIST ... /</code><br /></p>

        <p>File:<code class="highlighter-rouge">Modules/read_namelists.f90</code><br /></p>

        <p>æœ‰è¯»å…¥é¡ºåºï¼Œä½¿ç”¨Fortranè¯­æ³•è¯»å…¥<code class="highlighter-rouge">READ( unit_loc, NAMELIST, iostat = ios )</code></p>

        <p>â€œPW+ipiâ€ç›¸æ¯”â€PWâ€åªæ˜¯å¤šè¯»äº†ä¸€ä¸ª<code class="highlighter-rouge">&amp;INOS /</code>è€Œå·²ï¼Œæ— ç”¨çš„NAMELISTä¼šwarning</p>
      </li>
      <li class="task-list-item">
        <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" /><code class="highlighter-rouge">CALL read_cards ( prog(1:2), qestdin )</code> è¯»å…¥CARDå‹å˜é‡<br /></p>

        <p>File:<code class="highlighter-rouge">Modules/read_cards.f90</code><br /></p>

        <p>æ­¤å¤„å¯ä»¥çœ‹åˆ°,å¯¹äºpwscf,manypwscf,ipi,nebè®¡ç®—éƒ½æŒ‰ç…§PWè¯»å…¥å¡ç‰‡</p>
      </li>
    </ul>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" /><strong>END SUBROUTINE read_input_file</strong></p>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />END MODULE read_input</p>
  </li>
</ul>

<h3 id="read_namelists"><code class="highlighter-rouge">read_namelists</code></h3>
<p>File:<code class="highlighter-rouge">Modules/read_namelists.f90</code>&lt;br
ä¸»è¦è¯»å…¥<code class="highlighter-rouge">MODULE input_parameters</code>ä¸­çš„NAMELIST(<code class="highlighter-rouge">&amp; /</code>)å‹å˜é‡å˜é‡<br />
ä»¥<code class="highlighter-rouge">control</code>NAMELISTä¸ºä¾‹</p>
<ul>
  <li><code class="highlighter-rouge">CALL control_defaults( prog )</code>é»˜è®¤å€¼ã€€</li>
  <li><strong><code class="highlighter-rouge">READ( unit_loc, control, iostat = ios )</code>è¯»å…¥è¾“å…¥æ–‡ä»¶</strong></li>
  <li><code class="highlighter-rouge">CALL check_namelist_read(ios, unit_loc, "control")</code>æ£€æŸ¥é—®é¢˜</li>
  <li><code class="highlighter-rouge">CALL control_bcast( )</code>å¹¿æ’­å˜é‡</li>
  <li><code class="highlighter-rouge">CALL control_checkin( prog )</code>æ£€æŸ¥è¾“å…¥å€¼æ˜¯å¦åœ¨æŒ‡å®šåŒºé—´</li>
  <li><code class="highlighter-rouge">CALL fixval( prog )</code>è®¡ç®—ä¸€äº›å€¼</li>
</ul>

<p>å…¶ä»–çš„NAMELISTå¦‚system,electrons,ions,cell,è¿™äº›NAMELISTä¸­<strong>è¿˜å®šä¹‰å¾ˆå¤šå˜é‡ï¼Œä»–ä»¬å¯èƒ½å¹¶æ²¡æœ‰å‡ºç°åœ¨QEçš„æ‰‹å†Œé‡Œé¢</strong>ï¼Œå¯èƒ½æ˜¯debugçš„å‚æ•°,å¯ä»¥è¿›è¡Œè®¾ç½®è®¡ç®—ã€‚</p>

<h3 id="read_cards"><code class="highlighter-rouge">read_cards</code></h3>
<p>File:<code class="highlighter-rouge">Modules/read_cards.f90</code><br /></p>

<ul>
  <li>è®¾ç½®é»˜è®¤å€¼</li>
  <li>è·³è¿‡<code class="highlighter-rouge">#,!</code>æ¥å¤´è¡Œï¼Œå½•å…¥æœ‰æ•ˆä¿¡æ¯</li>
  <li>è¯»å…¥é€‰é¡¹å¡</li>
</ul>

<h2 id="input_parametersä¸­çš„å˜é‡"><code class="highlighter-rouge">input_parameters</code>ä¸­çš„å˜é‡</h2>
<p>File:<code class="highlighter-rouge">Modules/input_parameters.f90</code><br />
å­˜å‚¨è¾“å…¥å‚æ•°çš„å˜é‡è¡¨,å˜é‡åå’Œè¾“å…¥ååŸºæœ¬ä¸Šéƒ½æ˜¯ä¸€æ ·çš„</p>

<h2 id="control_flagsä¸­çš„å˜é‡"><code class="highlighter-rouge">control_flags</code>ä¸­çš„å˜é‡</h2>
<p>File:<code class="highlighter-rouge">Modules/control_flags.f90</code><br />
å¾ˆå¤šç¨‹åºéƒ½ç”¨<code class="highlighter-rouge">control_flags</code>ä¸­çš„å˜é‡, <strong>æ§åˆ¶æ•´ä¸ªè®¡ç®—æ‰§è¡Œçš„åŸºæœ¬å‚æ•°</strong>ã€‚<br />
åœ¨æ­£å¼è®¡ç®—å‰è¢«å®šä¹‰ä¸ªä½¿ç”¨ï¼Œ<code class="highlighter-rouge">iosys()</code>å’Œ<code class="highlighter-rouge">setup()</code>ä¸­è¢«å…·ä½“è®¾ç½®</p>

<ul>
  <li>
    <p><code class="highlighter-rouge">io_level = 1</code>, æ§åˆ¶bufferä¿å­˜åˆ°å†…å­˜è¿˜æ˜¯æ–‡ä»¶,ç”±<code class="highlighter-rouge">disk_io</code>è¾“å…¥å‚æ•°æ§åˆ¶       ! variable controlling the amount of I/O to file
<br /> io_level &gt; 1æ‰“å¼€æ–‡ä»¶,å¦åˆ™,æ‰“å¼€å†…å­˜ç¼“å†²åŒº</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">smallmem      = .FALSE. </code> the memory per task is small
ç”±<code class="highlighter-rouge">&amp;CONTROL</code>ä¸­çš„<code class="highlighter-rouge">memory='small', 'default', 'large'</code>å†³å®šï¼Œé‡‡ç”¨ä¸åŒçš„ç®—æ³•ï¼Œå®˜æ–¹æ‰‹å†Œä¸­æ²¡æœ‰å†™<br />
<code class="highlighter-rouge">smallmem = ( TRIM( memory ) == 'small' )</code></p>
  </li>
</ul>

<h2 id="constantså¸¸é‡"><code class="highlighter-rouge">constants</code>å¸¸é‡</h2>
<p>File:<code class="highlighter-rouge">Modules/constants.f90</code></p>

<ul>
  <li>
    <p>â€¦ Mathematical constants</p>

    <ul>
      <li>pi     = 3.14159265358979323846_DP</li>
      <li>tpi    = 2.0_DP * pi</li>
      <li>fpi    = 4.0_DP * pi</li>
      <li>sqrtpi = 1.77245385090551602729_DP</li>
      <li>sqrtpm1= 1.0_DP / sqrtpi</li>
      <li>sqrt2  = 1.41421356237309504880_DP</li>
    </ul>
  </li>
  <li>â€¦ Physical constants, SI (NIST CODATA 2006), Web Version 5.1
  http://physics.nist.gov/constants
    <ul>
      <li>H_PLANCK_SI      = 6.62606896E-34_DP  - J s</li>
      <li>K_BOLTZMANN_SI   = 1.3806504E-23_DP   - J K^-1</li>
      <li>ELECTRON_SI      = 1.602176487E-19_DP - C</li>
      <li>ELECTRONVOLT_SI  = 1.602176487E-19_DP - J</li>
      <li>ELECTRONMASS_SI  = 9.10938215E-31_DP  - Kg</li>
      <li>HARTREE_SI       = 4.35974394E-18_DP  - J</li>
      <li>RYDBERG_SI       = HARTREE_SI/2.0_DP  - J</li>
      <li>BOHR_RADIUS_SI   = 0.52917720859E-10_DP ! m</li>
      <li>AMU_SI           = 1.660538782E-27_DP - Kg</li>
      <li>C_SI             = 2.99792458E+8_DP   - m sec^-1</li>
      <li>MUNOUGHT_SI      = fpi*1.0E-7_DP      - N A^-2</li>
      <li>EPSNOUGHT_SI     = 1.0_DP / (MUNOUGHT_SI * &amp;
                                                 C_SI**2) ! F m^-1</li>
    </ul>
  </li>
  <li>
    <p>â€¦ Physical constants, atomic units:
  â€¦ AU for â€œHartreeâ€ atomic units (e = m = hbar = 1)
  â€¦ RY for â€œRydbergâ€ atomic units (e^2=2, m=1/2, hbar=1)</p>

    <ul>
      <li>K_BOLTZMANN_AU   = K_BOLTZMANN_SI / HARTREE_SI</li>
      <li>K_BOLTZMANN_RY   = K_BOLTZMANN_SI / RYDBERG_SI</li>
    </ul>
  </li>
  <li>â€¦ Unit conversion factors: energy and masses
    <ul>
      <li>AUTOEV           = HARTREE_SI / ELECTRONVOLT_SI</li>
      <li>RYTOEV           = AUTOEV / 2.0_DP</li>
      <li>AMU_AU           = AMU_SI / ELECTRONMASS_SI</li>
      <li>AMU_RY           = AMU_AU / 2.0_DP</li>
    </ul>
  </li>
  <li>â€¦ Unit conversion factors: atomic unit of time, in s and ps
    <ul>
      <li>AU_SEC           = H_PLANCK_SI/tpi/HARTREE_SI</li>
      <li>AU_PS            = AU_SEC * 1.0E+12_DP</li>
    </ul>
  </li>
  <li>â€¦ Unit conversion factors: pressure (1 Pa = 1 J/m^3, 1GPa = 10 Kbar )
    <ul>
      <li>AU_GPA           = HARTREE_SI / BOHR_RADIUS_SI ** 3 &amp;
                                      / 1.0E+9_DP</li>
      <li>RY_KBAR          = 10.0_DP * AU_GPA / 2.0_DP</li>
    </ul>
  </li>
  <li>â€¦ Unit conversion factors: 1 debye = 10^-18 esu*cm</li>
  <li>â€¦                                  = 3.3356409519*10^-30 C*m</li>
  <li>â€¦                                  = 0.208194346 e*A</li>
  <li>â€¦ ( 1 esu = (0.1/c) Am, c=299792458 m/s)
    <ul>
      <li>DEBYE_SI         = 3.3356409519_DP * 1.0E-30_DP ! C*m</li>
      <li>AU_DEBYE         = ELECTRON_SI * BOHR_RADIUS_SI / &amp;
                                      DEBYE_SI</li>
      <li>eV_to_kelvin = ELECTRONVOLT_SI / K_BOLTZMANN_SI</li>
      <li>ry_to_kelvin = RYDBERG_SI / K_BOLTZMANN_SI</li>
    </ul>
  </li>
  <li>.. Unit conversion factors: Energy to wavelength
    <ul>
      <li>EVTONM = 1E+9_DP * H_PLANCK_SI * C_SI / &amp;
                            &amp;ELECTRONVOLT_SI</li>
      <li>RYTONM = 1E+9_DP * H_PLANCK_SI * C_SI / RYDBERG_SI</li>
    </ul>
  </li>
  <li>Speed of light in atomic units
    <ul>
      <li>C_AU             = C_SI / BOHR_RADIUS_SI * AU_SEC</li>
    </ul>
  </li>
  <li>â€¦ zero up to a given accuracy
    <ul>
      <li>eps4  = 1.0E-4_DP</li>
      <li>eps6  = 1.0E-6_DP</li>
      <li>eps8  = 1.0E-8_DP</li>
      <li>eps12 = 1.0E-12_DP</li>
      <li>eps14 = 1.0E-14_DP</li>
      <li>eps16 = 1.0E-16_DP</li>
      <li>eps24 = 1.0E-24_DP</li>
      <li>
        <p>eps32 = 1.0E-32_DP</p>
      </li>
      <li>
        <p>gsmall = 1.0E-12_DP</p>
      </li>
      <li>e2 = 2.0_DP     - the square of the electron charge</li>
      <li>degspin = 2.0_DP ! the number of spins per level</li>
    </ul>
  </li>
  <li>
    <p>!!!!! COMPATIBIILITY</p>

    <ul>
      <li>BOHR_RADIUS_CM = BOHR_RADIUS_SI * 100.0_DP</li>
      <li>BOHR_RADIUS_ANGS = BOHR_RADIUS_CM * 1.0E8_DP</li>
      <li>ANGSTROM_AU = 1.0_DP/BOHR_RADIUS_ANGS</li>
      <li>DIP_DEBYE = AU_DEBYE</li>
      <li>AU_TERAHERTZ  = AU_PS</li>
      <li>AU_TO_OHMCMM1 = 46000.0_DP ! (ohm cm)^-1</li>
      <li>RY_TO_THZ = 1.0_DP / AU_TERAHERTZ / FPI</li>
      <li>RY_TO_GHZ = RY_TO_THZ*1000.0_DP</li>
      <li>RY_TO_CMM1 = 1.E+10_DP * RY_TO_THZ / C_SI
  !</li>
      <li>AVOGADRO = 6.02214129D+23</li>
    </ul>
  </li>
</ul>

<h2 id="å¸¸ç”¨å˜é‡è¡¨">å¸¸ç”¨å˜é‡è¡¨</h2>

<h3 id="æ™¶æ ¼ç›¸å…³cell_base">æ™¶æ ¼ç›¸å…³cell_base</h3>
<p>File:<code class="highlighter-rouge">Modules/cell_base.f90</code><br />
ä½¿ç”¨:<code class="highlighter-rouge">USE cell_base,  ONLY : at</code><br />
å•ä½æ¢ç®—</p>
<ul>
  <li><code class="highlighter-rouge">1 Ang = 1.8897261 Bohr</code></li>
</ul>

<table>
  <thead>
    <tr>
      <th>è¾“å…¥å‚æ•°</th>
      <th>å«ä¹‰</th>
      <th>å¤‡æ³¨</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge"> REAL(DP) :: alat = 0.0_DP </code></td>
      <td><code class="highlighter-rouge">alat</code>æ™¶æ ¼å¸¸æ•° æ™¶æ ¼ç¼©æ”¾ç³»æ•°, <code class="highlighter-rouge">at</code>çš„é•¿åº¦å•ä½</td>
      <td><strong>ç¨‹åºä¸­å•ä½æ˜¯Bohr</strong> ,è¾“å…¥æ–‡ä»¶A,å•ä½æ˜¯Ang</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge"> REAL(DP) :: at(3,3) = RESHAPE( (/ 0.0_DP /), (/ 3, 3 /), (/ 0.0_DP /) ) </code></td>
      <td>åŸèƒæ™¶æ ¼, å•ä½æ˜¯<code class="highlighter-rouge">å®é™…é•¿åº¦/alat</code></td>
      <td><strong>ç¨‹åºä¸­æ•°å€¼å•ä½æ˜¯1</strong>, ç­‰äºè¾“å…¥çš„<code class="highlighter-rouge">at[Ang]/A[Ang]</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge"> REAl(DP) :: omega = 0.0_DP  </code></td>
      <td>åŸèƒä½“ç§¯</td>
      <td>å•ä½<code class="highlighter-rouge">Bohr^3</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge"> REAL(DP) :: tpiba  = 0.0_DP, tpiba2 = 0.0_DP  </code></td>
      <td><code class="highlighter-rouge">tpiba = 2pi/alat </code>, <code class="highlighter-rouge">tpiba2=tpiba^2</code>, <code class="highlighter-rouge">tpiba</code>æ˜¯å€’æ ¼å¤±å•ä½</td>
      <td>Â </td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge"> REAL(DP) :: bg(3,3) = RESHAPE( (/ 0.0_DP /), (/ 3, 3 /), (/ 0.0_DP /) )  </code></td>
      <td>å€’æ ¼å¤±, å•ä½æ˜¯<code class="highlighter-rouge">å®é™…é•¿åº¦/thiba</code></td>
      <td><strong>ç¨‹åºä¸­æ•°å€¼å•ä½æ˜¯1</strong></td>
    </tr>
  </tbody>
</table>

<p>ç›¸å…³æ¨å¯¼:
<code class="highlighter-rouge">at_real,bg_real</code>åˆ†åˆ«è¡¨ç¤ºå®é™…çš„æ™¶æ ¼çŸ¢é‡, å€’æ ¼å¤±<br />
<code class="highlighter-rouge">at,bg</code>åˆ†åˆ«æ˜¯â€ç›¸å¯¹â€çš„æ™¶æ ¼çŸ¢é‡, å€’æ ¼å¤±
=&gt; <code class="highlighter-rouge">at_real*bg_real=2*PI</code><br />
=&gt; <code class="highlighter-rouge">at*(alat)*bg*(thiba)=2*PI</code><br />
=&gt; <code class="highlighter-rouge">thiba = 2*PI/alat</code></p>

<p>The lattice parameter alat = A (in ANGSTROM )</p>

<h3 id="åŸå­ç›¸å…³ions_base">åŸå­ç›¸å…³ions_base</h3>
<p>File:<code class="highlighter-rouge">Modules/ions_base.f90</code></p>

<ul>
  <li><code class="highlighter-rouge">nsp   </code>          å…ƒç´ æ•°,i.e. ntype, number of species</li>
  <li><code class="highlighter-rouge">na(is)</code>          å…ƒç´ isæœ‰å¤šå°‘ç§åŸå­,number of atoms of species is</li>
  <li><code class="highlighter-rouge">nax   </code>          max number of atoms of a given species</li>
  <li><code class="highlighter-rouge">nat   </code>          è¾“å…¥å‚æ•°åŸå­æ•°nat, total number of atoms of all species</li>
  <li><code class="highlighter-rouge">ityp( i )</code>       å…ƒç´ ç±»å‹,1â€¦ntype, the type of i-th atom in stdin</li>
  <li><code class="highlighter-rouge">atm( j )</code>        <code class="highlighter-rouge">CHARACTER(LEN=3)</code>,name of the type of the j-th atomic specie</li>
  <li><code class="highlighter-rouge">tau( 1:3, i )</code>   position of the i-th atom</li>
</ul>

:ET