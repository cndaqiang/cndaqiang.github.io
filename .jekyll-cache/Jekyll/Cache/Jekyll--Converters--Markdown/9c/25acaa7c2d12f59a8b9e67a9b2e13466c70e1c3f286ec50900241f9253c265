I"­Î<ul id="markdown-toc">
  <li><a href="#å‚è€ƒ" id="markdown-toc-å‚è€ƒ">å‚è€ƒ</a></li>
  <li><a href="#è¯´æ˜" id="markdown-toc-è¯´æ˜">è¯´æ˜</a>    <ul>
      <li><a href="#æ€»è§ˆ" id="markdown-toc-æ€»è§ˆ">æ€»è§ˆ</a></li>
      <li><a href="#manualä¸­çš„ä¸€äº›å…³é”®è¯è§£é‡Š" id="markdown-toc-manualä¸­çš„ä¸€äº›å…³é”®è¯è§£é‡Š">manualä¸­çš„ä¸€äº›å…³é”®è¯è§£é‡Š</a>        <ul>
          <li><a href="#scalapack" id="markdown-toc-scalapack">ScaLapack</a>            <ul>
              <li><a href="#locclocr" id="markdown-toc-locclocr"><code class="highlighter-rouge">LOCc</code>,<code class="highlighter-rouge">LOCr</code></a></li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#åœ¨ä»£ç ä¸­è§£é‡Š" id="markdown-toc-åœ¨ä»£ç ä¸­è§£é‡Š">åœ¨ä»£ç ä¸­è§£é‡Š</a>    <ul>
      <li><a href="#blasåŸºç¡€åŠŸèƒ½" id="markdown-toc-blasåŸºç¡€åŠŸèƒ½">BLASåŸºç¡€åŠŸèƒ½</a></li>
      <li><a href="#driver-routines" id="markdown-toc-driver-routines">Driver Routines</a>        <ul>
          <li><a href="#çº¿æ€§æ–¹ç¨‹ç»„--axb" id="markdown-toc-çº¿æ€§æ–¹ç¨‹ç»„--axb">çº¿æ€§æ–¹ç¨‹ç»„ | AX=B</a></li>
          <li><a href="#æœ€å°äºŒä¹˜é—®é¢˜--llslinear-leqat-squares-problems" id="markdown-toc-æœ€å°äºŒä¹˜é—®é¢˜--llslinear-leqat-squares-problems">æœ€å°äºŒä¹˜é—®é¢˜ | LLS(Linear Leqat squares problems)</a></li>
          <li><a href="#æ ‡å‡†æœ¬å¾å€¼é—®é¢˜axex" id="markdown-toc-æ ‡å‡†æœ¬å¾å€¼é—®é¢˜axex">æ ‡å‡†æœ¬å¾å€¼é—®é¢˜AX=EX</a>            <ul>
              <li><a href="#å¯¹ç§°æœ¬å¾å€¼é—®é¢˜sepsymmetric-eigenproblems" id="markdown-toc-å¯¹ç§°æœ¬å¾å€¼é—®é¢˜sepsymmetric-eigenproblems">å¯¹ç§°æœ¬å¾å€¼é—®é¢˜|SEP(Symmetric eigenproblems)</a></li>
              <li><a href="#éå¯¹ç§°æœ¬å¾å€¼é—®é¢˜nepnonsymmetric-eigenproblems" id="markdown-toc-éå¯¹ç§°æœ¬å¾å€¼é—®é¢˜nepnonsymmetric-eigenproblems">éå¯¹ç§°æœ¬å¾å€¼é—®é¢˜|NEP(Nonsymmetric eigenproblems)</a></li>
              <li><a href="#å¥‡å¼‚å€¼é—®é¢˜svdsingular-value-decomposion" id="markdown-toc-å¥‡å¼‚å€¼é—®é¢˜svdsingular-value-decomposion">å¥‡å¼‚å€¼é—®é¢˜|SVD(Singular value decomposion)</a></li>
            </ul>
          </li>
          <li><a href="#å¹¿ä¹‰çš„æœ¬å¾å€¼é—®é¢˜--generalized-eigenvalue-problems" id="markdown-toc-å¹¿ä¹‰çš„æœ¬å¾å€¼é—®é¢˜--generalized-eigenvalue-problems">å¹¿ä¹‰çš„æœ¬å¾å€¼é—®é¢˜ | Generalized eigenvalue problems</a></li>
          <li><a href="#å¹¿ä¹‰å¯¹ç§°çš„æœ¬å¾å€¼é—®é¢˜gsep-generalized-symmetric-definite-eigenproblems" id="markdown-toc-å¹¿ä¹‰å¯¹ç§°çš„æœ¬å¾å€¼é—®é¢˜gsep-generalized-symmetric-definite-eigenproblems">å¹¿ä¹‰å¯¹ç§°çš„æœ¬å¾å€¼é—®é¢˜|<strong>GSEP</strong> Generalized symmetric-definite eigenproblems</a>            <ul>
              <li><a href="#å¹¿ä¹‰éå¯¹ç§°çš„æœ¬å¾å€¼é—®é¢˜gnep-generalized-nonsymmetric--eigenproblems" id="markdown-toc-å¹¿ä¹‰éå¯¹ç§°çš„æœ¬å¾å€¼é—®é¢˜gnep-generalized-nonsymmetric--eigenproblems">å¹¿ä¹‰éå¯¹ç§°çš„æœ¬å¾å€¼é—®é¢˜|<strong>GNEP</strong> Generalized nonsymmetric  eigenproblems</a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li><a href="#computational-routines" id="markdown-toc-computational-routines">Computational Routines</a>        <ul>
          <li><a href="#facrotizeåˆ†è§£-trf" id="markdown-toc-facrotizeåˆ†è§£-trf">Facrotizeåˆ†è§£(-TRF)</a></li>
        </ul>
      </li>
      <li><a href="#scalapackæœ‰ä¸lapackç›¸åŒçš„å‡½æ•°" id="markdown-toc-scalapackæœ‰ä¸lapackç›¸åŒçš„å‡½æ•°">Scalapackæœ‰ä¸Lapackç›¸åŒçš„å‡½æ•°</a>        <ul>
          <li><a href="#luåˆ†è§£æ±‚é€†" id="markdown-toc-luåˆ†è§£æ±‚é€†">LUåˆ†è§£æ±‚é€†</a>            <ul>
              <li><a href="#åŸç†" id="markdown-toc-åŸç†">åŸç†</a></li>
              <li><a href="#luåˆ†è§£pgetrf" id="markdown-toc-luåˆ†è§£pgetrf">LUåˆ†è§£<code class="highlighter-rouge">p?getrf</code></a></li>
              <li><a href="#æ±‚é€†pgetri" id="markdown-toc-æ±‚é€†pgetri">æ±‚é€†<code class="highlighter-rouge">p?getri</code></a></li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#æŠ¥é”™" id="markdown-toc-æŠ¥é”™">æŠ¥é”™</a>    <ul>
      <li><a href="#parameter-number---10-had-an-illegal-value" id="markdown-toc-parameter-number---10-had-an-illegal-value"><code class="highlighter-rouge">parameter number   10 had an illegal value</code></a></li>
      <li><a href="#----0----2--on-entry-to-pdgetrf-parameter-number--601-had-an-illegal-value" id="markdown-toc-----0----2--on-entry-to-pdgetrf-parameter-number--601-had-an-illegal-value"><code class="highlighter-rouge">{    0,    2}:  On entry to PDGETRF parameter number  601 had an illegal value</code></a></li>
      <li><a href="#pblas-error-illegal-descaimb_--0-å…¶å®è¿˜æ˜¯è¾“å…¥å‚æ•°é¡ºåºå†™é”™äº†ç»™äº†é”™çš„å‚æ•°" id="markdown-toc-pblas-error-illegal-descaimb_--0-å…¶å®è¿˜æ˜¯è¾“å…¥å‚æ•°é¡ºåºå†™é”™äº†ç»™äº†é”™çš„å‚æ•°"><code class="highlighter-rouge">PBLAS ERROR 'Illegal DESCA[IMB_] = 0</code> å…¶å®è¿˜æ˜¯è¾“å…¥å‚æ•°é¡ºåºå†™é”™äº†ï¼Œç»™äº†é”™çš„å‚æ•°</a></li>
    </ul>
  </li>
</ul>

<p>ä¸çŸ¥å•¥æ—¶å€™èƒ½å¡«å®Œ</p>

<h2 id="å‚è€ƒ">å‚è€ƒ</h2>
<p><a href="http://homepage.ntu.edu.tw/~wttsai/fortran/ppt/9.Linear_Algebra_Computation.pdf">9. Linear Algebra Computation</a>
<br /><a href="http://homepage.ntu.edu.tw/~wttsai/fortran/BLAS_LAPACK/BLAS%20Quick%20Reference%20Guide.pdf">BLAS Quick Reference Guide</a>
<br /><a href="http://homepage.ntu.edu.tw/~wttsai/fortran/BLAS_LAPACK/LAPACK%20Quick%20Reference%20Guide.pdf">LAPACK Quick Reference Guide</a>
<br /><a href="http://homepage.ntu.edu.tw/~wttsai/fortran/BLAS_LAPACK/LAPACK%20Quick%20Reference%20Guide%20to%20Driver%20Routines.pdf">LAPACK Quick Reference Guide to Driver Routines</a>
<br /><a href="http://homepage.ntu.edu.tw/~wttsai/fortran/BLAS_LAPACK/Preliminary%20LAPACK%20Users%20Guide.pdf">Preliminary LAPACK Usersâ€™ Guide</a>
<br />çœ‹æ­¤æ–‡å‰å¿…é¡»æå‰çœ‹è¿‡ï¼š<a href="/2019/04/06/Fortran-math">Fortran ç§‘å­¦è®¡ç®—</a>
<br />Demmel J , å¾·æ¢…å°”, Demmel, et al. åº”ç”¨æ•°å€¼çº¿æ€§ä»£æ•°[M]. äººæ°‘é‚®ç”µå‡ºç‰ˆç¤¾, 2007.</p>

<h2 id="è¯´æ˜">è¯´æ˜</h2>
<h3 id="æ€»è§ˆ">æ€»è§ˆ</h3>
<ul>
  <li>å…³äºBLAS, Lapack, ScaLapackçš„æ›´å¤šä»‹ç»è§<a href="/2019/04/06/Fortran-math">Fortran ç§‘å­¦è®¡ç®—</a></li>
  <li>è°ƒç”¨å‡½æ•°<code class="highlighter-rouge">call [P]XYYZZZ()</code>
<br />Scalapackåœ¨åç§°å‰å¤šä¸ªP 
<br />Xæ•°æ®ç±»å‹.  S: real, D: real(dp), C: complex, Z: complex(dp)
<br />YYçŸ©é˜µç±»å‹. GEæ™®é€šçŸ©é˜µ, POå¯¹ç§°æ­£å®šçŸ©é˜µ, SYå¯¹ç§°éæ­£å®šçŸ©é˜µ
<br />ZZZåŠŸèƒ½/è¿ç®—</li>
  <li>BLASï¼ŒLapack, ScaLapackä¼šæ ¹æ®çŸ©é˜µçš„ç±»å‹æœ‰ä¸åŒçš„è¾“å…¥è¾“å‡ºå‚æ•°, ä»è€Œæé«˜æ•ˆç‡</li>
  <li>åŒä¸€ä¸ªåŠŸèƒ½å¯èƒ½ç”±ä¸åŒçš„å‡½æ•°YYYå®ç°, ä¸åŒçš„YYYæ‰§è¡Œé€Ÿåº¦å’Œé™„åŠ åŠŸèƒ½æœ‰å·®å¼‚</li>
  <li>BLAS æä¾›åŸºç¡€çš„çŸ©é˜µå‘é‡ä¹˜é™¤è¿ç®—åŠŸèƒ½</li>
  <li>Lapackå’ŒScaLapackæä¾›<code class="highlighter-rouge">Driver Routines</code>å’Œ<code class="highlighter-rouge">Computational Routine</code>ç­‰ä¸°å¯Œçš„çº¿ä»£åŠŸèƒ½</li>
  <li><code class="highlighter-rouge">Driver Routines</code>ä¸€ä¸ªå‡½æ•°å°±å¯ä»¥è§£å†³çº¿ä»£æ ‡å‡†é—®é¢˜: 
<br /> a. çº¿æ€§æ–¹ç¨‹ç»„ $ Ax=B $
<br /> b. æœ€å°äºŒä¹˜é—®é¢˜(LLS) $ ||Ax - b ||_2  $
<br /> c. ç‰¹å¾å€¼é—®é¢˜  $ Ax = \lambda x $ ä»¥åŠ é‡åŒ–ä¸­çš„ $ HC=SCE $ç­‰
<br /> d. å¥‡å¼‚å€¼é—®é¢˜(SVD)</li>
  <li><code class="highlighter-rouge">Computational Routine</code> é€šè¿‡ç»„åˆè§£å†³ä¸åŒçš„çº¿ä»£é—®é¢˜
<br />ä¸Šä¸€ä¸ªå‡½æ•°çš„è¾“å‡ºä½œä¸ºä¸‹ä¸€ä¸ªå‡½æ•°çš„è¾“å…¥</li>
  <li>è§£å†³é—®é¢˜: 
<br /> ç¡®å®šçº¿ä»£é—®é¢˜çš„æ±‚è§£è¿‡ç¨‹
<br /> æŸ¥æ‰¾å‡½æ•°<a href="http://homepage.ntu.edu.tw/~wttsai/fortran/BLAS_LAPACK/BLAS%20Quick%20Reference%20Guide.pdf">BLAS Quick Reference Guide</a>, <a href="http://homepage.ntu.edu.tw/~wttsai/fortran/BLAS_LAPACK/LAPACK%20Quick%20Reference%20Guide.pdf">LAPACK Quick Reference Guide</a>,Scalapackå¯ä»¥æŸ¥æ‰¾Lapackç„¶ååŠ P
<br /> æ£€ç´¢ç”¨æ³•å¦‚<a href="https://scc.ustc.edu.cn/zlsc/tc4600/intel/2017.0.098/mkl/common/mklman_f/index.htm">Developer Reference for IntelÂ® Math Kernel Library 2017 - Fortran</a></li>
  <li>æœ‰äº›é™åˆ¶æ¯”å¦‚çŸ©é˜µçš„å¤§å°ï¼Œæˆ–è€…å‡½æ•°é€‚åˆçš„ç¯å¢ƒåœ¨è¿™äº›manualé‡Œé¢æ˜¯æ²¡è¯´çš„ï¼Œæ¯”å¦‚å¸¦çŠ¶çŸ©é˜µçš„å­˜å‚¨è®¡ç®—æ¡ä»¶ï¼Œéœ€è¦è‡ªå·±å»çœ‹Scalapackçš„æºä»£ç ï¼Œæ³¨é‡Šé‡Œé¢è¯´çš„å¾ˆè¯¦ç»†</li>
  <li><strong><code class="highlighter-rouge">scalapack-2.0.2/TESTING/LIN</code>æºç ç›®å½•çš„æµ‹è¯•ç¨‹åºæ˜¯æœ€å¥½çš„å­¦ä¹ èµ„æº</strong></li>
</ul>

<h3 id="manualä¸­çš„ä¸€äº›å…³é”®è¯è§£é‡Š">manualä¸­çš„ä¸€äº›å…³é”®è¯è§£é‡Š</h3>
<p>å„ä¸ªå‡½æ•°çš„æºç ä¸­æœ‰å¯¹è¾“å…¥å‚æ•°çš„è§£é‡Šï¼Œè§£é‡Šä¸­åŒ…å«äº†ä¸€äº›é»˜è®¤çš„åè¯æ²¡æœ‰è§£é‡Šï¼Œæ­¤å¤„è§£é‡Š</p>

<ul>
  <li>incx INTEGER. Specifies the increment for the elements of x.
<br /><code class="highlighter-rouge">X(1,1+incx,1+2*incx,....,1+n*incx)</code>ï¼Œå‘é‡çš„å–æ ·é—´éš”</li>
  <li>SVD (singular value problems) å¥‡å¼‚å€¼</li>
  <li>p.s.d <code class="highlighter-rouge">PO</code> symmetric postive-define å¯¹ç§°æ­£å®šçŸ©é˜µ(s.p.d) A=A^T,ä»»æ„x!=0æœ‰ <code class="highlighter-rouge">x^T*A*x&gt;0</code>
  <br />   å¦‚é‡å çŸ©é˜µ:<code class="highlighter-rouge">x^TSx=&lt;x|x&gt; &gt;0</code></li>
</ul>

<h4 id="scalapack">ScaLapack</h4>

<ul>
  <li>M_A æ€»çŸ©é˜µA(M,N)çš„è¡Œ</li>
  <li>N_A æ€»çŸ©é˜µA(M,N)çš„åˆ—</li>
  <li>MB_A=4 !M block åˆ†å—çŸ©é˜µçš„è¡Œä¸ºMB</li>
  <li>NB_A=4 !N block           åˆ—  NB
<br /><img src="/uploads/2019/04/scalapack1.jpg" alt="" /></li>
  <li>RSRC_A=0 !çŸ©é˜µè¢«åˆ†å¼€åï¼Œè·å¾—ç¬¬ä¸€ä¸ªè¡Œåˆ†å—çš„node</li>
  <li>CSRC_A=0 !                        åˆ—</li>
  <li>LLD_A å±€åŸŸçŸ©é˜µçš„lld(Fortran:è¡Œæ•°)</li>
  <li>IA,JA  A(IA:IA+M-1,JA:JA+K-1), Fortran ä¸€èˆ¬ IA=JA=1</li>
  <li>LCM(least common multiple)æœ€å°å…¬å€æ•°</li>
  <li>lOCc å±€åŸŸçŸ©é˜µåˆ†åˆ°æ€»çŸ©é˜µçš„å‡ <strong>åˆ—</strong>ï¼Œä¸æ˜¯å‡ ä¸ªå—ï¼Œå¯ä»¥ç”¨æ¥åˆ†é…ç©ºé—´</li>
  <li>LOCr å±€åŸŸçŸ©é˜µåˆ†åˆ°æ€»çŸ©é˜µçš„å‡ <strong>è¡Œ</strong>ï¼Œä¸æ˜¯å‡ ä¸ªå—</li>
</ul>

<h6 id="locclocr"><code class="highlighter-rouge">LOCc</code>,<code class="highlighter-rouge">LOCr</code></h6>
<p>ç¤ºä¾‹</p>
<div class="language-fortran highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">  </span><span class="n">LWORK</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LOCr</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="nb">MOD</span><span class="p">(</span><span class="n">IA</span><span class="mi">-1</span><span class="p">,</span><span class="n">MB_A</span><span class="p">))</span><span class="o">*</span><span class="n">NB_A</span><span class="err">.</span><span class="w"> </span><span class="n">WORK</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">keep</span><span class="w"> </span><span class="err">...</span><span class="w">
  </span><span class="n">LIWORK</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LOCc</span><span class="p">(</span><span class="w"> </span><span class="n">N_A</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">MOD</span><span class="p">(</span><span class="n">JA</span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="n">NB_A</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">NB_A</span><span class="w"> </span><span class="err">...</span><span class="w">
</span></code></pre></div></div>
<p>å«ä¹‰</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The values of LOCr() and LOCc() may be determined via a call to the
ScaLAPACK tool function, NUMROC:
        LOCr( M ) = NUMROC( M, MB_A, MYROW, RSRC_A, NPROW ),
        LOCc( N ) = NUMROC( N, NB_A, MYCOL, CSRC_A, NPCOL ).
An upper bound for these quantities may be computed by:
        LOCr( M ) &lt;= ceil( ceil(M/MB_A)/NPROW )*MB_A
        LOCc( N ) &lt;= ceil( ceil(N/NB_A)/NPCOL )*NB_A
</code></pre></div></div>
<p>è°ƒç”¨</p>
<div class="language-fortran highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">    </span><span class="c1">!å£°æ˜å˜é‡æ—¶æ·»åŠ </span><span class="w">
    </span><span class="kt">INTEGER</span><span class="p">,</span><span class="w"> </span><span class="k">EXTERNAL</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">numroc</span><span class="w">
    
    </span><span class="c1">!ç›´æ¥è°ƒç”¨,ä¸éœ€è¦ScaLapackåˆå§‹åŒ–å°±å¯ä»¥è°ƒç”¨</span><span class="w">
    </span><span class="n">nn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numroc</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">rsrc</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w">
    </span><span class="c1">! NUMROC( N, NB, IPROC, ISRCPROC, NPROCS )</span><span class="w">
</span></code></pre></div></div>

<h2 id="åœ¨ä»£ç ä¸­è§£é‡Š">åœ¨ä»£ç ä¸­è§£é‡Š</h2>
<p>è¯»å…¥æ•°æ®ï¼Œæ•°æ®HåŸå­çš„scfä¸­ç”±äº”æ¡è½¨é“(NAOs)ä½œä¸ºåŸºç»„å¾—åˆ°çš„H,S: <a href="/web/file/2019/H.data">H.data</a> <a href="/web/file/2019/S.data">S.data</a></p>

<p>ä¸‹è½½ä»£ç <a href="/web/file/2019/main.f90">main.f90</a><br />
ç¼–è¯‘è¿è¡Œ</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(python27) cndaqiang@win10:~/code/TDAP/Fortran/scalapack/Lapack&gt; make
gfortran -c -g -O2 -ffree-line-length-none     main.f90
gfortran  -g -O2 -ffree-line-length-none  -o test main.o      /mnt/d/CODE/soft/OPENMPI_1.10.3-GCC-4.8.5-opensuse/scalapack/lib/libreflapack.a /mnt/d/CODE/soft/OPENMPI_1.10.3-GCC-4.8.5-opensuse/scalapack/lib/libtmg.a /mnt/d/CODE/soft/OPENMPI_1.10.3-GCC-4.8.5-opensuse/scalapack/lib/librefblas.a
./test
</code></pre></div></div>

<p>ä¸‹é¢ä»£ç å’Œæ–‡å­—äº¤å‰å‡ºç°ï¼Œçœ‹ä»£ç ç›´æ¥ä¸‹è½½<a href="/web/file/2019/main.f90">main.f90</a></p>

<p>åˆ›å»ºå˜é‡</p>
<div class="language-fortran highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">program</span><span class="w"> </span><span class="n">main</span><span class="err">.</span><span class="n">f90</span><span class="w">
    </span><span class="k">implicit</span><span class="w"> </span><span class="k">none</span><span class="w">
    </span><span class="kt">INTEGER</span><span class="p">,</span><span class="k">parameter</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">dp</span><span class="o">=</span><span class="mi">8</span><span class="w">
    </span><span class="kt">REAL</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span><span class="k">allocatable</span><span class="w">    </span><span class="p">::</span><span class="w">  </span><span class="n">H</span><span class="p">(:,:),</span><span class="n">S</span><span class="p">(:,:),</span><span class="n">C</span><span class="p">(:,:),</span><span class="n">E</span><span class="p">(:),</span><span class="n">B</span><span class="p">(:),</span><span class="n">A</span><span class="p">(:,:),</span><span class="n">X</span><span class="p">(:),</span><span class="n">Y</span><span class="p">(:),</span><span class="n">work</span><span class="p">(:),</span><span class="n">iwork</span><span class="p">(:),</span><span class="n">wr</span><span class="p">(:),</span><span class="n">wi</span><span class="p">(:),</span><span class="n">vs</span><span class="p">(:,:)</span><span class="w">
    </span><span class="kt">INTEGER</span><span class="p">,</span><span class="k">allocatable</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">ipiv</span><span class="p">(:)</span><span class="w">
    </span><span class="kt">INTEGER</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">INFO</span><span class="p">,</span><span class="n">NRHS</span><span class="p">,</span><span class="n">incx</span><span class="p">,</span><span class="n">lwork</span><span class="p">,</span><span class="n">liwork</span><span class="p">,</span><span class="n">sdim</span><span class="p">,</span><span class="n">ldvs</span><span class="w">
    </span><span class="kt">LOGICAL</span><span class="p">,</span><span class="k">allocatable</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="k">select</span><span class="p">(:,:),</span><span class="n">bwork</span><span class="p">(:)</span><span class="w">
    
    </span><span class="n">m</span><span class="o">=</span><span class="mi">5</span><span class="w">
    </span><span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="w">
    </span><span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="w">
    </span><span class="k">allocate</span><span class="p">(</span><span class="n">H</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="n">S</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">n</span><span class="p">),</span><span class="n">B</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="n">C</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="p">))</span><span class="w">
    </span><span class="n">H</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">reshape</span><span class="p">((/</span><span class="w">  </span><span class="mf">-0.42400401342556060</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">-0.40143227390650277</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">-6.9120337961858791E-006</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w">
</span><span class="p">&amp;</span><span class="w">                   </span><span class="mf">8.6134463450626697E-010</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">-6.9147694707777760E-006</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">-0.40143227390650238</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w">
</span><span class="p">&amp;</span><span class="w">                   </span><span class="mf">-0.29964623883643193</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">-8.9726936647882560E-006</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">4.9061116280668671E-010</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w">
</span><span class="p">&amp;</span><span class="w">                   </span><span class="mf">-8.9740202969982782E-006</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">-6.9120337962066958E-006</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">-8.9726936648298894E-006</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w">
</span><span class="p">&amp;</span><span class="w">                   </span><span class="mf">0.80413378049744566</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">-1.8838840210033680E-010</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">-3.8197224985613721E-007</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w">
</span><span class="p">&amp;</span><span class="w">                   </span><span class="mf">8.5924509174439834E-010</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">4.8774366490089704E-010</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">-1.8838840210033680E-010</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w">
</span><span class="p">&amp;</span><span class="w">                   </span><span class="mf">0.80417210170273057</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">1.5203947981790279E-011</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">-6.9147694707755170E-006</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w">
</span><span class="p">&amp;</span><span class="w">                   </span><span class="mf">-8.9740202969951222E-006</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">-3.8197224985613721E-007</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">1.5203950672231617E-011</span><span class="w"> </span><span class="p">,&amp;</span><span class="w">
</span><span class="p">&amp;</span><span class="w">                   </span><span class="mf">0.80413378335169927</span><span class="p">/),(/</span><span class="n">m</span><span class="p">,</span><span class="n">k</span><span class="p">/))</span><span class="w">
    </span><span class="n">S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">reshape</span><span class="p">(</span><span class="w"> </span><span class="p">(/</span><span class="mf">1.0000000107623999</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">0.95479507666315644</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">0.0000000000000000</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">5.3953328491069285E-013</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">0.0000000000000000</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">0.95479507666315644</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">0.99999999999886702</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">0.0000000000000000</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">6.3781864686742656E-013</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">0.0000000000000000</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">0.0000000000000000</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">0.0000000000000000</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">1.0000000364970107</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">0.0000000000000000</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">0.0000000000000000</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">-5.3953328491104808E-013</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">-6.3781864686711637E-013</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">0.0000000000000000</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">1.0000000364970068</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">0.0000000000000000</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">0.0000000000000000</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">0.0000000000000000</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">0.0000000000000000</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">0.0000000000000000</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w">
    </span><span class="p">&amp;</span><span class="w">               </span><span class="mf">1.0000000364970110</span><span class="p">/),(/</span><span class="n">k</span><span class="p">,</span><span class="n">n</span><span class="p">/))</span><span class="w">
   
    </span><span class="n">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">reshape</span><span class="p">(</span><span class="w"> </span><span class="p">(/</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">,</span><span class="mf">3.0</span><span class="p">,</span><span class="mf">4.0</span><span class="p">,</span><span class="mf">5.0</span><span class="p">/),(/</span><span class="mi">5</span><span class="p">/))</span><span class="w">
    </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">"H is ------------------"</span><span class="w">
    </span><span class="k">do</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="w">
        </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">"            "</span><span class="p">,</span><span class="n">H</span><span class="p">(</span><span class="n">i</span><span class="p">,:)</span><span class="w">
    </span><span class="k">enddo</span><span class="w">
    </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">"S is ------------------"</span><span class="w">
    </span><span class="k">do</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="w">
        </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">"            "</span><span class="p">,</span><span class="n">S</span><span class="p">(</span><span class="n">i</span><span class="p">,:)</span><span class="w">
    </span><span class="k">enddo</span><span class="w">
    </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">"B is ------------------"</span><span class="w">
    </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">B</span><span class="w"> 
</span></code></pre></div></div>

<h3 id="blasåŸºç¡€åŠŸèƒ½">BLASåŸºç¡€åŠŸèƒ½</h3>
<p>åŠŸèƒ½é€ŸæŸ¥<a href="http://homepage.ntu.edu.tw/~wttsai/fortran/BLAS_LAPACK/BLAS%20Quick%20Reference%20Guide.pdf">BLAS Quick Reference Guide</a>ï¼Œæˆ–å¦‚å›¾
<img src="/uploads/2019/08/blas.png" alt="" /></p>

<div class="language-fortran highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">!********************************</span><span class="w">
</span><span class="c1">!GEMV çŸ©é˜µå‘é‡ä¹˜</span><span class="w">
</span><span class="c1">!********************************</span><span class="w">
</span><span class="c1">!call dgemv(trans, m, n, alpha, a, lda, x, incx, beta, y, incy)</span><span class="w">
    </span><span class="k">allocate</span><span class="p">(</span><span class="n">X</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">),</span><span class="n">Y</span><span class="p">(</span><span class="n">n</span><span class="p">))</span><span class="w">
    </span><span class="n">X</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">n</span><span class="p">)</span><span class="o">=</span><span class="n">B</span><span class="w">
    </span><span class="n">X</span><span class="p">(</span><span class="n">n</span><span class="mi">+1</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">)</span><span class="o">=</span><span class="n">B</span><span class="w">
    </span><span class="n">Y</span><span class="o">=</span><span class="mi">0</span><span class="w">
    </span><span class="n">incx</span><span class="o">=</span><span class="mi">1</span><span class="w">
    </span><span class="k">call</span><span class="w"> </span><span class="n">dgemv</span><span class="p">(</span><span class="s1">'N'</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="mf">1.0_dp</span><span class="p">,</span><span class="n">H</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">incx</span><span class="p">,</span><span class="mf">1.0_dp</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w">
    </span><span class="c1">!X(incx,incx+n-1)</span><span class="w">
    </span><span class="c1">!Y(incy,incy+m-1)</span><span class="w">
    </span><span class="c1">!incx å‘é‡çš„åˆå§‹å…ƒç´ </span><span class="w">
    </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">"H*B is --------------------"</span><span class="w">
    </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">Y</span><span class="w">
    </span><span class="k">deallocate</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">)</span><span class="w">
</span><span class="c1">!********************************</span><span class="w">
</span><span class="c1">!SYMV å¯¹ç§°çŸ©é˜µ*å‘é‡</span><span class="w">
</span><span class="c1">!********************************</span><span class="w">
</span><span class="c1">!é’ˆå¯¹Aæ˜¯ç‰¹æ®Šçš„å¯¹ç§°çŸ©é˜µæ—¶</span><span class="w">
</span><span class="c1">!å‚æ•°å’ŒGESVä¸åŒ</span><span class="w">
</span><span class="c1">!call dsymv(uplo, n, alpha, a, lda, x, incx, beta, y, incy)</span><span class="w">
</span><span class="c1">!y := alpha*A*x + beta*y,</span><span class="w">
</span><span class="c1">!uplo </span><span class="w">
</span><span class="c1">!   If uplo = 'U' or 'u', then the upper triangular part of the array a is used.</span><span class="w">
</span><span class="c1">!   If uplo = 'L' or 'l', then the low triangular part of the array a is used.</span><span class="w">
</span><span class="c1">!https://scc.ustc.edu.cn/zlsc/tc4600/intel/2017.0.098/mkl/common/mklman_f/index.htm#GUID-2EB693ED-69F3-48C7-B100-31F030797DDD.htm</span><span class="w">

    </span><span class="k">allocate</span><span class="p">(</span><span class="n">X</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">),</span><span class="n">Y</span><span class="p">(</span><span class="n">n</span><span class="p">))</span><span class="w">
    </span><span class="n">X</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">n</span><span class="p">)</span><span class="o">=</span><span class="n">B</span><span class="w">
    </span><span class="n">X</span><span class="p">(</span><span class="n">n</span><span class="mi">+1</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">)</span><span class="o">=</span><span class="n">B</span><span class="w">
    </span><span class="n">incx</span><span class="o">=</span><span class="mi">2</span><span class="w">
    </span><span class="c1">!X(1,1+incx,1+2*incx,....,1+n*incx)`,å‘é‡çš„å–æ ·é—´éš”</span><span class="w">
    </span><span class="k">call</span><span class="w"> </span><span class="n">dsymv</span><span class="p">(</span><span class="s1">'U'</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="mf">1.0_dp</span><span class="p">,</span><span class="n">H</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">incx</span><span class="p">,</span><span class="mf">0.0_dp</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w">
    </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">"H*[B,B](1:2:2n) symv is --------------"</span><span class="w">
    </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">Y</span><span class="w">
    </span><span class="k">deallocate</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">)</span><span class="w">

</span><span class="c1">!********************************</span><span class="w">
</span><span class="c1">!GEMM çŸ©é˜µä¹˜</span><span class="w">
</span><span class="c1">!********************************</span><span class="w">
</span><span class="c1">!DGEMM</span><span class="w">
</span><span class="c1">!D:double precision</span><span class="w">
</span><span class="c1">!GE:general matrix</span><span class="w">
</span><span class="c1">!MM:matrix-matrix</span><span class="w">
    </span><span class="k">call</span><span class="w"> </span><span class="n">DGEMM</span><span class="p">(</span><span class="s1">'N'</span><span class="p">,</span><span class="s1">'N'</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mf">1.0_dp</span><span class="p">,</span><span class="n">H</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mf">0.0_dp</span><span class="p">,</span><span class="n">C</span><span class="p">,</span><span class="n">m</span><span class="p">)</span><span class="w">
    </span><span class="c1">!C=alpha*OP(H)*OP(S)+beta*C</span><span class="w">
    </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">"*********DGEMM***********"</span><span class="w">
    </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">"H*S is ------------------"</span><span class="w">
    </span><span class="k">do</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="w">
        </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">"            "</span><span class="p">,</span><span class="n">C</span><span class="p">(</span><span class="n">i</span><span class="p">,:)</span><span class="w">
    </span><span class="k">enddo</span><span class="w">

</span></code></pre></div></div>
<p><img src="/uploads/2019/08/gemm.jpg" alt="" /></p>

<h3 id="driver-routines">Driver Routines</h3>
<p>åŠŸèƒ½é€ŸæŸ¥<a href="http://homepage.ntu.edu.tw/~wttsai/fortran/BLAS_LAPACK/LAPACK%20Quick%20Reference%20Guide.pdf">LAPACK Quick Reference Guide</a></p>

<p>Driver Routines ä½¿ç”¨æ¥è§£ç»ç‰¹å®šé—®é¢˜(å¦‚HC=SCE)çš„ç¨‹åº</p>

<p>Computational Routines å®Œæˆç‰¹å®šçš„è®¡ç®—ä»»åŠ¡æ¯”å¦‚LUåˆ†è§£</p>

<p>å¯ä»¥ç†è§£Driver Routinesè°ƒç”¨Computational Routineså®Œæˆç‰¹å®šé—®é¢˜</p>

<h4 id="çº¿æ€§æ–¹ç¨‹ç»„--axb">çº¿æ€§æ–¹ç¨‹ç»„ | AX=B</h4>
<p>$ AX=B $ çº¿æ€§é—®é¢˜,Bå¯ä¸ºçŸ©é˜µæˆ–å‘é‡</p>

<ul>
  <li><code class="highlighter-rouge">-SV  </code> simple,LUåˆ†è§£æ±‚è§£,Bæ˜¯æ ‡é‡</li>
  <li><code class="highlighter-rouge">-SVX </code> expert,LUåˆ†è§£ï¼Œæ¯”-SVæä¾›æ›´å¤šçš„åŠŸèƒ½ï¼Œæ¯”å¦‚è¯¯å·®åˆ†æç­‰</li>
  <li><code class="highlighter-rouge">-SM </code> Bæ˜¯çŸ¢é‡</li>
  <li><code class="highlighter-rouge">-TRSM</code> B(m,n) Solves a triangular matrix equation.</li>
  <li><code class="highlighter-rouge">-TRSVB(m)</code> Solves a system of linear equations whose coefficients are in a triangular matrix.</li>
  <li>ç­‰</li>
</ul>

<div class="language-fortran highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">    </span><span class="k">allocate</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">m</span><span class="p">),</span><span class="n">X</span><span class="p">(</span><span class="n">m</span><span class="p">),</span><span class="n">ipiv</span><span class="p">(</span><span class="n">m</span><span class="p">))</span><span class="w">
    </span><span class="n">A</span><span class="o">=</span><span class="n">H</span><span class="w">
    </span><span class="n">X</span><span class="o">=</span><span class="n">B</span><span class="w">
    </span><span class="n">NRHS</span><span class="o">=</span><span class="mi">1</span><span class="w">
    </span><span class="k">call</span><span class="w"> </span><span class="n">DGESV</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">NRHS</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">ipiv</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">INFO</span><span class="p">)</span><span class="w">
    </span><span class="c1">!Hx=X,ç»“æœä¿å­˜åˆ°Xä¸­ï¼Œ</span><span class="w">
    </span><span class="c1">!A LUåˆ†è§£åä¿å­˜åˆ°Aä¸­</span><span class="w">
    </span><span class="c1">!     Açš„ä¸Šä¸‰è§’æ˜¯U</span><span class="w">
    </span><span class="c1">!     Açš„ä¸‹ä¸‰è§’(ä¸åŒ…æ‹¬å¯¹è§’çº¿)æ˜¯L</span><span class="w">
    </span><span class="c1">!     MATLAB  [l,u,p]=lu(H)</span><span class="w">
    </span><span class="c1">!m: A(m,m)</span><span class="w">
    </span><span class="c1">!NRHS=1: Xæ˜¯ä¸€ç»´çš„,è‹¥ä¸ºAX=C(m,:)æ—¶ï¼ŒNRHS=m</span><span class="w">
    </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">"H LU is ------------------"</span><span class="w">
    </span><span class="k">do</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="w">
        </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">"            "</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="n">i</span><span class="p">,:)</span><span class="w">
    </span><span class="k">enddo</span><span class="w">
    </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">"root of HX=B(-GESV) is ----------"</span><span class="w">
    </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">X</span><span class="w">
    
    </span><span class="n">A</span><span class="o">=</span><span class="n">H</span><span class="w">
    </span><span class="n">X</span><span class="o">=</span><span class="n">B</span><span class="w">
    </span><span class="n">NRHS</span><span class="o">=</span><span class="mi">1</span><span class="w">
    </span><span class="n">lwork</span><span class="o">=</span><span class="mi">1</span><span class="c1">!INTEGER. The size of the work array; lwork â‰¥ 1.</span><span class="w">
    </span><span class="k">allocate</span><span class="p">(</span><span class="n">work</span><span class="p">(</span><span class="n">lwork</span><span class="p">))</span><span class="c1">!work is a workspace array, dimension at least max(1,lwork).</span><span class="w">
    </span><span class="c1">!call dsysv( uplo, n, nrhs, a, lda, ipiv, b, ldb, work, lwork, info )</span><span class="w">
    </span><span class="k">call</span><span class="w"> </span><span class="n">DSYSV</span><span class="p">(</span><span class="s1">'U'</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">NRHS</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">ipiv</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">work</span><span class="p">,</span><span class="n">lwork</span><span class="p">,</span><span class="n">INFO</span><span class="p">)</span><span class="w">
    </span><span class="k">deallocate</span><span class="p">(</span><span class="n">work</span><span class="p">)</span><span class="w">
    </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">"root of HX=B(-SYSV) is ----------"</span><span class="w">
    </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">X</span><span class="w">

    </span><span class="n">A</span><span class="o">=</span><span class="n">H</span><span class="w">
    </span><span class="n">C</span><span class="o">=</span><span class="n">S</span><span class="w">
    </span><span class="n">NRHS</span><span class="o">=</span><span class="n">m</span><span class="w">
    </span><span class="k">call</span><span class="w"> </span><span class="n">DGESV</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">NRHS</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">ipiv</span><span class="p">,</span><span class="n">C</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">INFO</span><span class="p">)</span><span class="w">
    </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">"root of HX=C is ----------"</span><span class="w">
    </span><span class="k">do</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="w">
        </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">"            "</span><span class="p">,</span><span class="n">C</span><span class="p">(</span><span class="n">i</span><span class="p">,:)</span><span class="w">
    </span><span class="k">enddo</span><span class="w">
    </span><span class="k">deallocate</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">ipiv</span><span class="p">)</span><span class="w">    
    
</span></code></pre></div></div>

<p><img src="/uploads/2019/08/gesv.jpg" alt="" /></p>

<h4 id="æœ€å°äºŒä¹˜é—®é¢˜--llslinear-leqat-squares-problems">æœ€å°äºŒä¹˜é—®é¢˜ | LLS(Linear Leqat squares problems)</h4>
<p>$ ||Ax-b||_2 $</p>

<p>æ‰¾åˆ°Xä½¿å¾— $ ||Ax-b||_2 $ æœ€å°</p>
<ul>
  <li><code class="highlighter-rouge">-LS </code> ä½¿ç”¨LUæˆ–QRåˆ†è§£è®¡ç®—</li>
  <li><code class="highlighter-rouge">-LSX</code></li>
  <li><code class="highlighter-rouge">-LSS</code>  SVDå¥‡å¼‚å€¼åˆ†è§£</li>
  <li>ç­‰</li>
</ul>

<p>QRåˆ†è§£ è®¾ A(m,n). åˆ™å­˜åœ¨ä¸€ä¸ªå•ä½åˆ—æ­£äº¤çŸ©é˜µ Q(M,n) (å³ Qâˆ—Q = I ) å’Œä¸€ä¸ªä¸Šä¸‰è§’çŸ©é˜µ R âˆˆCnÃ—n, ä½¿å¾—A=Q*R</p>

<div class="language-fortran highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">!call dgels(trans, m, n, nrhs, a, lda, b, ldb, work, lwork, info)</span><span class="w">
    </span><span class="k">allocate</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="p">),</span><span class="n">X</span><span class="p">(</span><span class="n">n</span><span class="p">))</span><span class="w">
    </span><span class="n">A</span><span class="o">=</span><span class="n">H</span><span class="w">
    </span><span class="n">X</span><span class="o">=</span><span class="n">B</span><span class="w">
    </span><span class="n">NRHS</span><span class="o">=</span><span class="mi">1</span><span class="w">
    </span><span class="n">lwork</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">NRHS</span><span class="p">)</span><span class="w"> </span><span class="c1">!The size of the work array; must be at least min (m, n)+max(1, m, n, nrhs).</span><span class="w">
    </span><span class="k">allocate</span><span class="p">(</span><span class="n">work</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">lwork</span><span class="p">)))</span><span class="w">
    </span><span class="k">call</span><span class="w"> </span><span class="n">DGELS</span><span class="p">(</span><span class="s1">'N'</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">NRHS</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">work</span><span class="p">,</span><span class="n">lwork</span><span class="p">,</span><span class="n">INFO</span><span class="p">)</span><span class="w">
    </span><span class="c1">!è¿”å›å€¼Aä¸MATLAB X=qr(H)è¿”å›å€¼ä¸€æ ·</span><span class="w">
    </span><span class="c1">!Açš„å³ä¸Šè§’ä¸[Q,R]=qr(H)ä¸­çš„Rä¸€æ ·,æš‚æ—¶ä¸çŸ¥é“QRåˆ†è§£çš„ä¸‹çŸ©é˜µæ˜¯ä»€ä¹ˆ</span><span class="w">
    </span><span class="k">deallocate</span><span class="p">(</span><span class="n">work</span><span class="p">)</span><span class="w">
    </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">"H QR is ------------------"</span><span class="w">
    </span><span class="k">do</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="w">
        </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">"            "</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="n">i</span><span class="p">,:)</span><span class="w">
    </span><span class="k">enddo</span><span class="w">    
    </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">"min(||AH-B||2), when X is (-GELS)"</span><span class="w">
    </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">X</span><span class="w">
    </span><span class="k">deallocate</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">X</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h4 id="æ ‡å‡†æœ¬å¾å€¼é—®é¢˜axex">æ ‡å‡†æœ¬å¾å€¼é—®é¢˜AX=EX</h4>
<h5 id="å¯¹ç§°æœ¬å¾å€¼é—®é¢˜sepsymmetric-eigenproblems">å¯¹ç§°æœ¬å¾å€¼é—®é¢˜|SEP(Symmetric eigenproblems)</h5>
<p>$ Ax=Ex $ 
$ A=A^T(real) $   $ A=A^H(complex) $</p>

<ul>
  <li><code class="highlighter-rouge">-SYEV </code> simple,L U åˆ†è§£</li>
  <li><code class="highlighter-rouge">-SYEVX</code>  expert,æ¯”-EVæä¾›æ›´å¤šçš„åŠŸèƒ½ï¼Œæ¯”å¦‚è¯¯å·®åˆ†æç­‰</li>
  <li><code class="highlighter-rouge">-SYEVD</code>  ä¸åŒçš„ç®—æ³•è€Œå·²;æ ¹æ®æµ‹è¯•EVRæœ€å¿«,EVDæ¬¡ä¹‹,SIESTAé‡‡ç”¨çš„EVD</li>
  <li><code class="highlighter-rouge">-SYEVR</code>  ä¸åŒçš„ç®—æ³•è€Œå·²;æµ‹è¯•<a href="https://www.netlib.org/lapack/lug/node71.html">LAPACK Benchmark</a></li>
  <li><code class="highlighter-rouge">-SYEVX</code>  ä¸åŒçš„ç®—æ³•è€Œå·²;å¦‚å›¾
<br /><img src="/uploads/2019/08/img255.gif" alt="Figure 3.2: Timings of driver routines for computing all eigenvalues and eigenvectors of a dense symmetric matrix. The upper graph shows times in seconds on an IBM Power3. The lower graph shows times relative to the fastest routine DSYEVR, which appears as a horizontal line at 1." /></li>
</ul>

<div class="language-fortran highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">!call dsyev(jobz, uplo, n, a, lda, w, work, lwork, info)</span><span class="w">
</span><span class="c1">!jobz = 'N', then only eigenvalues are computed.</span><span class="w">
</span><span class="c1">!jobz = 'V', then eigenvalues and eigenvectors are computed.</span><span class="w">
</span><span class="c1">!uplo="U" or "L", åˆ†è§£å­˜å‚¨Açš„æ–¹å¼</span><span class="w">
</span><span class="c1">!work is a workspace array, its dimension max(1, lwork).    </span><span class="w">
</span><span class="c1">!lwork â‰¥ max(1, 3n-1).</span><span class="w">
</span><span class="c1">!wæœ¬å¾å€¼Array, size at least max(1, n)</span><span class="w">
</span><span class="c1">!è‹¥jobz='V',Aå­˜å‚¨æœ¬å¾çŸ¢é‡,ä¸€åˆ—æ˜¯ä¸€ä¸ªæœ¬å¾çŸ¢,A(i,:)çš„æœ¬å¾å€¼ä¸ºw(i)</span><span class="w">
</span><span class="c1">!è‹¥jobz='N',Aå­˜å‚¨Açš„L/U(uplo='L'/'U')ä¼šè¢«ç”¨äºè®¡ç®—ï¼Œå¹¶æ— æ„ä¹‰ï¼Œä¸æ˜¯LUåˆ†è§£</span><span class="w">
</span><span class="c1">!MATLABä¸­lu(H),[l,u]=lu(H),[l,u,p]=lu(H)çš„ç»“æœä¸ä¸€æ ·</span><span class="w">
    </span><span class="k">allocate</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">),</span><span class="n">E</span><span class="p">(</span><span class="n">n</span><span class="p">))</span><span class="w">
    </span><span class="n">A</span><span class="o">=</span><span class="n">H</span><span class="w">
    </span><span class="n">E</span><span class="o">=</span><span class="mi">0</span><span class="w">
    </span><span class="n">lwork</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="o">*</span><span class="n">n</span><span class="mi">-1</span><span class="p">)</span><span class="w">
    </span><span class="k">allocate</span><span class="p">(</span><span class="n">work</span><span class="p">(</span><span class="n">lwork</span><span class="p">))</span><span class="w">
    </span><span class="k">call</span><span class="w"> </span><span class="n">DSYEV</span><span class="p">(</span><span class="s1">'V'</span><span class="p">,</span><span class="s1">'U'</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">E</span><span class="p">,</span><span class="n">work</span><span class="p">,</span><span class="n">lwork</span><span class="p">,</span><span class="n">INFO</span><span class="p">)</span><span class="w">
    </span><span class="k">deallocate</span><span class="p">(</span><span class="n">work</span><span class="p">)</span><span class="w">
    </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">"HX=wX; w is ------------------"</span><span class="w">
    </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">E</span><span class="w">
    </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">"HX=wX; vectors is ------------------"</span><span class="w">
    </span><span class="k">do</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="w">
        </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">"            "</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="n">i</span><span class="p">,:)</span><span class="w">
    </span><span class="k">enddo</span><span class="w">
    </span><span class="c1">!H=U*U^T;U*U^T*X=EX</span><span class="w">
    </span><span class="c1">!C=U^T*U;Cy=Ey, y=U^T*X</span><span class="w">
    </span><span class="k">deallocate</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">E</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h5 id="éå¯¹ç§°æœ¬å¾å€¼é—®é¢˜nepnonsymmetric-eigenproblems">éå¯¹ç§°æœ¬å¾å€¼é—®é¢˜|NEP(Nonsymmetric eigenproblems)</h5>
<p>$ Ax=Ex $ $ A=QTQ^T(real) $  $  A=QTQ^H(complex) $
<br />Qå¹ºæ­£çŸ©é˜µ,Tä¸Šä¸‰è§’çŸ©é˜µ</p>

<ul>
  <li><code class="highlighter-rouge">-GEES </code> simple Schurå› å­</li>
  <li><code class="highlighter-rouge">-GEESX</code>  expert,æ¯”-GEESæä¾›æ›´å¤šçš„åŠŸèƒ½ï¼Œæ¯”å¦‚è¯¯å·®åˆ†æç­‰</li>
  <li><code class="highlighter-rouge">-GEEV </code> æœ¬å¾å€¼æœ¬å¾çŸ¢</li>
  <li><code class="highlighter-rouge">-GEEVX</code>  expert</li>
  <li>ç­‰</li>
</ul>

<p>ç¨‹åºé‡åˆ°é—®é¢˜ï¼Œå…ˆæç½®</p>

<h5 id="å¥‡å¼‚å€¼é—®é¢˜svdsingular-value-decomposion">å¥‡å¼‚å€¼é—®é¢˜|SVD(Singular value decomposion)</h5>

<p>æš‚æ—¶è¿˜ä¸æ‡‚</p>
<ul>
  <li><code class="highlighter-rouge">-GESVD</code></li>
</ul>

<h4 id="å¹¿ä¹‰çš„æœ¬å¾å€¼é—®é¢˜--generalized-eigenvalue-problems">å¹¿ä¹‰çš„æœ¬å¾å€¼é—®é¢˜ | Generalized eigenvalue problems</h4>
<h4 id="å¹¿ä¹‰å¯¹ç§°çš„æœ¬å¾å€¼é—®é¢˜gsep-generalized-symmetric-definite-eigenproblems">å¹¿ä¹‰å¯¹ç§°çš„æœ¬å¾å€¼é—®é¢˜|<strong>GSEP</strong> Generalized symmetric-definite eigenproblems</h4>

<p><script type="math/tex">AX=EBX</script>
<script type="math/tex">ABX=EX</script>
<script type="math/tex">BAX=EX</script></p>

<p>å…¶ä¸­A,Bæ˜¯å¯¹ç§°çš„æˆ–å“ˆå¯†é¡¿é‡ ï¼Œ <strong>Bæ˜¯æ­£å®šçš„</strong></p>

<ul>
  <li><code class="highlighter-rouge">-SYGV</code></li>
  <li><code class="highlighter-rouge">-HEGV</code></li>
  <li><code class="highlighter-rouge">-SPGV</code></li>
  <li><code class="highlighter-rouge">-HPGV</code></li>
</ul>

<div class="language-fortran highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">!call dsygv(itype, jobz, uplo, n, a, lda, b, ldb, w, work, lwork, info)</span><span class="w">
</span><span class="c1">!itype</span><span class="w">
</span><span class="c1">! itype = 1, the problem type is A*x = lambda*B*x;</span><span class="w">
</span><span class="c1">! itype = 2, the problem type is A*B*x = lambda*x;</span><span class="w">
</span><span class="c1">! itype = 3, the problem type is B*A*x = lambda*x.</span><span class="w">
</span><span class="c1">! jobz = 'N' or 'U'</span><span class="w">
</span><span class="c1">! Bè¾“å…¥çŸ©é˜µå’Œè¾“å‡ºæœ¬å¾çŸ¢é‡</span><span class="w">

    </span><span class="k">allocate</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">),</span><span class="n">E</span><span class="p">(</span><span class="n">n</span><span class="p">))</span><span class="w">
    </span><span class="n">A</span><span class="o">=</span><span class="n">H</span><span class="w">
    </span><span class="n">C</span><span class="o">=</span><span class="n">S</span><span class="w">
    </span><span class="n">E</span><span class="o">=</span><span class="mi">0</span><span class="w">
    </span><span class="n">lwork</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="o">*</span><span class="n">n</span><span class="mi">-1</span><span class="p">)</span><span class="w">
    </span><span class="k">allocate</span><span class="p">(</span><span class="n">work</span><span class="p">(</span><span class="n">lwork</span><span class="p">))</span><span class="w"> 
    </span><span class="k">call</span><span class="w"> </span><span class="n">DSYGV</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s1">'V'</span><span class="p">,</span><span class="s1">'U'</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">C</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">E</span><span class="p">,</span><span class="n">work</span><span class="p">,</span><span class="n">lwork</span><span class="p">,</span><span class="n">INFO</span><span class="p">)</span><span class="w">
    </span><span class="c1">!ç®—å®Œåï¼ŒAè¢«è¦†ç›–äº†ä¸€å †ä¸­é—´æ•°æ®</span><span class="w">
    </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">"HC=SCE; E is ------------------"</span><span class="w">    
    </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">E</span><span class="w">
    </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">"HC=SCE; C is ------------------"</span><span class="w">  
    </span><span class="k">do</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="w">
        </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">"            "</span><span class="p">,</span><span class="n">C</span><span class="p">(</span><span class="n">i</span><span class="p">,:)</span><span class="w">
    </span><span class="k">enddo</span><span class="w">   
    </span><span class="k">deallocate</span><span class="p">(</span><span class="n">work</span><span class="p">)</span><span class="w">
    </span><span class="k">deallocate</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">E</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h5 id="å¹¿ä¹‰éå¯¹ç§°çš„æœ¬å¾å€¼é—®é¢˜gnep-generalized-nonsymmetric--eigenproblems">å¹¿ä¹‰éå¯¹ç§°çš„æœ¬å¾å€¼é—®é¢˜|<strong>GNEP</strong> Generalized nonsymmetric  eigenproblems</h5>

<ul>
  <li><code class="highlighter-rouge">-GEES  </code></li>
  <li><code class="highlighter-rouge">-GEESX </code></li>
  <li><code class="highlighter-rouge">-GEEV  </code></li>
  <li><code class="highlighter-rouge">-GEEVX </code></li>
</ul>

<p>æš‚æ—¶æ‡’å¾—çœ‹äº†</p>

<h3 id="computational-routines">Computational Routines</h3>
<p>è‡ªå·±ç»„åˆComputational Routinesæ¥è§£å†³ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚åˆ†è§£ï¼Œå˜ä¸ºä¸‰è§’é˜µ
<br />é€šå¸¸çš„è¿‡ç¨‹,å…ˆåˆ†è§£(factorize -TRF)å†å¤„ç†,å¦‚æ±‚é€†(-TRI)ã€æ±‚GSEP(-SYGST)ç­‰
<br />é€šè¿‡è¿™äº›ç¨‹åºï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸€æ­¥æ­¥å®ç°åˆ†è§£(LU,chol,QRâ€¦),è§£å†³çº¿æ€§æ–¹ç¨‹,LLS,SVD,(å¹¿ä¹‰)æœ¬å¾å€¼é—®é¢˜
<br />ä¸‹é¢ä¸ºå‡ ä¸ªç¤ºä¾‹</p>

<h4 id="facrotizeåˆ†è§£-trf">Facrotizeåˆ†è§£(-TRF)</h4>
<p>ä¸åŒç±»å‹çš„çŸ©é˜µåˆ†è§£ç»“æœä¸åŒï¼Œå¦‚<a href="https://scc.ustc.edu.cn/zlsc/tc4600/intel/2017.0.098/mkl/common/mklman_f/index.htm#GUID-2EB693ED-69F3-48C7-B100-31F030797DDD.htm">Routines for Matrix Factorization</a></p>

<ul>
  <li>é€šå¸¸çš„çŸ©é˜µGEï¼šLUåˆ†è§£ <code class="highlighter-rouge">-GETRF</code> $ A=PLU $</li>
  <li>æ­£å®šå¯¹ç§°çŸ©é˜µPOï¼šCholesky åˆ†è§£ <code class="highlighter-rouge">-POTRF</code> $ A=U^TU $ or $ LL^T $</li>
  <li>å¯¹ç§°éæ­£å®šçŸ©é˜µSYï¼šç³»ç»Ÿéæ­£å®šåˆ†è§£  <code class="highlighter-rouge">-SYTRF</code> $ A=P^TU^TDUP $ or $ PLDL^TP^T $</li>
</ul>

<div class="language-fortran highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">!******</span><span class="w">
</span><span class="c1">!LUåˆ†è§£</span><span class="w">
</span><span class="c1">!******</span><span class="w">
</span><span class="c1">!call dgetrf( m, n, a, lda, ipiv, info )</span><span class="w">
</span><span class="c1">!è¿”å›å€¼A,ipivå¯ç”¨äºåç»­è®¡ç®—</span><span class="w">
    </span><span class="k">allocate</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="p">),</span><span class="n">E</span><span class="p">(</span><span class="n">n</span><span class="p">))</span><span class="w">
    </span><span class="n">A</span><span class="o">=</span><span class="n">H</span><span class="w">
    </span><span class="n">E</span><span class="o">=</span><span class="n">B</span><span class="w">
    </span><span class="k">allocate</span><span class="p">(</span><span class="n">ipiv</span><span class="p">(</span><span class="n">m</span><span class="p">))</span><span class="w">
    </span><span class="k">call</span><span class="w"> </span><span class="n">DGETRF</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">ipiv</span><span class="p">,</span><span class="n">INFO</span><span class="p">)</span><span class="w">
    </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">"lu(H) is ------------------"</span><span class="w">
    </span><span class="k">do</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="w">
        </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">"            "</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="n">i</span><span class="p">,:)</span><span class="w">
    </span><span class="k">enddo</span><span class="w">
</span><span class="c1">!LUåˆ†è§£æ±‚HX=Bç¤ºä¾‹    </span><span class="w">
</span><span class="c1">!call dgetrs( trans, n, nrhs, a, lda, ipiv, b, ldb, info )</span><span class="w">
</span><span class="c1">!Solves a system of linear equations with an LU-factored square coefficient matrix, with multiple right-hand sides.</span><span class="w">
</span><span class="c1">!ldbINTEGER. The leading dimension of b; ldb â‰¥ max(1, n)</span><span class="w">
</span><span class="c1">!**ipiv æ˜¯-GETRFçš„è¿”å›å€¼**</span><span class="w">
</span><span class="c1">!**Aä¹Ÿæ˜¯-GERTFçš„LUåˆ†è§£åçš„çŸ©é˜µ***</span><span class="w">
</span><span class="c1">!ipiv Array, size at least max(1, n). The ipiv array, as returned by ?getrf.</span><span class="w">
    </span><span class="k">call</span><span class="w"> </span><span class="n">DGETRS</span><span class="p">(</span><span class="s1">'N'</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">ipiv</span><span class="p">,</span><span class="n">E</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">INFO</span><span class="p">)</span><span class="w">
    </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">"use lu(H) to solve HX=B, X is "</span><span class="w">
    </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">E</span><span class="w">
</span><span class="c1">!è®¡ç®—ä¹‹åï¼Œä¸ä¼šæ”¹å˜Aå’Œipivçš„å€¼</span><span class="w">

</span><span class="c1">!LUåˆ†è§£æ±‚é€†A^-1ç¤ºä¾‹</span><span class="w">
</span><span class="c1">! invert using factorization</span><span class="w">
</span><span class="c1">!call dgetri( n, a, lda, ipiv, work, lwork, info )</span><span class="w">
    </span><span class="n">lwork</span><span class="o">=</span><span class="n">n</span><span class="w">
    </span><span class="k">allocate</span><span class="p">(</span><span class="n">work</span><span class="p">(</span><span class="n">lwork</span><span class="p">))</span><span class="w">
    </span><span class="k">call</span><span class="w"> </span><span class="n">DGETRI</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">ipiv</span><span class="p">,</span><span class="n">work</span><span class="p">,</span><span class="n">lwork</span><span class="p">,</span><span class="n">INFO</span><span class="p">)</span><span class="w">
    </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">"use lu(H) to get H^-1:"</span><span class="w">
    </span><span class="k">do</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="w">
        </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">"            "</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="n">i</span><span class="p">,:)</span><span class="w">
    </span><span class="k">enddo</span><span class="w">      
    </span><span class="k">deallocate</span><span class="p">(</span><span class="n">work</span><span class="p">)</span><span class="w">    
    </span><span class="k">deallocate</span><span class="p">(</span><span class="n">ipiv</span><span class="p">)</span><span class="w">
    </span><span class="k">deallocate</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">E</span><span class="p">)</span><span class="w">

</span><span class="c1">!**********************    </span><span class="w">
</span><span class="c1">!Cholesky factorization</span><span class="w">
</span><span class="c1">!**********************  </span><span class="w">
</span><span class="c1">!call dpotrf( uplo, n, a, lda, info ) </span><span class="w">
    </span><span class="k">allocate</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="p">),</span><span class="n">E</span><span class="p">(</span><span class="n">n</span><span class="p">))</span><span class="w">
    </span><span class="n">A</span><span class="o">=</span><span class="n">H</span><span class="w">
    </span><span class="n">C</span><span class="o">=</span><span class="n">S</span><span class="w">
    </span><span class="n">E</span><span class="o">=</span><span class="n">B</span><span class="w">
    </span><span class="k">call</span><span class="w"> </span><span class="n">DPOTRF</span><span class="p">(</span><span class="s1">'U'</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">C</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">INFO</span><span class="p">)</span><span class="w">
    </span><span class="c1">!ä¸Šéƒ¨åˆ†å˜ä¸ºU,ä¸‹ä¸‰è§’éƒ¨åˆ†ä¸å˜</span><span class="w">
    </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">"chol(S) is: -----------"</span><span class="w">
    </span><span class="k">do</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="w">
        </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">"            "</span><span class="p">,</span><span class="n">C</span><span class="p">(</span><span class="n">i</span><span class="p">,:)</span><span class="w">
    </span><span class="k">enddo</span><span class="w">
</span><span class="c1">!cholåˆ†è§£æ±‚HX=Bç¤ºä¾‹    </span><span class="w">
</span><span class="c1">!call dpotrs( uplo, n, nrhs, a, lda, b, ldb, info )</span><span class="w">
    </span><span class="k">call</span><span class="w"> </span><span class="n">DPOTRS</span><span class="p">(</span><span class="s1">'U'</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">C</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">E</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">INFO</span><span class="p">)</span><span class="w">
    </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">"use chol(S) to solve SX=B, X is "</span><span class="w">
    </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">E</span><span class="w">    
</span><span class="c1">!cholåˆ†è§£æ±‚é€†A^-1ç¤ºä¾‹</span><span class="w">
</span><span class="c1">!call dpotri( uplo, n, a, lda, info )  </span><span class="w">
    </span><span class="k">call</span><span class="w"> </span><span class="n">DPOTRI</span><span class="p">(</span><span class="s1">'U'</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">C</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">INFO</span><span class="p">)</span><span class="w">
    </span><span class="c1">!ç»“æœinv(C)ä¹Ÿæ˜¯å¯¹ç§°çš„ï¼Œæ‰€ä»¥ï¼ŒCçš„ä¸Šä¸‰è§’çŸ©é˜µæ˜¯é€†ï¼Œä¸‹ä¸‰è§’ä¾æ—§æ²¡å˜</span><span class="w">
    </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">"use chol(S) to get S^-1:"</span><span class="w">
    </span><span class="k">do</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="w">
        </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">"            "</span><span class="p">,</span><span class="n">C</span><span class="p">(</span><span class="n">i</span><span class="p">,:)</span><span class="w">
    </span><span class="k">enddo</span><span class="w">   
</span><span class="c1">!cholåˆ†è§£æ±‚å¹¿ä¹‰æœ¬å¾å€¼HC=SCEç¤ºä¾‹</span><span class="w">


    </span><span class="n">A</span><span class="o">=</span><span class="n">H</span><span class="w">
    </span><span class="n">C</span><span class="o">=</span><span class="n">S</span><span class="w">
    </span><span class="n">E</span><span class="o">=</span><span class="mf">0.0_dp</span><span class="w">
    </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">"use chol(S) to solve HC=SCE"</span><span class="w">
    </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">"    HC=SCE(-POTRF): 1. S=U^T*U,y=UC"</span><span class="w">
</span><span class="c1">!***</span><span class="w">
    </span><span class="k">call</span><span class="w"> </span><span class="n">DPOTRF</span><span class="p">(</span><span class="s1">'U'</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">C</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">INFO</span><span class="p">)</span><span class="w">
    </span><span class="c1">!C=U*U^T,ä»…æ”¹å˜Cçš„ä¸Šä¸‰è§’</span><span class="w">
</span><span class="c1">!***</span><span class="w">
    </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">"    HC=SCE(-SYGST): 2. tmpC=inv(U^-T)*H*inv(U)"</span><span class="w">
</span><span class="c1">!call dsygst(itype, uplo, n, a, lda, b, ldb, info)</span><span class="w">
</span><span class="c1">!The routine reduces real symmetric-definite generalized eigenproblems</span><span class="w">
</span><span class="c1">!A*z = Î»*B*z, A*B*z = Î»*z, or B*A*z = Î»*z</span><span class="w">
</span><span class="c1">!itype=1,     2,              3</span><span class="w">
</span><span class="c1">!to the standard form C*y = Î»*y. </span><span class="w">
</span><span class="c1">!Here A is a real symmetric matrix, </span><span class="w">
</span><span class="c1">!and B is a real symmetric positive-definite matrix. </span><span class="w">
</span><span class="c1">!Before calling this routine, call ?potrf to compute the Cholesky factorization: B = UT*U or B = L*LT.</span><span class="w">
    </span><span class="k">call</span><span class="w"> </span><span class="n">DSYGST</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s1">'U'</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">C</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">INFO</span><span class="p">)</span><span class="w">
    </span><span class="c1">!A=inv(U^T)*A*inv(U)ï¼Œä»…æ”¹å˜Açš„ä¸Šä¸‰è§’</span><span class="w">
</span><span class="c1">!***</span><span class="w">
    </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">"    HC=SCE(-SYEV?): 3. tmpCy=Ey(æœ¬å¾å€¼é—®é¢˜)"</span><span class="w">
</span><span class="c1">!call dsyevd(jobz, uplo, n, a, lda, w, work, lwork, iwork, liwork, info)</span><span class="w">
    </span><span class="n">lwork</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">*</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">6</span><span class="o">*</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w">
    </span><span class="k">allocate</span><span class="p">(</span><span class="n">work</span><span class="p">(</span><span class="n">lwork</span><span class="p">))</span><span class="w">
    </span><span class="n">liwork</span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="o">*</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">3</span><span class="w">
    </span><span class="k">allocate</span><span class="p">(</span><span class="n">iwork</span><span class="p">(</span><span class="n">liwork</span><span class="p">))</span><span class="w">
    </span><span class="k">call</span><span class="w"> </span><span class="n">DSYEVD</span><span class="p">(</span><span class="s1">'V'</span><span class="p">,</span><span class="s1">'U'</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">E</span><span class="p">,</span><span class="n">work</span><span class="p">,</span><span class="n">lwork</span><span class="p">,</span><span class="n">iwork</span><span class="p">,</span><span class="n">liwork</span><span class="p">,</span><span class="n">INFO</span><span class="p">)</span><span class="w">
    </span><span class="c1">!yä¿å­˜åˆ°Aä¸­äº†</span><span class="w">
    </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">"    HC=SCE(-SYEV?):    E is:"</span><span class="w">
    </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">"            "</span><span class="p">,</span><span class="w"> </span><span class="n">E</span><span class="w">
</span><span class="c1">!***</span><span class="w">
    </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">"    HC=SCE(-SYEV?): 4. y=UC,(çº¿æ€§æ–¹ç¨‹é—®é¢˜)"</span><span class="w">
    </span><span class="c1">!å¯é€‰æ–¹æ¡ˆå¾ˆå¤šï¼Œ</span><span class="w">
    </span><span class="c1">!a. inv(U)*y</span><span class="w">
    </span><span class="c1">!å› ä¸ºUå·²ç»ä¸Šä¸‰è§’äº†</span><span class="w">
    </span><span class="c1">!b. Dirver routinesè§£æ–¹ç¨‹  -TRSM(B(m,n), -TRSV(B(n)) </span><span class="w">
    </span><span class="c1">!c. Computational routines  -TRTRS    </span><span class="w">
</span><span class="c1">!call dtrsm(side, uplo, transa, diag, m, n, alpha, a, lda, b, ldb) B=AX</span><span class="w">
</span><span class="c1">!call dtrtrs( uplo, trans, diag, n, nrhs, a, lda, b, ldb, info )</span><span class="w">
</span><span class="c1">!AX=Bç»“æœè¾“å‡ºåˆ°B</span><span class="w">
</span><span class="c1">![Fortranä½¿ç”¨Scalapackæ±‚è§£HC=SCE](/2019/08/04/HC_SCE)æ­¤æ–‡é‡‡ç”¨çš„TRSM</span><span class="w">
</span><span class="c1">!æ­¤å¤„é‡‡ç”¨TRTRS</span><span class="w">
    </span><span class="k">call</span><span class="w"> </span><span class="n">DTRTRS</span><span class="p">(</span><span class="s1">'U'</span><span class="p">,</span><span class="s1">'N'</span><span class="p">,</span><span class="s1">'N'</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">C</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">INFO</span><span class="p">)</span><span class="w">
    </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">"    HC=SCE(-TRTRS):    C is:"</span><span class="w">
    </span><span class="k">do</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="w">
        </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">"            "</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="n">i</span><span class="p">,:)</span><span class="w">
    </span><span class="k">enddo</span><span class="w">   
    </span><span class="k">deallocate</span><span class="p">(</span><span class="n">work</span><span class="p">,</span><span class="n">iwork</span><span class="p">)</span><span class="w">
    </span><span class="c1">!é‡Šæ”¾å†…å­˜ç»“æŸç¨‹åº</span><span class="w">
    </span><span class="k">deallocate</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">C</span><span class="p">)</span><span class="w">
</span><span class="k">end</span><span class="w"> </span><span class="k">program</span><span class="w">    
</span></code></pre></div></div>

<p>é™¤äº†ä¸Šè¿°ä¹‹å¤–ï¼Œè¿˜æœ‰å¾ˆå¤šçš„computational routines
<br />å…ˆè¿™æ ·å§,è¡¥å……ç›¸å…³çŸ¥è¯†åå†å›æ¥è¡¥å……</p>

<h3 id="scalapackæœ‰ä¸lapackç›¸åŒçš„å‡½æ•°">Scalapackæœ‰ä¸Lapackç›¸åŒçš„å‡½æ•°</h3>
<p>ç¤ºä¾‹:<br />
æ±‚è§£HC=SCEé—®é¢˜: <a href="/2019/08/04/HC_SCE">Fortranä½¿ç”¨Scalapackæ±‚è§£HC=SCE</a><br /></p>
<h4 id="luåˆ†è§£æ±‚é€†">LUåˆ†è§£æ±‚é€†</h4>
<h5 id="åŸç†">åŸç†</h5>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>A=L*U
inv(A)*L*U=E
inv(A)*L=inv(U)
æ±‚è§£çº¿æ€§æ–¹ç¨‹ç»„å¾—åˆ°inv(A)
</code></pre></div></div>

<h5 id="luåˆ†è§£pgetrf">LUåˆ†è§£<code class="highlighter-rouge">p?getrf</code></h5>
<p><img src="/uploads/2019/08/LU.jpg" alt="" /></p>
<h5 id="æ±‚é€†pgetri">æ±‚é€†<code class="highlighter-rouge">p?getri</code></h5>
<blockquote>
  <p><a href="https://scc.ustc.edu.cn/zlsc/tc4600/intel/2017.0.098/mkl/common/mklman_f/index.htm#GUID-2EB693ED-69F3-48C7-B100-31F030797DDD.htm">p?getri</a>
:Computes the inverse of a LU-factored distributed matrix.</p>
</blockquote>

<div class="language-fortran highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">program</span><span class="w"> </span><span class="n">HC_SCE</span><span class="w">
    </span><span class="k">use</span><span class="w"> </span><span class="n">m_mpi_my</span><span class="w">
    </span><span class="k">implicit</span><span class="w"> </span><span class="k">none</span><span class="w">
    
    </span><span class="kt">INTEGER</span><span class="p">,</span><span class="k">parameter</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">dp</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">DLEN_</span><span class="o">=</span><span class="mi">9</span><span class="w">
    </span><span class="kt">COMPLEX</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span><span class="k">allocatable</span><span class="w">    </span><span class="p">::</span><span class="w">  </span><span class="n">S</span><span class="p">(:,:),</span><span class="n">B</span><span class="p">(:,:)</span><span class="w">
    </span><span class="kt">COMPLEX</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span><span class="k">allocatable</span><span class="w">    </span><span class="p">::</span><span class="w">  </span><span class="n">H_2d</span><span class="p">(:,:),</span><span class="n">S_2d</span><span class="p">(:,:),</span><span class="n">C_2d</span><span class="p">(:,:),</span><span class="n">E_2d</span><span class="p">(:)</span><span class="w">
    </span><span class="kt">REAL</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span><span class="w">    </span><span class="p">::</span><span class="w"> </span><span class="n">Hall</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span><span class="w">
    </span><span class="kt">INTEGER</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="n">lm</span><span class="p">,</span><span class="n">ln</span><span class="p">,</span><span class="n">blocksize</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="w">
    </span><span class="c1">!çŸ©é˜µH_aux(m,m), local H(lm,m)</span><span class="w">
    </span><span class="kt">INTEGER</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="mi">80</span><span class="p">),</span><span class="n">iwork</span><span class="p">(</span><span class="mi">80</span><span class="p">),</span><span class="n">ipiv</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w">
    </span><span class="kt">INTEGER</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">lwork</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span><span class="n">liwork</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span><span class="n">rsrc</span><span class="p">,</span><span class="n">nn</span><span class="w">    
    
    </span><span class="kt">INTEGER</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">ICTXT</span><span class="p">,</span><span class="n">ICTXT_2d</span><span class="p">,</span><span class="n">NPROW</span><span class="p">,</span><span class="n">NPCOL</span><span class="p">,</span><span class="n">myROW</span><span class="p">,</span><span class="n">myCOL</span><span class="p">,</span><span class="n">LOCr</span><span class="p">,</span><span class="n">LOCc</span><span class="w">
    </span><span class="kt">INTEGER</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">DESCH</span><span class="p">(</span><span class="n">DLEN_</span><span class="p">),</span><span class="n">DESCH_2d</span><span class="p">(</span><span class="n">DLEN_</span><span class="p">),</span><span class="n">DESCE</span><span class="p">(</span><span class="n">DLEN_</span><span class="p">),</span><span class="n">INFO</span><span class="p">,</span><span class="n">DSCALE</span><span class="w">
    </span><span class="kt">INTEGER</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">ICTXT_1d</span><span class="p">,</span><span class="n">ICTXT_3d</span><span class="p">,</span><span class="n">ICTXT_4d</span><span class="w">
    </span><span class="kt">CHARACTER</span><span class="o">*</span><span class="mi">2</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">numchar</span><span class="w">
    </span><span class="kt">INTEGER</span><span class="p">,</span><span class="w"> </span><span class="k">EXTERNAL</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">numroc</span><span class="w">
    
    
    </span><span class="k">call</span><span class="w"> </span><span class="n">mpi_start</span><span class="p">()</span><span class="w">
    </span><span class="n">rsrc</span><span class="o">=</span><span class="mi">0</span><span class="w">  

</span><span class="c1">!********************************************************************************   </span><span class="w">
</span><span class="c1">!1Dç½‘æ ¼è®¡ç®—</span><span class="w">
</span><span class="c1">!********************************************************************************</span><span class="w">
</span><span class="c1">!**************************</span><span class="w">
</span><span class="c1">!å¤„ç†å™¨grid</span><span class="w">
</span><span class="c1">!**************************</span><span class="w">
          </span><span class="n">NPCOL</span><span class="o">=</span><span class="mi">4</span><span class="w">
          </span><span class="n">NPROW</span><span class="o">=</span><span class="mi">1</span><span class="w">
          </span><span class="k">CALL</span><span class="w"> </span><span class="n">BLACS_GET</span><span class="p">(</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">ICTXT</span><span class="w"> </span><span class="p">)</span><span class="w"> 
          
          </span><span class="k">call</span><span class="w"> </span><span class="n">blacs_gridinit</span><span class="p">(</span><span class="n">ICTXT</span><span class="p">,</span><span class="s1">'C'</span><span class="p">,</span><span class="n">NPROW</span><span class="p">,</span><span class="n">NPCOL</span><span class="p">)</span><span class="w">
          </span><span class="k">call</span><span class="w"> </span><span class="n">blacs_gridinfo</span><span class="p">(</span><span class="n">ICTXT</span><span class="p">,</span><span class="n">NPROW</span><span class="p">,</span><span class="n">NPCOL</span><span class="p">,</span><span class="n">myROW</span><span class="p">,</span><span class="n">myCOL</span><span class="p">)</span><span class="w">

    </span><span class="c1">!write(*,*) node,NPROW,NPCOL,myROW,mycol</span><span class="w">
</span><span class="c1">!**************************</span><span class="w">
</span><span class="c1">!æ•°æ®ç½‘æ ¼</span><span class="w">
</span><span class="c1">!è¯»å…¥æ•°æ®S</span><span class="w">
</span><span class="c1">!**************************</span><span class="w">
       </span><span class="n">m</span><span class="o">=</span><span class="mi">5</span><span class="w">
       </span><span class="n">lm</span><span class="o">=</span><span class="mi">1</span><span class="w">
       </span><span class="k">if</span><span class="p">(</span><span class="n">node</span><span class="w"> </span><span class="ow">.eq.</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">lm</span><span class="o">=</span><span class="mi">2</span><span class="w">
       </span><span class="k">allocate</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">lm</span><span class="p">),</span><span class="n">B</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">lm</span><span class="p">))</span><span class="w">
       </span><span class="n">blocksize</span><span class="o">=</span><span class="mi">1</span><span class="w">
       </span><span class="k">call</span><span class="w"> </span><span class="n">DESCINIT</span><span class="p">(</span><span class="n">DESCH</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">blocksize</span><span class="p">,</span><span class="n">blocksize</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">ICTXT</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">INFO</span><span class="p">)</span><span class="w">
    </span><span class="c1">!   !call DESCINIT(DESCH,5,5,1,1,0,0,ICTXT,lm,INFO)</span><span class="w">
 
</span><span class="c1">!æ•°æ®å¤„ç†</span><span class="w">
       </span><span class="k">data</span><span class="w"> </span><span class="n">Hall</span><span class="w"> </span><span class="p">/</span><span class="mf">1.0000000107623999</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">0.95479507666315644</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">0.0000000000000000</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">5.3953328491069285E-013</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">0.0000000000000000</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">0.95479507666315644</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">0.99999999999886702</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">0.0000000000000000</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">6.3781864686742656E-013</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0000000000000000</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">0.0000000000000000</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">0.0000000000000000</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">1.0000000364970107</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">0.0000000000000000</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">0.0000000000000000</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">-5.3953328491104808E-013</span><span class="p">,</span><span class="w"> </span><span class="mf">-6.3781864686711637E-013</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0000000000000000</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">1.0000000364970068</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">0.0000000000000000</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">0.0000000000000000</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0000000000000000</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0000000000000000</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0000000000000000</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0000000364970110</span><span class="p">/</span><span class="w">
       </span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="w">
       </span><span class="k">DO</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="w">  
           </span><span class="k">if</span><span class="p">(</span><span class="n">node</span><span class="w"> </span><span class="ow">.eq.</span><span class="w"> </span><span class="nb">mod</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">np</span><span class="p">)</span><span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="n">S</span><span class="p">(:,</span><span class="n">i</span><span class="p">/</span><span class="n">np</span><span class="mi">+1</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="n">Hall</span><span class="p">(</span><span class="n">j</span><span class="p">:</span><span class="n">j</span><span class="mi">+4</span><span class="p">))</span><span class="w">   </span><span class="c1">!DO i=1,lm</span><span class="w">
           </span><span class="n">j</span><span class="o">=</span><span class="n">j</span><span class="mi">+5</span><span class="w">
       </span><span class="k">END</span><span class="w"> </span><span class="k">DO</span><span class="w"> 
    
       </span><span class="k">if</span><span class="p">(</span><span class="n">IOnode</span><span class="p">)</span><span class="w"> </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">"A is : -------------------------------"</span><span class="w">
       </span><span class="k">DO</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="w">  
           </span><span class="k">if</span><span class="p">(</span><span class="n">node</span><span class="w"> </span><span class="ow">.eq.</span><span class="w"> </span><span class="nb">mod</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">np</span><span class="p">)</span><span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">node</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="s2">":"</span><span class="p">,</span><span class="kt">real</span><span class="p">(</span><span class="n">S</span><span class="p">(:,</span><span class="n">i</span><span class="p">/</span><span class="n">np</span><span class="mi">+1</span><span class="p">))</span><span class="w">   </span><span class="c1">!DO i=1,lm</span><span class="w">
           </span><span class="k">call</span><span class="w"> </span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w">           </span><span class="c1">!    write(*,*) node,i,":",S(i,:) </span><span class="w">
       </span><span class="k">END</span><span class="w"> </span><span class="k">DO</span><span class="w"> 
    
    
    
</span><span class="c1">!****************************</span><span class="w">
</span><span class="c1">!å¾ªç¯æµ‹è¯•mklå†…å­˜é—®é¢˜</span><span class="w">

 
    </span><span class="n">B</span><span class="o">=</span><span class="n">S</span><span class="w">
 </span><span class="c1">!  !è¿›è¡ŒPLUåˆ†è§£,Bçš„å³ä¸Šè§’å˜ä¸ºUçŸ©é˜µï¼Œä¸‹éƒ¨åˆ†å­˜Lçš„ç»å¯¹éƒ¨åˆ†(å¯¹è§’çº¿æ˜¯1ä¸ç”¨å­˜å‚¨)ï¼ŒPçŸ©é˜µæ˜¯å•ä½çŸ©é˜µ</span><span class="w">
    </span><span class="k">call</span><span class="w"> </span><span class="n">pzgetrf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">DESCH</span><span class="p">,</span><span class="w"> </span><span class="n">ipiv</span><span class="p">,</span><span class="w"> </span><span class="n">info</span><span class="p">)</span><span class="w">
    </span><span class="c1">!ipiv INTEGER Array of size LOCr(m_a)+ mb_a.</span><span class="w">

    </span><span class="k">if</span><span class="p">(</span><span class="n">IOnode</span><span class="p">)</span><span class="w"> </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">"LUA' is : -------------------------------"</span><span class="w">
    </span><span class="k">DO</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="w">  
        </span><span class="k">if</span><span class="p">(</span><span class="n">node</span><span class="w"> </span><span class="ow">.eq.</span><span class="w"> </span><span class="nb">mod</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">np</span><span class="p">)</span><span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">node</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="s2">":"</span><span class="p">,</span><span class="kt">real</span><span class="p">(</span><span class="n">B</span><span class="p">(:,</span><span class="n">i</span><span class="p">/</span><span class="n">np</span><span class="mi">+1</span><span class="p">))</span><span class="w">   </span><span class="c1">!DO i=1,lm</span><span class="w">
        </span><span class="k">call</span><span class="w"> </span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w">           </span><span class="c1">!    write(*,*) node,i,":",S(i,:) </span><span class="w">
    </span><span class="k">END</span><span class="w"> </span><span class="k">DO</span><span class="w"> 
    
    
   </span><span class="c1">!lwork=LOCr(n+mod(ia-1,mb_a))*nb_a.</span><span class="w">
   </span><span class="c1">!     =LOCr(m)*blocksize</span><span class="w">
   </span><span class="c1">!     =NUMROC( M, MB_A, MYROW, RSRC_A, NPROW )*blocksize</span><span class="w">
   
    </span><span class="n">LOCr</span><span class="o">=</span><span class="n">numroc</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">blocksize</span><span class="p">,</span><span class="n">myROW</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">NPROW</span><span class="p">)</span><span class="w">
    </span><span class="n">LOCc</span><span class="o">=</span><span class="n">numroc</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">blocksize</span><span class="p">,</span><span class="n">myCOl</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">NPCOL</span><span class="p">)</span><span class="w">
    </span><span class="n">lwork</span><span class="o">=</span><span class="n">LOCr</span><span class="o">*</span><span class="n">blocksize</span><span class="w">
   </span><span class="c1">!liwork=LOCc(n_a + mod(ja-1,nb_a)) + </span><span class="w">
   </span><span class="c1">!        max(ceil(ceil(LOCr(m_a)/mb_a)/(lcm/NPROW)),nb_a)</span><span class="w">
   </span><span class="c1">!      =LOCc(m)+max(ceil(ceil(LOCr(m)/blocksize)/(lcm/NPROW)),blocksize)</span><span class="w">
   </span><span class="c1">!      =LOCC(m)+max(ceil(LOCr(m)/(4)),blocksize)</span><span class="w">
   </span><span class="c1">!      = NUMROC( m, NB_A, MYCOL, CSRC_A, NPCOL )</span><span class="w">
     </span><span class="c1">!liwork=LOCc + max(ceiling(ceiling(1.0*LOCr/blocksize)/4.0),blocksize)</span><span class="w">
     </span><span class="c1">!è¿™æ ·ç®—çš„liworkè¿˜æ˜¯å°ï¼Œä¸å¦‚ç›´æ¥liwork=LOCc+LOCr</span><span class="w">
    </span><span class="n">liwork</span><span class="o">=</span><span class="n">LOCc</span><span class="o">+</span><span class="n">LOCr</span><span class="w">
     
    </span><span class="k">call</span><span class="w"> </span><span class="n">pzgetri</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">DESCH</span><span class="p">,</span><span class="w"> </span><span class="n">ipiv</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">,</span><span class="w"> </span><span class="n">lwork</span><span class="p">,</span><span class="w"> </span><span class="n">iwork</span><span class="p">,</span><span class="w"> </span><span class="n">liwork</span><span class="p">,</span><span class="w"> </span><span class="n">info</span><span class="p">)</span><span class="w">
    </span><span class="c1">!pzgetriåˆ©ç”¨pzgetrfåˆ†è§£çš„LUæ±‚é€†</span><span class="w">
 </span><span class="c1">!  !call pzgetri(n, a, ia, ja, desca, ipiv, work, lwork, iwork, liwork, info)</span><span class="w">
 </span><span class="c1">!  !ipiv Array of size LOCr(m_a)+ mb_a.</span><span class="w">
 </span><span class="c1">!  !lworkâ‰¥LOCr(n+mod(ia-1,mb_a))*nb_a.</span><span class="w">
 </span><span class="c1">!  !(local or global) INTEGER. The size of the array iwork.</span><span class="w">
 </span><span class="c1">!  !The minimal value liwork of is determined by the following code:</span><span class="w">
 </span><span class="c1">!  !</span><span class="w">
 </span><span class="c1">!  !if NPROW == NPCOL then</span><span class="w">
 </span><span class="c1">!  ! liwork = LOCc(n_a + mod(ja-1,nb_a))+ nb_a </span><span class="w">
    </span><span class="c1">!else </span><span class="w">
    </span><span class="c1">! liwork = LOCc(n_a + mod(ja-1,nb_a)) + </span><span class="w">
    </span><span class="c1">!max(ceil(ceil(LOCr(m_a)/mb_a)/(lcm/NPROW)),nb_a)</span><span class="w">
    </span><span class="c1">!LOCc(m)+max(ceil(LOCr(m)/(lcm/NPROW)),nb_a)</span><span class="w">
    </span><span class="c1">!numroc(m,blocksize,myCOL,0,NPCOL)+ceil(numroc(m)/4.0)</span><span class="w">
    </span><span class="c1">!end if</span><span class="w">
    </span><span class="c1">!where lcm is the least common multiple of process rows and columns (NPROW and NPCOL).</span><span class="w">
    </span><span class="c1">!LCMæœ€å°å…¬å€æ•°</span><span class="w">
    </span><span class="c1">!**************************</span><span class="w">
    </span><span class="c1">!**æ³¨ï¼šLOCrä¸LoCcæ˜¯ä¸€ä¸ªScalapackçš„å‡½æ•°ï¼Œ</span><span class="w">
    </span><span class="c1">! *  The values of LOCr() and LOCc() may be determined via a call to the</span><span class="w">
    </span><span class="c1">! *  ScaLAPACK tool function, NUMROC:</span><span class="w">
    </span><span class="c1">! *          LOCr( M ) = NUMROC( M, MB_A, MYROW, RSRC_A, NPROW ),</span><span class="w">
    </span><span class="c1">! *          LOCc( N ) = NUMROC( N, NB_A, MYCOL, CSRC_A, NPCOL ).</span><span class="w">
    </span><span class="c1">! *  An upper bound for these quantities may be computed by:</span><span class="w">
    </span><span class="c1">! *          LOCr( M ) &lt;= ceil( ceil(M/MB_A)/NPROW )*MB_A</span><span class="w">
    </span><span class="c1">! *          LOCc( N ) &lt;= ceil( ceil(N/NB_A)/NPCOL )*NB_A</span><span class="w">
    
    </span><span class="k">if</span><span class="p">(</span><span class="n">IOnode</span><span class="p">)</span><span class="w"> </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">"invA is : -------------------------------"</span><span class="w">
    </span><span class="k">DO</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="w">  
        </span><span class="k">if</span><span class="p">(</span><span class="n">node</span><span class="w"> </span><span class="ow">.eq.</span><span class="w"> </span><span class="nb">mod</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">np</span><span class="p">)</span><span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">node</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="s2">":"</span><span class="p">,</span><span class="kt">real</span><span class="p">(</span><span class="n">B</span><span class="p">(:,</span><span class="n">i</span><span class="p">/</span><span class="n">np</span><span class="mi">+1</span><span class="p">))</span><span class="w">   </span><span class="c1">!DO i=1,lm</span><span class="w">
        </span><span class="k">call</span><span class="w"> </span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w">           </span><span class="c1">!    write(*,*) node,i,":",S(i,:) </span><span class="w">
    </span><span class="k">END</span><span class="w"> </span><span class="k">DO</span><span class="w"> 
        
    </span><span class="k">CALL</span><span class="w"> </span><span class="n">BLACS_GRIDEXIT</span><span class="p">(</span><span class="w"> </span><span class="n">ICTXT</span><span class="w"> </span><span class="p">)</span><span class="w"> 
 </span><span class="c1">!   </span><span class="w">
    </span><span class="k">deallocate</span><span class="p">(</span><span class="n">S</span><span class="p">,</span><span class="n">B</span><span class="p">)</span><span class="w">
    </span><span class="k">call</span><span class="w"> </span><span class="n">mpi_end</span><span class="p">()</span><span class="w">
</span><span class="k">end</span><span class="w"> </span><span class="k">program</span><span class="w"> </span><span class="n">HC_SCE</span><span class="w">
</span></code></pre></div></div>

<p>ç»“æœ
<img src="/uploads/2019/08/inv.jpg" alt="" />
ä½¿ç”¨MATLABéªŒè¯</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt; A

A =

   1.000000000000000   0.954795062541962                   0   0.000000000000540                   0
   0.954795062541962   1.000000000000000                   0   0.000000000000638                   0
                   0                   0   1.000000000000000                   0                   0
  -0.000000000000540  -0.000000000000638                   0   1.000000000000000                   0
                   0                   0                   0                   0   1.000000000000000

&gt;&gt; [l,u,p]=lu(A);
&gt;&gt; u'

ans =

   1.000000000000000                   0                   0                   0                   0
   0.954795062541962   0.088366388545492                   0                   0                   0
                   0                   0   1.000000000000000                   0                   0
   0.000000000000540   0.000000000000123                   0   1.000000000000000                   0
                   0                   0                   0                   0   1.000000000000000

&gt;&gt; l'

ans =

   1.000000000000000   0.954795062541962                   0  -0.000000000000540                   0
                   0   1.000000000000000                   0  -0.000000000001388                   0
                   0                   0   1.000000000000000                   0                   0
                   0                   0                   0   1.000000000000000                   0
                   0                   0                   0                   0   1.000000000000000
&gt;&gt; inv(A)

ans =

  11.316519962623509 -10.804957385470471                   0   0.000000000000786                   0
 -10.804957385470471  11.316519962623509                   0  -0.000000000001388                   0
                   0                   0   1.000000000000000                   0                   0
  -0.000000000000786   0.000000000001388                   0   1.000000000000000                   0
                   0                   0                   0                   0   1.000000000000000

</code></pre></div></div>
<p>å¯ä»¥çœ‹åˆ°<code class="highlighter-rouge">pzgetrf</code>å°†çŸ©é˜µLUåˆ†è§£ï¼Œå¹¶å°†LUå­˜å‚¨åˆ°åŸçŸ©é˜µä¸­</p>

<h2 id="æŠ¥é”™">æŠ¥é”™</h2>
<h3 id="parameter-number---10-had-an-illegal-value"><code class="highlighter-rouge">parameter number   10 had an illegal value</code></h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{    0,    3}:  On entry to PZGETRI parameter number   10 had an illegal value
{    0,    2}:  On entry to PZGETRI parameter number   10 had an illegal value
{    0,    1}:  On entry to PZGETRI parameter number   10 had an illegal value
{    0,    0}:  On entry to PZGETRI parameter number   10 had an illegal value
</code></pre></div></div>
<p>ç¬¬10ä¸ªè¾“å…¥å‚æ•°ä¸åˆç†</p>

<h3 id="----0----2--on-entry-to-pdgetrf-parameter-number--601-had-an-illegal-value"><code class="highlighter-rouge">{    0,    2}:  On entry to PDGETRF parameter number  601 had an illegal value</code></h3>
<p>åŸºæœ¬ä¸Šéƒ½æ˜¯è¾“å…¥å‚æ•°ä¸åˆç†<br />
è™½ç„¶æœ‰æ—¶å€™èƒ½ç®—çš„å‡ºæ¥ï¼Œå…¶ä»–æƒ…å†µå°±ç®—ä¸ä¸å‡ºæ¥äº†<br />
å¯èƒ½å› ä¸ºæŸäº›è¾“å…¥å˜é‡æ²¡æœ‰èµ‹å€¼ï¼Œç®—å‡ºæ¥æ˜¯æ®‹å­˜å†…å­˜çš„æ„å¤–</p>

<h3 id="pblas-error-illegal-descaimb_--0-å…¶å®è¿˜æ˜¯è¾“å…¥å‚æ•°é¡ºåºå†™é”™äº†ç»™äº†é”™çš„å‚æ•°"><code class="highlighter-rouge">PBLAS ERROR 'Illegal DESCA[IMB_] = 0</code> å…¶å®è¿˜æ˜¯è¾“å…¥å‚æ•°é¡ºåºå†™é”™äº†ï¼Œç»™äº†é”™çš„å‚æ•°</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mpirun -np 4 ./test 10
PBLAS ERROR 'Illegal DESCA[IMB_] = 0, DESCA[IMB_] must be at least 1'
from {0,3}, pnum=3, Contxt=0, in routine 'PDGEMM'.

PBLAS ERROR 'Illegal DESCA[MB_] = 0, DESCA[MB_] must be at least 1'
from {0,3}, pnum=3, Contxt=0, in routine 'PDGEMM'.

PBLAS ERROR 'Illegal DESCA[RSRC_] = 1023, DESCA[RSRC_] must be either -1, or &gt;= 0 and &lt; 1'
from {0,3}, pnum=3, Contxt=0, in routine 'PDGEMM'.

PBLAS ERROR 'Illegal DESCB[IMB_] = 0, DESCB[IMB_] must be at least 1'
from {0,3}, pnum=3, Contxt=0, in routine 'PDGEMM'.

PBLAS ERROR 'Illegal DESCB[MB_] = 0, DESCB[MB_] must be at least 1'
from {0,3}, pnum=3, Contxt=0, in routine 'PDGEMM'.
</code></pre></div></div>
:ET