I"èd<ul id="markdown-toc">
  <li><a href="#ç¼–è¯‘æ³¨æ„" id="markdown-toc-ç¼–è¯‘æ³¨æ„">ç¼–è¯‘æ³¨æ„</a></li>
  <li><a href="#vaspç¼–è¯‘è¯´æ˜" id="markdown-toc-vaspç¼–è¯‘è¯´æ˜">vaspç¼–è¯‘è¯´æ˜</a>    <ul>
      <li><a href="#vaspå®‰è£…éœ€è¦" id="markdown-toc-vaspå®‰è£…éœ€è¦">vaspå®‰è£…éœ€è¦</a></li>
      <li><a href="#ç¼–è¯‘å‡†å¤‡" id="markdown-toc-ç¼–è¯‘å‡†å¤‡">ç¼–è¯‘å‡†å¤‡</a></li>
      <li><a href="#ç¼–è¯‘ç¯å¢ƒ" id="markdown-toc-ç¼–è¯‘ç¯å¢ƒ">ç¼–è¯‘ç¯å¢ƒ</a></li>
    </ul>
  </li>
  <li><a href="#ç¼–è¯‘è¿‡ç¨‹" id="markdown-toc-ç¼–è¯‘è¿‡ç¨‹">ç¼–è¯‘è¿‡ç¨‹</a>    <ul>
      <li><a href="#intel" id="markdown-toc-intel">intel</a>        <ul>
          <li><a href="#ä¾èµ–" id="markdown-toc-ä¾èµ–">ä¾èµ–</a></li>
          <li><a href="#å®‰è£…" id="markdown-toc-å®‰è£…">å®‰è£…</a></li>
          <li><a href="#æ·»åŠ path" id="markdown-toc-æ·»åŠ path">æ·»åŠ PATH</a></li>
          <li><a href="#ç¼–è¯‘å¹¶è¡Œfftw" id="markdown-toc-ç¼–è¯‘å¹¶è¡Œfftw">ç¼–è¯‘å¹¶è¡Œfftw</a></li>
        </ul>
      </li>
      <li><a href="#vasp" id="markdown-toc-vasp">vasp</a></li>
    </ul>
  </li>
  <li><a href="#è¿è¡Œvasp" id="markdown-toc-è¿è¡Œvasp">è¿è¡Œvasp</a></li>
  <li><a href="#å¸¸è§é—®é¢˜" id="markdown-toc-å¸¸è§é—®é¢˜">å¸¸è§é—®é¢˜</a>    <ul>
      <li><a href="#intel64" id="markdown-toc-intel64">intel64</a></li>
      <li><a href="#æ•°å­¦åº“mkl" id="markdown-toc-æ•°å­¦åº“mkl">æ•°å­¦åº“MKL</a>        <ul>
          <li><a href="#æ•°å­¦åº“çš„è°ƒç”¨" id="markdown-toc-æ•°å­¦åº“çš„è°ƒç”¨">æ•°å­¦åº“çš„è°ƒç”¨</a></li>
        </ul>
      </li>
      <li><a href="#mpif90" id="markdown-toc-mpif90">mpif90</a></li>
      <li><a href="#ç¼–è¯‘æ—¶æŠ¥é”™å“ªä¸ªæ•°å­¦åº“æ–‡ä»¶" id="markdown-toc-ç¼–è¯‘æ—¶æŠ¥é”™å“ªä¸ªæ•°å­¦åº“æ–‡ä»¶">ç¼–è¯‘æ—¶æŠ¥é”™å“ªä¸ªæ•°å­¦åº“æ–‡ä»¶</a></li>
      <li><a href="#ä½¿ç”¨fftw" id="markdown-toc-ä½¿ç”¨fftw">ä½¿ç”¨fftw</a></li>
      <li><a href="#fftwä¸æ”¯æŒmpiæŠ¥é”™" id="markdown-toc-fftwä¸æ”¯æŒmpiæŠ¥é”™"><del>fftwä¸æ”¯æŒmpiæŠ¥é”™</del></a></li>
      <li><a href="#æŠ¥é”™" id="markdown-toc-æŠ¥é”™">æŠ¥é”™</a>        <ul>
          <li><a href="#segmentation-fault-occurred" id="markdown-toc-segmentation-fault-occurred">segmentation fault occurred</a></li>
          <li><a href="#rlimit_memlock-too-small" id="markdown-toc-rlimit_memlock-too-small">RLIMIT_MEMLOCK too small</a></li>
          <li><a href="#è¿™ä¸ªé”™è¯¯" id="markdown-toc-è¿™ä¸ªé”™è¯¯">è¿™ä¸ªé”™è¯¯</a></li>
          <li><a href="#æœªè§£å†³dapl-fabric-is-not-available-and-fallback-fabric-is-not-enabled" id="markdown-toc-æœªè§£å†³dapl-fabric-is-not-available-and-fallback-fabric-is-not-enabled">[æœªè§£å†³]dapl fabric is not available and fallback fabric is not enabled</a></li>
          <li><a href="#internal-error-in-init_scala-desca-descinit-info" id="markdown-toc-internal-error-in-init_scala-desca-descinit-info">internal error in INIT_SCALA: DESCA, DESCINIT, INFO:</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p>ä¹‹å‰å°è¯•ç¼–è¯‘VASP<a href="/2018/01/09/ubuntu-install-vasp/">Ubuntu VASPå®‰è£…å’Œè¿è¡Œ</a>ï¼Œä½†æ˜¯åœ¨centosä¸Šè¿›è¡Œé‡å¤æ—¶ï¼Œå„ç§æŠ¥é”™ï¼Œç°åœ¨å°è¯•äº†å®‰è£…å‡ æ¬¡æ„Ÿè§‰è‡ªå·±çš„ç†è§£æ›´å¤šäº†ï¼Œæ€»ç»“å¦‚ä¸‹ã€‚è¿™ç¯‡æ–‡ç« çœç•¥äº†å¾ˆå¤šå‘½ä»¤,æœ‰çœ‹ä¸æ‡‚çš„åœ°æ–¹å‚è€ƒ<a href="/2018/01/09/ubuntu-install-vasp/">Ubuntu VASPå®‰è£…å’Œè¿è¡Œ</a>ã€‚</p>

<h1 id="ç¼–è¯‘æ³¨æ„">ç¼–è¯‘æ³¨æ„</h1>
<ul>
  <li>ç¡¬ç›˜ç©ºé—´è¶³å¤Ÿ
<br />ç¼–è¯‘æ—¶ä¼šäº§ç”Ÿå¾ˆå¤šä¸´æ—¶æ–‡ä»¶ï¼Œå æ®ç©ºé—´å¤§ï¼ŒIntelç¼–è¯‘å™¨Intel Parallel Studio XE 2018 for linuxå®‰è£…åå 11Gï¼Œå®‰è£…åŒ…3.5G,ç¡¬ç›˜ç©ºé—´ä¸è¶³ç¼–è¯‘å¤±è´¥<br />
å¦‚æœç¡¬ç›˜ç©ºé—´å¤ªå°,å¯ä»¥å°è¯•å®‰è£…è€ç‰ˆçš„intelç¼–è¯‘å™¨</li>
  <li>å†…å­˜è¶³å¤Ÿ
<br />ä½¿ç”¨fortranç¼–è¯‘vaspæ—¶,å†…å­˜1Gç¼–è¯‘è¿‡ç¨‹ä¸­,è¿›ç¨‹è¢«æ€æ­»ï¼Œæ·»åŠ 2Gçš„è™šæ‹Ÿå†…å­˜ï¼Œç¼–è¯‘é€šè¿‡</li>
  <li>ç¼–è¯‘å™¨æœ€å¥½ä¸€è‡´
<br />vaspéœ€è¦æ•°å­¦åº“,mpi,fftï¼Œä½¿ç”¨gfortranå’Œifortç¼–è¯‘äº§ç”Ÿçš„åº“æ–‡ä»¶ä¸åŒï¼Œæœ€åä½¿ç”¨gfortranå’Œifortç¼–è¯‘vaspæ—¶å®¹æ˜“å†²çªï¼Œæ‰€ä»¥åªä½¿ç”¨ifortæˆ–gfortranå…¶ä¸­çš„ä¸€ç§è¿›è¡Œç¼–è¯‘</li>
  <li>configureçš„ä¸€äº›å‚æ•°
<br /> <code class="highlighter-rouge">--prefix å®‰è£…ç›®å½•</code>,æ˜¯æœ€å<code class="highlighter-rouge">make install</code>çš„å®‰è£…åœ°å€</li>
  <li>å®‰è£…åœ°å€
<br />å¯ä»¥ç¼–è¯‘åœ¨<code class="highlighter-rouge">/home/username</code>å³å®¶ç›®å½•ä¸‹,è¿™æ ·åªèƒ½è‡ªå·±ä½¿ç”¨
<br />ä¹Ÿå¯ä»¥å®‰è£…åˆ°æ ¹ç›®å½•ä¸‹çš„æŸç›®å½•(éœ€è¦rootæƒé™)ï¼Œæ¯ä¸ªç”¨æˆ·éƒ½å¯ä»¥ä½¿ç”¨</li>
  <li>PATH
<br />å®‰è£…è½¯ä»¶å,è½¯ä»¶æ‰§è¡Œæ–‡ä»¶æ‰€åœ¨ç›®å½•è¢«æ·»åŠ åˆ°ç³»ç»ŸPATHè·¯å¾„åï¼Œæ‰èƒ½åœ¨shellé‡Œç›´æ¥è¾“å…¥å‘½ä»¤å¦‚<code class="highlighter-rouge">icc</code>,ä¸æ·»åŠ åˆ™éœ€è¦ä½¿ç”¨<code class="highlighter-rouge">/opt/intel/bin/icc</code>è¿è¡Œ
<br />æ·»åŠ PATHçš„æ–¹æ³•ï¼Œå‚è€ƒ<a href="/2017/09/10/linux-command/#%E6%B7%BB%E5%8A%A0path">æ·»åŠ PATH</a></li>
  <li>ç¼–è¯‘é€‰é¡¹
<br /><code class="highlighter-rouge">configure -h</code>å¯ä»¥æŸ¥çœ‹ç”Ÿæˆmakefileçš„ç¼–è¯‘é€‰é¡¹,å¦‚CC(Cç¼–è¯‘å™¨)FC(Fortranç¼–è¯‘å™¨)MPICC(å¹¶è¡ŒCC)MPIFC(å¹¶è¡ŒFC)enable-mpi(æ‰§è¡Œå¹¶è¡Œ)
<br />ç¼–è¯‘å¹¶è¡Œfftwæ—¶,æŒ‡å®šintelç¼–è¯‘å™¨
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./configure --prefix=/opt/fftw/ CC=icc F77=ifort MPICC=mpiicc --enable-mpi
</code></pre></div>    </div>
    <p><br />ç¼–è¯‘siesta</p>
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>../Src/configure  FC=ifort CC=icc MPIFC=mpiifort --enable-mpi
</code></pre></div>    </div>
    <p><br /><br /></p>
    <h1 id="vaspç¼–è¯‘è¯´æ˜">vaspç¼–è¯‘è¯´æ˜</h1>
    <p>å»ºè®®è®¤çœŸè¯»ä¸€ä¸‹vasp4.6çš„makefileæ–‡ä»¶,é‡Œé¢è¯´çš„å¾ˆè¯¦ç»†<a href="/web/file/2018/makefile.linux_ifc_P4">makefile.linux_ifc_P4</a>ï¼Œè¿˜æœ‰VASP.5.4.1é‡Œé¢çš„README</p>
    <h2 id="vaspå®‰è£…éœ€è¦">vaspå®‰è£…éœ€è¦</h2>
  </li>
  <li>fortranç­‰ç¼–è¯‘å™¨
<br /> intel: icc ifort
<br /> gfortranç­‰</li>
  <li>æ•°å­¦åº“ BLAS BLACS LAPACK SCALAPACK
<br /> intel:mklå«æœ‰
<br /> åˆ†åˆ«ä»<a href="http://www.netlib.org/liblist.html">NETLIB</a>ç¼–è¯‘å®‰è£…
<br /> <a href="http://www.netlib.org/scalapack/#_scalapack_installer_for_linux">SCALAPACKå®‰è£…åŒ…</a>å¯å¸®å¿™ä¸‹è½½æ‰€æœ‰æ•°å­¦åº“</li>
  <li>fft
<br /> vaspè‡ªå¸¦
<br /> intel:mklå«æœ‰
<br /> ç¼–è¯‘<a href="http://www.fftw.org/">fftw</a></li>
  <li><strong>æ³¨:</strong>
<br />è‹¥ç¼–è¯‘æ•°å­¦åº“,fftw,éœ€å’Œæœ€åç¼–è¯‘vaspä½¿ç”¨åŒä¸€fortranç¼–è¯‘å™¨
<br />ç¼–è¯‘æ•°å­¦åº“,éœ€æ”¯æŒmpiå¹¶è¡Œï¼Œè¿™æ ·æ‰èƒ½ç¼–è¯‘æ”¯æŒmpiçš„vasp</li>
</ul>

<p>é€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œintelçš„ç¼–è¯‘å™¨<a href="https://software.intel.com/en-us/parallel-studio-xe/choose-download">Intel Parallel Studio XE</a>åŒ…å«äº†æˆ‘ä»¬ç¼–è¯‘vaspæ‰€æœ‰çš„å·¥å…·</p>

<h2 id="ç¼–è¯‘å‡†å¤‡">ç¼–è¯‘å‡†å¤‡</h2>
<p>ä»<a href="https://software.intel.com/en-us/parallel-studio-xe/choose-download">Intel Parallel Studio XE</a>æ³¨å†Œè´¦å·ï¼Œè·å–å®‰è£…åºåˆ—å·ï¼Œå»ºè®®ä½¿ç”¨edué‚®ç®±æ³¨å†Œï¼Œè·å–åºåˆ—å·æ—¶é—´çŸ­,æˆ‘ç”³è¯·çš„å¼€æºè´¡çŒ®è€…è´¦å·å¥½å‡ å¤©éƒ½æ²¡é€šè¿‡ã€‚å½“ç„¶ä¹Ÿæœ‰ä½¿ç”¨licenseæ¿€æ´»çš„,ç™¾åº¦ç›¸å…³èµ„æºã€‚<br />
æ­¤æ¬¡æˆ‘ä½¿ç”¨çš„ç‰ˆæœ¬IntelÂ® Parallel Studio XE 2018 for Linux<br /><br />
vaspæ¥æº<a href="https://www.vasp.at/">VASP</a>,ç»„é‡Œè´­ä¹°çš„æ­£ç‰ˆ,ç½‘ä¸Šä¹Ÿå¯æœç´¢çš„ç›¸å…³çš„èµ„æº,è®¡ç®—è¯·ä½¿ç”¨æ­£ç‰ˆ<br />
æ­¤æ¬¡æˆ‘ä½¿ç”¨çš„æ–‡ä»¶vasp.5.4.1.24Jun15.tar.gz</p>

<h2 id="ç¼–è¯‘ç¯å¢ƒ">ç¼–è¯‘ç¯å¢ƒ</h2>
<p>æ­¤æ¬¡ç¼–è¯‘åœ¨vmwareä¸Šè¿è¡Œçš„Centos7,3.10.0-514.el7.x86_64,2Gå†…å­˜,i7-7500U<br />
é™¤äº†inteléœ€è¦çš„åº“å®‰è£…æ–¹æ³•ä¸ä¸€æ ·å¤–ï¼Œvaspç¼–è¯‘è¿è¡Œæ–¹å¼åº”è¯¥é€‚ç”¨äºæ‰€æœ‰Linux
<br /><br /></p>
<h1 id="ç¼–è¯‘è¿‡ç¨‹">ç¼–è¯‘è¿‡ç¨‹</h1>
<h2 id="intel">intel</h2>
<h3 id="ä¾èµ–">ä¾èµ–</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yum install glibc-devel.i686 
yum install libstdc++.so.6  
ldconfig
yum install gcc-c++
</code></pre></div></div>
<p>å®‰è£…è¿‡ç¨‹æç¤ºOS unsupport ,å¿½è§†<br />
æœ‰å…¶ä»–ä¾èµ–ç¼ºå°‘æ—¶,yumå®‰è£…åå†Re-check
<br />å¦å¤–åœ¨äº‘æœåŠ¡å™¨ä¸Šå°è¯•æ—¶</p>
<ul>
  <li>KVMå®‰è£…æ—¶æç¤º CPU unsupportï¼Œæš‚æœªç»§ç»­å®‰è£…</li>
  <li>OVZå®‰è£…æç¤º å†…æ ¸æœ‰é—®é¢˜ï¼Œæš‚æœªç»§ç»­å®‰è£…</li>
</ul>

<h3 id="å®‰è£…">å®‰è£…</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./install.sh
</code></pre></div></div>
<p>åŒæ„åè®®,ä¿æŒé»˜è®¤é€‰é¡¹å³å¯,é»˜è®¤å®‰è£…åˆ°<code class="highlighter-rouge">/opt/intel</code>,ä¹Ÿå¯ä»¥è‡ªå®šä¹‰
<br />ä½¿ç”¨ubuntu16.04å®‰è£…æ—¶,ä½¿ç”¨<code class="highlighter-rouge">./install_GUI.sh </code>,å¯ä»¥é€‰æ‹©å®‰è£…ç»„ä»¶ï¼Œåªå®‰è£…64ä½,icc,ifort,mpi,mklå°±å¯ä»¥è¿è¡Œï¼Œå®‰è£…åå ç©ºé—´çº¦2G</p>
<h3 id="æ·»åŠ path">æ·»åŠ PATH</h3>
<p>ä¸‹é¢çš„è·¯å¾„ä¸å®é™…è·¯å¾„ä¸intelç¼–è¯‘å™¨çš„ç‰ˆæœ¬æœ‰å…³,ç‰ˆæœ¬å˜æ›´åé€‚å½“ä¿®æ”¹<br />
æ‰§è¡Œ</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>source /opt/intel/compilers_and_libraries_2018.0.128/linux/bin/compilervars.sh intel64
source /opt/intel/compilers_and_libraries_2018.0.128/linux/bin/iccvars.sh intel64 
source /opt/intel/compilers_and_libraries_2018.0.128/linux/bin/ifortvars.sh intel64 
source /opt/intel/compilers_and_libraries/linux/mkl/bin/mklvars.sh intel64
source  /opt/intel/impi/2018.0.128/bin64/mpivars.sh
</code></pre></div></div>
<p>æˆ–è€…è®²ä¸Šè¿°å‘½ä»¤æ·»åŠ åˆ°<code class="highlighter-rouge">/etc/profile</code>æˆ–<code class="highlighter-rouge">~/.bashrc</code>,å…·ä½“å«ä¹‰<a href="/2017/09/10/linux-command/#%E6%B7%BB%E5%8A%A0path">æ·»åŠ PATH</a><br />
å¯ç”¨<code class="highlighter-rouge">which icc ifort icpc mpiifort</code>æ£€æŸ¥æ˜¯å¦æ·»åŠ æˆåŠŸ<br />
ä¹‹åç¼–è¯‘,è‹¥æç¤º<code class="highlighter-rouge">xxx:command not found</code>ï¼Œåˆ™å†sourceä¸€éä¸Šè¿°å‘½ä»¤<br />
åœ¨ç¼–è¯‘åè¿è¡Œvaspæ—¶,è‹¥ä¸Šè¿°æ–‡ä»¶ä¸åœ¨PATHå†…,ä¹Ÿæ— æ³•è¿è¡Œ,éœ€è¦å…ˆæ‰§è¡Œä¸€é<br />
ä¿®æ”¹<code class="highlighter-rouge">/etc/profile</code>æˆ–<code class="highlighter-rouge">~/.bashrc</code>ä¸­å°±æ— éœ€ä¸Šè¿°æ“ä½œ,ç™»é™†æ—¶sourceä¸€ä¸‹æˆ–ç€æ·»åŠ åˆ°æ–‡ä»¶æ°¸ä¹…ä¿®æ”¹éƒ½å¯ä»¥,çœ‹ä¸ªäººå–œå¥½</p>
<h3 id="ç¼–è¯‘å¹¶è¡Œfftw">ç¼–è¯‘å¹¶è¡Œfftw</h3>

<p>ä¸‹é¢çš„è·¯å¾„ä¸å®é™…è·¯å¾„ä¸intelç¼–è¯‘å™¨çš„ç‰ˆæœ¬æœ‰å…³,ç‰ˆæœ¬å˜æ›´åé€‚å½“ä¿®æ”¹<br />
<code class="highlighter-rouge">make -h</code>å¯<strong>ä¸æ˜¯å¾ˆç¡®å®š</strong>ä½¿ç”¨intelç¼–è¯‘å™¨ç¼–è¯‘å¹¶è¡Œç‰ˆæœ¬çš„fftwå‘½ä»¤ä¸º<code class="highlighter-rouge">make libintel64</code><br />
å»ºè®®ç¼–è¯‘å¹¶è¡Œfftwä½¿ç”¨ä¸‹æ–‡<a href="/2018/01/15/intel-mpi-vasp/#%E4%BD%BF%E7%94%A8fftw">ç¼–è¯‘fftw</a>çš„æ–¹æ³•</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd /opt/intel/compilers_and_libraries_2018.0.128/linux/mkl/interfaces/fftw3xf
make libmic
</code></pre></div></div>
<p>ç¼–è¯‘ååœ¨å½“å‰æ–‡ä»¶å¤¹å†…ç”Ÿæˆ<code class="highlighter-rouge">libfftw3xf_intel.a</code></p>
<h2 id="vasp">vasp</h2>
<p>å¥½åƒä¸éœ€è¦vasp.5.libä¹Ÿç¼–è¯‘é€šè¿‡<br />
è§£å‹vasp.5.4.1.24Jun15.tar.gzå</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd vasp.5.4.1
cp arch/makefile.include.linux_intel makefile.include
</code></pre></div></div>
<p>ä¿®æ”¹makefile.includeä¸­å†…å®¹</p>
<ul>
  <li>10è¡Œå¼€å§‹ç¼–è¯‘å™¨é…ç½®
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FC         = mpiifort
FCL        = mpiifort -mkl
</code></pre></div>    </div>
  </li>
  <li>19è¡Œå¼€å§‹,æ•°å­¦åº“é…ç½®å¦‚ä¸‹
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MKLROOT=/opt/intel/compilers_and_libraries_2018.0.128/linux/mkl
MKL_PATH   = $(MKLROOT)/lib/intel64
BLAS       =-L$(MKL_PATH) -lmkl_intel_lp64 -lmkl_sequential -lmkl_core -lpthread
LAPACK     =-L$(MKL_PATH) -lmkl_intel_lp64 -lmkl_sequential -lmkl_core -lpthread
BLACS      =-L$(MKL_PATH) -lmkl_blacs_intelmpi_lp64
SCALAPACK  = $(MKL_PATH)/libmkl_scalapack_lp64.a $(BLACS)
</code></pre></div>    </div>
    <p>å‘ç°makefile.includeä¸­æœ‰<code class="highlighter-rouge">LIB=LLIBS      = $(SCALAPACK) $(LAPACK) $(BLAS)</code>,ä¹Ÿå¯ä»¥</p>
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MKLROOT=/opt/intel/compilers_and_libraries_2018.0.128/linux/mkl
MKL_PATH   = $(MKLROOT)/lib/intel64
BLAS       =-L$(MKL_PATH) -lmkl_intel_lp64 -lmkl_sequential -lmkl_core -lpthread -lmkl_blacs_intelmpi_lp64 -lmkl_scalapack_lp64
LAPACK     =
BLACS      =
SCALAPACK  = 
</code></pre></div>    </div>
  </li>
  <li>26è¡Œffté…ç½®
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>OBJECTS    = fftmpiw.o fftmpi_map.o fftw3d.o fft3dlib.o \
           $(MKLROOT)/interfaces/fftw3xf/libfftw3xf_intel.a
INCS       =-I$(MKLROOT)/include/fftw
</code></pre></div>    </div>
    <p>è‹¥è‡ªå·±ç¼–è¯‘fftwï¼Œé…ç½®ä¸º(å…¶ä¸­/opt/fftwæ˜¯æˆ‘ç¼–è¯‘åå®‰è£…çš„ç›®å½•)</p>
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>OBJECTS    = fftmpiw.o fftmpi_map.o fftw3d.o fft3dlib.o \
           /opt/fftw/lib/libfftw3_mpi.a
INCS       =-I/opt/fftw/include
</code></pre></div>    </div>
    <p>æœ€åæˆ‘çš„<a href="/web/file/2018/makefile.include_intelfftw/makefile.include">makefile.inclued</a><br />
ç¼–è¯‘</p>
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make
</code></pre></div>    </div>
    <p>å°±åœ¨<code class="highlighter-rouge">./build</code>ä¸­ç”Ÿæˆäº†gammaç‰ˆæœ¬çš„vasp,éçº¿æ€§ç‰ˆæœ¬çš„vasp,æ ‡å‡†ç‰ˆæœ¬çš„vasp</p>
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gam  ncl  std
</code></pre></div>    </div>
    <p>æ¯ä¸ªæ–‡ä»¶å¤¹ä¸­éƒ½æœ‰ä¸€ä¸ªvaspçš„å¯æ‰§è¡Œæ–‡ä»¶,æ·»åŠ PATHå³å¯</p>
  </li>
</ul>

<h1 id="è¿è¡Œvasp">è¿è¡Œvasp</h1>
<p>è‹¥æ²¡æœ‰ç»™æ•°å­¦åº“æ·»åŠ PATH,è¿è¡Œå‰éœ€è¦sourceä¸€ä¸‹,å…·ä½“å†…å®¹ï¼Œå‰é¢éƒ½æœ‰<br />
vaspè¿è¡Œæ–¹å¼1)æ·»åŠ PATHç›´æ¥è¾“å…¥vaspè¿è¡Œï¼Œæˆ–ç±»ä¼¼è¿™æ ·<code class="highlighter-rouge">~/vasp/vasp.5.4.1/build/std/vasp</code>è¿è¡Œ<br />
æ˜¯å¦æ·»åŠ PATHï¼Œçœ‹ç»„é‡Œä¹ æƒ¯å§<br />
æŠŠè¾“å…¥æ–‡ä»¶æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼Œåœ¨è¯¥æ–‡ä»¶å¤¹å†…è¿è¡Œvasp<br />
å¯ä»<a href="https://www.materialsproject.org">Materials Project</a>ä¸‹è½½POSCAR, INCAR,KPOINTS,POTCARä»vaspç½‘ç«™ä¸‹è½½,ç›´æ¥è¿ç®—å¯èƒ½éœ€è¦ä¿®æ”¹ä¸‹è½½çš„INCAR,å°†ç»“æœä¸<a href="https://www.materialsproject.org">Materials Project</a>ç»“æœæ¯”è¾ƒ</p>
<h1 id="å¸¸è§é—®é¢˜">å¸¸è§é—®é¢˜</h1>
<p>è¿™é‡Œæ”¾ä¸€äº›ï¼Œå®‰è£…è¿‡ç¨‹ä¸­çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ</p>

<h2 id="intel64">intel64</h2>
<p>åœ¨intelçš„è·¯å¾„ä¸­<code class="highlighter-rouge">ia32</code>ä»£è¡¨32ä½,<code class="highlighter-rouge">intel64</code>ä»£è¡¨64ä½</p>
<h2 id="æ•°å­¦åº“mkl">æ•°å­¦åº“MKL</h2>
<h3 id="æ•°å­¦åº“çš„è°ƒç”¨">æ•°å­¦åº“çš„è°ƒç”¨</h3>
<p>æ•°å­¦åº“å¯ä»¥åˆ†ä¸ºé™æ€é“¾æ¥å’ŒåŠ¨æ€è¿æ¥,ä¸¤ç§æ–¹å¼éƒ½å¯ä»¥<br />
å¦‚<code class="highlighter-rouge">/opt/intel/compilers_and_libraries_2018.0.128/linux/mkl/lib/intel64</code>
<br />é‡Œé¢æœ‰å¾ˆå¤šåº“æ–‡ä»¶<code class="highlighter-rouge">libmkl_blacs_intelmpi_ilp64.a libmkl_blacs_intelmpi_ilp64.so</code><br />
å…¶ä¸­æ‹“å±•åä¸º<code class="highlighter-rouge">.a</code>æ˜¯é™æ€åº“,<code class="highlighter-rouge">.so</code>çš„ä¸ºåŠ¨æ€åº“</p>
<ul>
  <li>é™æ€é“¾æ¥
<br />è¿æ¥æ–¹å¼
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>LIB=/opt/intel/compilers_and_libraries_2018.0.128/linux/mkl/lib/intel64/libmkl_blacs_intelmpi_ilp64.a
</code></pre></div>    </div>
  </li>
  <li>åŠ¨æ€é“¾æ¥
<br />è¿æ¥æ–¹å¼
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>LIB=-L/opt/intel/compilers_and_libraries_2018.0.128/linux/mkl/lib/intel64 -lmkl_blacs_intelmpi_ilp64
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="mpif90">mpif90</h2>
<p>ç¼–è¯‘vaspæ—¶è‹¥FCè®¾ç½®ä¸ºmpif90,æŠ¥é”™</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gfortran: command not found
</code></pre></div></div>
<p>è¿™æ˜¯å› ä¸º,intel MPIå‘½ä»¤ä¸­mpif90è°ƒç”¨gfortranè¿›è¡Œç¼–è¯‘,gfortranæ²¡å®‰è£…æŠ¥é”™
<br />è‹¥è£…ä¸Šgfortranåˆä¼šå› ä¸º,æ•°å­¦åº“ç­‰æ˜¯ä½¿ç”¨intelçš„ifortç¼–è¯‘çš„,å’Œgfortranåˆæœ‰å†²çªæŠ¥é”™
<br />æœ€å¥½çš„è§£å†³æ–¹å¼,æ˜¯FC=mpiifort
<br />æ­¤å†…å®¹å‚è€ƒ<a href="https://software.intel.com/en-us/forums/intel-clusters-and-hpc-technology/topic/288354">mpif90 from cluster toolkit pointing to gfortran</a>å’Œ<a href="http://scc.ustc.edu.cn/zlsc/pxjz/201408/W020140804352832344867.pdf">ç§‘å¤§æä¼šæ°‘è€å¸ˆ-MPIç¼–è¯‘ç¯å¢ƒçš„ä½¿ç”¨</a>
<img src="/uploads/2018/01/intel_mpi.png" alt="" /></p>
<h2 id="ç¼–è¯‘æ—¶æŠ¥é”™å“ªä¸ªæ•°å­¦åº“æ–‡ä»¶">ç¼–è¯‘æ—¶æŠ¥é”™å“ªä¸ªæ•°å­¦åº“æ–‡ä»¶</h2>
<p>æ£€æŸ¥æ•°å­¦åº“æ–‡ä»¶åæ˜¯å¦æ­£ç¡®,æ•°å­¦åº“æ˜¯å¦é€‰å¯¹,å¦‚<br />
<code class="highlighter-rouge">BLACS      = -lmkl_blacs_intelmpi_lp64</code>å› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯intelçš„mpiæ‰€ä»¥blacsä½¿ç”¨<code class="highlighter-rouge">intelmpi</code>ï¼Œè‹¥ä½¿ç”¨openmpi,åˆ™è®¾ç½®ä¸º<code class="highlighter-rouge">libmkl_blacs_openmpi_lp64</code></p>
<h2 id="ä½¿ç”¨fftw">ä½¿ç”¨fftw</h2>
<p>è‹¥ä¸ä½¿ç”¨intelçš„fftw,ä¸‹è½½fftw<br />
è§£å‹è¿›å…¥ç›¸å…³æ–‡ä»¶å¤¹å,ç”Ÿæˆä½¿ç”¨intelç¼–è¯‘æ”¯æŒå¹¶è¡Œçš„makefileæ–‡ä»¶</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./configure --prefix=/opt/fftw/ CC=icc F77=ifort MPICC=mpiicc --enable-mpi
make
make install
</code></pre></div></div>
<p>åˆ™<code class="highlighter-rouge">makefile.include</code>ä¸­è®¾ç½®ä¸º</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>OBJECTS    = fftmpiw.o fftmpi_map.o fftw3d.o fft3dlib.o \
             /opt/fftw/lib/libfftw3_mpi.a
INCS       =-I/opt/fftw/include
</code></pre></div></div>
<p>æ­¤å¤„å‚è€ƒ<a href="http://blog.csdn.net/sowhatgavin/article/details/71036878">fftw ç¼–è¯‘å®‰è£…è¯´æ˜</a></p>

<h2 id="fftwä¸æ”¯æŒmpiæŠ¥é”™"><del>fftwä¸æ”¯æŒmpiæŠ¥é”™</del></h2>
<p><del>ç¼–è¯‘fftwæ—¶ï¼Œè‹¥ä½¿ç”¨<code class="highlighter-rouge">make libintel64</code>ï¼Œåˆ™ç¼–è¯‘çš„fftwä¸æ”¯æŒmpi,ç¼–è¯‘æ—¶ä¼šå¯¹<code class="highlighter-rouge">libfftw3xf_intel.a</code>æŠ¥é”™</del></p>

<h2 id="æŠ¥é”™">æŠ¥é”™</h2>
<h3 id="segmentation-fault-occurred">segmentation fault occurred</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>forrtl: severe (174): SIGSEGV, segmentation fault occurred
Image              PC                Routine            Line        Source             
vasp               00000000013CD4ED  Unknown               Unknown  Unknown
libpthread-2.17.s  00007F66B288E5E0  Unknown               Unknown  Unknown
</code></pre></div></div>
<p>æ¯æ¬¡è¿è¡Œå‰åœ¨shellä¸­æ‰§è¡Œ</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ulimit -s unlimited
ulimit -m unlimited
ulimit -c unlimited
ulimit -d unlimited
</code></pre></div></div>
<p>å†è¿è¡Œvasp<br />
ä¹Ÿå¯ä»¥,æ·»åŠ <code class="highlighter-rouge">ulimit -s unlimited</code>åˆ°<code class="highlighter-rouge">/etc/profile</code>æˆ–<code class="highlighter-rouge">~/.bashrc</code>ï¼Œæ¯æ¬¡ç™»é™†è‡ªåŠ¨æ‰§è¡Œ<br /></p>
<blockquote>
  <p>åœ¨Linuxä¸‹å†™ç¨‹åºçš„æ—¶å€™ï¼Œå¦‚æœç¨‹åºæ¯”è¾ƒå¤§ï¼Œç»å¸¸ä¼šé‡åˆ°â€œæ®µé”™è¯¯â€ï¼ˆsegmentation faultï¼‰è¿™æ ·çš„é—®é¢˜,ulimitä¸ºshellå†…å»ºæŒ‡ä»¤ï¼Œå¯ç”¨æ¥æ§åˆ¶shellæ‰§è¡Œç¨‹åºçš„èµ„æº</p>
  <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  -a ã€€æ˜¾ç¤ºç›®å‰èµ„æºé™åˆ¶çš„è®¾å®šã€‚ 
  -c &lt;coreæ–‡ä»¶ä¸Šé™&gt; ã€€è®¾å®šcoreæ–‡ä»¶çš„æœ€å¤§å€¼ï¼Œå•ä½ä¸ºåŒºå—ã€‚ 
  -d &lt;æ•°æ®èŠ‚åŒºå¤§å°&gt; ã€€ç¨‹åºæ•°æ®èŠ‚åŒºçš„æœ€å¤§å€¼ï¼Œå•ä½ä¸ºKBã€‚ 
  -f &lt;æ–‡ä»¶å¤§å°&gt; ã€€shellæ‰€èƒ½å»ºç«‹çš„æœ€å¤§æ–‡ä»¶ï¼Œå•ä½ä¸ºåŒºå—ã€‚ 
  -H ã€€è®¾å®šèµ„æºçš„ç¡¬æ€§é™åˆ¶ï¼Œä¹Ÿå°±æ˜¯ç®¡ç†å‘˜æ‰€è®¾ä¸‹çš„é™åˆ¶ã€‚ 
  -m &lt;å†…å­˜å¤§å°&gt; ã€€æŒ‡å®šå¯ä½¿ç”¨å†…å­˜çš„ä¸Šé™ï¼Œå•ä½ä¸ºKBã€‚ 
  -n &lt;æ–‡ä»¶æ•°ç›®&gt; ã€€æŒ‡å®šåŒä¸€æ—¶é—´æœ€å¤šå¯å¼€å¯çš„æ–‡ä»¶æ•°ã€‚ 
  -p &lt;ç¼“å†²åŒºå¤§å°&gt; ã€€æŒ‡å®šç®¡é“ç¼“å†²åŒºçš„å¤§å°ï¼Œå•ä½512å­—èŠ‚ã€‚ 
  -s &lt;å †å å¤§å°&gt; ã€€æŒ‡å®šå †å çš„ä¸Šé™ï¼Œå•ä½ä¸ºKBã€‚ 
  -S ã€€è®¾å®šèµ„æºçš„å¼¹æ€§é™åˆ¶ã€‚ 
  -t &lt;CPUæ—¶é—´&gt; ã€€æŒ‡å®šCPUä½¿ç”¨æ—¶é—´çš„ä¸Šé™ï¼Œå•ä½ä¸ºç§’ã€‚ 
  -u &lt;ç¨‹åºæ•°ç›®&gt; ã€€ç”¨æˆ·æœ€å¤šå¯å¼€å¯çš„ç¨‹åºæ•°ç›®ã€‚ 
  -v &lt;è™šæ‹Ÿå†…å­˜å¤§å°&gt; ã€€æŒ‡å®šå¯ä½¿ç”¨çš„è™šæ‹Ÿå†…å­˜ä¸Šé™ï¼Œå•ä½ä¸ºKB
</code></pre></div>  </div>
  <p>å‚è€ƒ<a href="http://muchong.com/html/201711/6321998.html">vasp.5.3 é”™è¯¯ forrtl: severe (174): SIGSEGV, segmentation fault occurred</a></p>
</blockquote>

<h3 id="rlimit_memlock-too-small">RLIMIT_MEMLOCK too small</h3>
<p>å¹¶è¡Œè¿ç®—æ—¶</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mpirun -genv I_MPI_DEVICE rdssm -machinefile host.fiel -n 4 /home/cndaqiang/soft/vasp.5.4.1/build/std/vasp
[0] DAPL startup: RLIMIT_MEMLOCK too small
</code></pre></div></div>
<p>ä½¿ç”¨</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ulimit -l unlimited
</code></pre></div></div>
<p>è¿™æ¡å‘½ä»¤æ¶‰åŠrootçš„æƒé™ï¼Œæ‰€ä»¥,æ·»åŠ åˆ°<code class="highlighter-rouge">/etc/profile</code>,ä¹Ÿåªèƒ½ä»¥rootç”¨æˆ·è®¡ç®—<br />
<strong>æ¨èè§£å†³æ–¹æ¡ˆ</strong><br />
å‚è€ƒ<a href="https://software.intel.com/en-us/blogs/2014/12/16/best-known-methods-for-setting-locked-memory-size">Best Known Methods for Setting Locked Memory Size</a><br />
ä¿®æ”¹<code class="highlighter-rouge">/etc/security/limits.conf</code>,å¡«å…¥</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>username  hard memlock unlimited
username  soft memlock unlimited
</code></pre></div></div>
<p>å‚è€ƒç»„é‡ŒæœåŠ¡å™¨çš„é…ç½®,å…è®¸æ‰€æœ‰ç”¨æˆ·,è®¾ç½®ä¸º</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>* soft memlock unlimited
* hard memlock unlimited
* soft memlock unlimited
* soft stack unlimited
* soft nproc unlimited
* hard memlock unlimited
* hard stack unlimited
* hard nproc unlimited
</code></pre></div></div>
<p>rebooté‡å¯ç”Ÿæ•ˆ</p>

<h3 id="è¿™ä¸ªé”™è¯¯">è¿™ä¸ªé”™è¯¯</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Fatal error in PMPI_Alltoallv: Other MPI error, error stack:
PMPI_Alltoallv(665).............: MPI_Alltoallv(sbuf=0x7f760c875340, scnts=0x7f760e1e7a00, sdispls=0x7f760e1e7a40, MPI_INTEGER, rbuf=0x7f760c8eb380, rcnts=0x7f760e1e79a0, rdispls=0x7f760e1e79e0, MPI_INTEGER, comm=0x84000007) failed
MPIR_Alltoallv_impl(416)........: fail failed
MPIR_Alltoallv(373).............: fail failed
MPIR_Alltoallv_intra(226).......: fail failed
MPIR_Waitall_impl(221)..........: fail failed
PMPIDI_CH3I_Progress(623).......: fail failed
pkt_RTS_handler(317)............: fail failed
do_cts(662).....................: fail failed
MPID_nem_lmt_dcp_start_recv(302): fail failed
dcp_recv(165)...................: Internal MPI error!  Cannot read from remote process
 Two workarounds have been identified for this issue:
 1) Enable ptrace for non-root users with:
    echo 0 | sudo tee /proc/sys/kernel/yama/ptrace_scope
 2) Or, use:
    I_MPI_SHM_LMT=shm

</code></pre></div></div>

<p>è§£å†³</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo su
I_MPI_SHM_LMT=shm
echo 0 |  tee /proc/sys/kernel/yama/ptrace_scope
</code></pre></div></div>
<h3 id="æœªè§£å†³dapl-fabric-is-not-available-and-fallback-fabric-is-not-enabled">[æœªè§£å†³]dapl fabric is not available and fallback fabric is not enabled</h3>
<p>å¹¶è¡Œè¿ç®—æ—¶</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mpirun -genv I_MPI_DEVICE rdssm -machinefile host.fiel -n 4 /home/cndaqiang/soft/vasp.5.4.1/build/std/vasp
[0] MPI startup(): dapl fabric is not available and fallback fabric is not enabled
</code></pre></div></div>
<p>DEBUGå</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cannot open dynamic library libdat2.so.2
</code></pre></div></div>
<p>å¤„ç†æ–¹æ¡ˆæ˜¯ä¿®æ”¹<code class="highlighter-rouge">/etc/dat.conf</code>å¡«å…¥ç±»ä¼¼</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ofa-v2-mlx5_0-1u u2.0 nonthreadsafe default libdaploucm.so.2 dapl.2.0 "mlx5_0 1" ""
</code></pre></div></div>
<p>çš„ä¸œè¥¿,å‚è€ƒ<a href="https://community.mellanox.com/groups/hpc/blog/2013/10/29/some-notes-for-using-connect-ib-with-intel-mpi">
Using Connect-IB with Intel MPI</a><br />
<a href="https://software.intel.com/en-us/forums/intel-clusters-and-hpc-technology/topic/290764">dapl fabric is not available and fallback fabric is not enabled with IMPI 4.0.0</a><br />
ä¸æƒ³çœ‹äº†,ä»¥åå†è§£å†³,å…ˆå»æ‰<code class="highlighter-rouge"> -genv I_MPI_DEVICE rdssm</code>å‚æ•°è¿è¡Œ</p>

<h3 id="internal-error-in-init_scala-desca-descinit-info">internal error in INIT_SCALA: DESCA, DESCINIT, INFO:</h3>
<p>ä½¿ç”¨intel 2018ç¼–è¯‘å™¨åœ¨è®¡ç®—ä¸€äº›ä½“ç³»æ—¶ï¼Œä½¿ç”¨çš„æ ¸æ•°å°äºä¸€å®šå€¼æ—¶é‡åˆ°æ­¤é—®é¢˜ï¼Œä½¿ç”¨intel 2015ç¼–è¯‘å™¨åœ¨ç›¸åŒç¯å¢ƒä¸‹ç¼–è¯‘å,è¿è¡Œvaspæ²¡æœ‰æŠ¥é”™ï¼Œæš‚æ—¶å…ˆè¿™æ ·è§£å†³</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{    0,    0}:  On entry to 
DESCINIT parameter number    6 had an illegal value 
{    0,    1}:  On entry to 
DESCINIT parameter number    6 had an illegal value 
{    0,    2}:  On entry to 
DESCINIT parameter number    6 had an illegal value 
{    0,    3}:  On entry to 
DESCINIT parameter number    6 had an illegal value 
{    0,    4}:  On entry to 
DESCINIT parameter number    6 had an illegal value 
 internal error in INIT_SCALA: DESCA, DESCINIT, INFO:           -6
 internal error in INIT_SCALA: DESCA, DESCINIT, INFO:           -6
 internal error in INIT_SCALA: DESCA, DESCINIT, INFO:           -6
 internal error in INIT_SCALA: DESCA, DESCINIT, INFO:           -6
 internal error in INIT_SCALA: DESCA, DESCINIT, INFO:           -6
</code></pre></div></div>
:ET